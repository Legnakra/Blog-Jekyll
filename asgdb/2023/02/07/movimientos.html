<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Movimiento de Datos | sysmaria</title>
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="Movimiento de Datos">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introducción">
<meta property="og:description" content="Introducción">
<link rel="canonical" href="/asgdb/2023/02/07/movimientos.html">
<meta property="og:url" content="/asgdb/2023/02/07/movimientos.html">
<meta property="og:site_name" content="sysmaria">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-07T16:45:16+01:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Movimiento de Datos">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-07T16:45:16+01:00","datePublished":"2023-02-07T16:45:16+01:00","description":"Introducción","headline":"Movimiento de Datos","mainEntityOfPage":{"@type":"WebPage","@id":"/asgdb/2023/02/07/movimientos.html"},"url":"/asgdb/2023/02/07/movimientos.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="sysmaria">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
</head>
<body>



























































































































<header class="site-header site-header-transparent" role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="sysmaria" src="" onerror="this.style.display='none'">
  sysmaria
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/categories.html">CATEGORIAS</a>




</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;documentElement.setAttribute("data-header-transparent", "");var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<section class="page-banner">
    <div class="page-banner-img">
<div style="background-image: url(/assets/images/banners/pack.png)"></div>
        <img class="img-placeholder" src="/assets/images/banners/pack.png">
</div>
    <div class="wrapper">
      <div class="page-banner-inner">
<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Movimiento de Datos</h1>
  <h2 class="post-subtitle"></h2>

  <p class="post-meta">
    <time class="dt-published" datetime="2023-02-07T16:45:16+01:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Feb 7, 2023
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 19 mins</span>
  </p></header>
</div>
    </div>
  </section><script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h2 id="introducción">Introducción</h2>

<p>Los sistemas de gestión de bases de datos (SGBD) son herramientas que nos permiten almacenar y gestionar grandes volúmenes de datos de forma eficiente. En este sentido, es importante que los administradores de bases de datos conozcan las diferentes herramientas que nos permiten realizar operaciones de importación y exportación de datos, así como las diferentes opciones que nos ofrecen para realizar dichas operaciones.</p>

<p>En este caso, nos vamos a centrar en los movimientos de datos entre bases de datos relacionales, así como en las herramientas que nos permiten realizar dichas operaciones.</p>

<h2 id="preparación-del-escenario">Preparación del escenario</h2>

<p>Para llevar a cabo la realización de este ejercicio, vamos a hacer uso del esquema <code class="language-plaintext highlighter-rouge">SCOTT</code> para realizar las operaciones de exportación e importación de datos.</p>

<p>El esquema lo podremos encontrar en <a href="https://github.com/Legnakra/esquema-scott">este repositorio</a> y lo emplearemos junto a <code class="language-plaintext highlighter-rouge">Oracle Data Pump</code> para realizar las operaciones de exportación e importación de datos.</p>

<p><img src="/assets/images/interconexion/oracle.png" alt="oracle"></p>

<h3 id="oracle-data-pump">Oracle Data Pump</h3>

<p><strong>Oracle Data Pump</strong> es una herramienta que nos permite realizar operaciones de exportación e importación de datos de una base de datos Oracle. Esta herramienta nos permite realizar operaciones de exportación e importación de datos de forma más eficiente que las herramientas tradicionales de Oracle, como <code class="language-plaintext highlighter-rouge">exp</code> y <code class="language-plaintext highlighter-rouge">imp</code>.</p>

<h4 id="qué-es-oracle-data-pump-export">¿Qué es Oracle Data Pump Export?</h4>

<p>Oracle Data Pump Export es una utilidad para descargar datos y metadatos en un conjunto de archivos del sistema operativo denominado conjunto de archivos de volcado.</p>

<p>Puede importar un conjunto de archivos de volcado solo mediante la utilidad de importación de bomba de datos de Oracle. Puede importar el conjunto de archivos de volcado en el mismo sistema o importarlo a otro sistema y cargarlo allí.</p>

<p>El conjunto de archivos de volcado se compone de uno o más archivos de disco que contienen datos de tabla, metadatos de objetos de base de datos e información de control. Los archivos están escritos en un formato binario patentado. Durante una operación de importación, la utilidad Oracle Data Pump Import utiliza estos archivos para ubicar cada objeto de la base de datos en el conjunto de archivos de volcado.</p>

<p>Debido a que los archivos de volcado los escribe el servidor, en lugar del cliente, debe crear objetos de directorio que definan las ubicaciones del servidor en las que se escriben los archivos.</p>

<p>Oracle Data Pump Export le permite especificar que desea que un trabajo mueva un subconjunto de datos y metadatos, según lo determine el modo de exportación. Esta selección de subconjuntos se realiza mediante filtros de datos y filtros de metadatos, que se especifican a través de los parámetros de exportación de Oracle Data Pump.</p>

<p>Export proporciona diferentes modos para descargar diferentes porciones de datos de Oracle Database:</p>

<ul>
  <li>
    <p><strong>FULL</strong>: Exporta todos los datos y metadatos de la base de datos.</p>
  </li>
  <li>
    <p><strong>SCHEMA</strong>: Exporta todos los datos y metadatos de un esquema de usuario.</p>
  </li>
  <li>
    <p><strong>TABLE</strong>: Exporta todos los datos y metadatos de una tabla.</p>
  </li>
  <li>
    <p><strong>TABLESPACE</strong>: Exporta todos los datos y metadatos de un tablespace.</p>
  </li>
  <li>
    <p><strong>TRANSPORTABLE</strong>: Exporta todos los datos y metadatos de la base de datos en un formato que se puede importar en una base de datos de destino que no sea idéntica a la base de datos de origen.</p>
  </li>
</ul>

<h4 id="qué-es-oracle-data-pump-import">¿Qué es Oracle Data Pump Import?</h4>

<p>Oracle Data Pump Import es una utilidad para cargar un conjunto de archivos de volcado de exportación de Oracle en un sistema de destino.</p>

<p>Un conjunto de archivos de volcado de exportación se compone de uno o más archivos de disco que contienen datos de tabla, metadatos de objetos de base de datos e información de control. Los archivos están escritos en un formato binario patentado. Durante una operación de importación de Oracle Data Pump, la utilidad de importación utiliza estos archivos para ubicar cada objeto de la base de datos en el conjunto de archivos de volcado.</p>

<p>También puede usar Importar para cargar una base de datos de destino directamente desde una base de datos de origen sin archivos de volcado intermedios. Este tipo de importación se denomina importación de red.</p>

<p>Importar le permite especificar si un trabajo debe mover un subconjunto de datos y metadatos del conjunto de archivos de volcado o la base de datos de origen (en el caso de una importación de red), según lo determine el modo de importación. Esto se hace mediante el uso de filtros de datos y filtros de metadatos, que se implementan mediante comandos de importación.</p>

<h2 id="ejercicio-1">Ejercicio 1</h2>

<p><strong>Realiza una exportación del esquema de SCOTT usando Oracle Data Pump con las siguientes condiciones</strong>:</p>
<ul>
  <li>Exporta tanto la estructura de las tablas como los datos de las mismas.</li>
  <li>Excluye la tabla BONUS y los departamentos con menos de dos empleados.</li>
  <li>Realiza una estimación previa del tamaño necesario para el fichero de exportación.</li>
  <li>Programa la operación para dentro de 2 minutos.</li>
  <li>Genera un archivo de log en el directorio raíz.</li>
</ul>

<p>Para realizar la exportación, lo primero que deberemos hacer es concederle al usuario dueño de la base de datos los permisos necesarios para realizar la exportación.</p>

<ol>
  <li>
    <p>Para realizar la exportación, lo primero que deberemos hacer crear el directorio donde se almacenarán los archivos de exportación.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">mkdir</span> /opt/oracle/export
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/1.png" alt="1"></p>

    <p>Y le cambiamos los permisos para que el usuario <code class="language-plaintext highlighter-rouge">oracle</code> pueda acceder a él.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">chown </span>oracle:oinstall /opt/oracle/export
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/2.png" alt="2"></p>
  </li>
  <li>
    <p>Nos conectamos a la base de datos y creamos un directorio en el que se almacenarán los archivos de exporración, al que le asignaremos los permisos necesarios para que el usuario <code class="language-plaintext highlighter-rouge">maria</code> pueda acceder a él.</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="k">CREATE</span> <span class="n">DIRECTORY</span> <span class="n">EXPORT_BD</span> <span class="k">AS</span> <span class="s1">'/opt/oracle/export/'</span><span class="p">;</span>
 <span class="k">GRANT</span> <span class="k">READ</span><span class="p">,</span> <span class="k">WRITE</span> <span class="k">ON</span> <span class="n">DIRECTORY</span> <span class="n">BD_EXPORT</span> <span class="k">TO</span> <span class="n">SCOTT</span><span class="p">;</span>
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/3.png" alt="3"></p>
  </li>
  <li>
    <p>Le adjudicamos también permisos para que pueda exportar datos.</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="k">GRANT</span> <span class="n">DATAPUMP_EXP_FULL_DATABASE</span> <span class="k">TO</span> <span class="n">scott</span><span class="p">;</span>
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/4.png" alt="4"></p>
  </li>
  <li>
    <p>Ahora, exportamos el esquema de SCOTT usando Oracle Data Pump con las condiciones indicadas en el enunciado.</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="n">expdp</span> <span class="n">scott</span><span class="o">/</span><span class="n">tiger</span> <span class="n">DIRECTORY</span><span class="o">=</span><span class="n">BD_EXPORT</span> <span class="n">SCHEMAS</span><span class="o">=</span><span class="n">scott</span> <span class="n">EXCLUDE</span><span class="o">=</span><span class="k">TABLE</span><span class="p">:</span><span class="err">\</span><span class="nv">"=</span><span class="se">\'</span><span class="nv">BONUS</span><span class="se">\'\"</span><span class="nv">  QUERY=dept:'"</span><span class="k">WHERE</span> <span class="n">deptno</span> <span class="k">IN</span> <span class="err">\</span><span class="p">(</span><span class="k">SELECT</span> <span class="n">deptno</span> <span class="k">FROM</span> <span class="n">EMP</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">deptno</span> <span class="k">HAVING</span> <span class="k">COUNT</span><span class="err">\</span><span class="p">(</span><span class="o">*</span><span class="err">\</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="err">\</span><span class="p">)</span><span class="nv">"'
</span></code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/5.png" alt="5"></p>
  </li>
  <li>
    <p>Para realizar la exportación tras 2 minutos, podemos realizarlo a través del comando <code class="language-plaintext highlighter-rouge">at now + 2 minutes</code> o bien, como realizaré en mi caso, con un script que ejecutará la exportación tras 2 minutos.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="c">#!/bin/bash</span>
 <span class="nb">echo</span> <span class="s2">"Exportación de SCOTT en 2 minutos"</span>
 <span class="nb">sleep </span>60
 <span class="nb">echo</span> <span class="s2">"Exportación de SCOTT en 1 minuto"</span>
 <span class="nb">sleep </span>30
 <span class="nb">echo</span> <span class="s2">"Exportación de SCOTT en 30 segundos"</span>
 <span class="nb">sleep </span>27
 <span class="nb">echo</span> <span class="s2">"3..2..1"</span>
 <span class="nb">sleep </span>3
 expdp scott/tiger <span class="nv">DIRECTORY</span><span class="o">=</span>BD_EXPORT <span class="nv">SCHEMAS</span><span class="o">=</span>scott <span class="nv">EXCLUDE</span><span class="o">=</span>TABLE:<span class="se">\"</span><span class="o">=</span><span class="se">\'</span>BONUS<span class="se">\'\"</span>  <span class="nv">QUERY</span><span class="o">=</span>dept:<span class="s1">'"WHERE deptno IN \(SELECT deptno FROM EMP GROUP BY deptno HAVING COUNT\(*\)&gt;2\)"'</span>
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/6.png" alt="6"></p>

    <p>Tras crear el script, le damos permisos de ejecución.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nb">chmod</span> +x exportacion.sh
</code></pre></div>    </div>
  </li>
  <li>
    <p>Ejecutamos el script para comprobar que se realiza la exportación tras 2 minutos.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> ./exportacion.sh
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/7.png" alt="7"></p>
  </li>
</ol>

<h2 id="ejercicio-2">Ejercicio 2</h2>

<p><strong>Importa el fichero obtenido anteriormente usando Oracle Data Pump pero en un usuario distinto de la misma base de datos.</strong></p>

<p>Para realizar la importación, deberemos darle permisos de lectura y escritura al usuario al que importaremos la base de datos, al directorio donde se almacenarán los archivos de importación.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">GRANT</span> <span class="k">READ</span><span class="p">,</span> <span class="k">WRITE</span> <span class="k">ON</span> <span class="n">DIRECTORY</span> <span class="n">BD_EXPORT</span> <span class="k">TO</span> <span class="n">MARIA</span><span class="p">;</span>
</code></pre></div></div>

<p>Le concedemos también los permisos necesarios para realizar la importación.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">GRANT</span> <span class="n">IMP_FULL_DATABASE</span> <span class="k">TO</span> <span class="n">MARIA</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/8.png" alt="8"></p>

<p>E importamos la base de datos.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">impdp</span> <span class="n">maria</span><span class="o">/</span><span class="k">admin</span> <span class="n">schemas</span><span class="o">=</span><span class="n">scott</span> <span class="n">directory</span><span class="o">=</span><span class="n">BD_EXPORT</span> <span class="n">dumpfile</span><span class="o">=</span><span class="n">expdat</span><span class="p">.</span><span class="n">dmp</span> <span class="n">logfile</span><span class="o">=</span><span class="n">impdat</span><span class="p">.</span><span class="n">log</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/9.png" alt="9"></p>

<p>Como podemos comprobar, la importación se ha realizado correctamente y la tabla <code class="language-plaintext highlighter-rouge">BONUS</code> no se ha importado.</p>

<p><img src="/assets/images/asgdb/movimientos/10.png" alt="10"></p>

<h2 id="ejercicio-3">Ejercicio 3</h2>

<p><strong>Realiza una exportación de la estructura de todas las tablas de la base de datos usando el comando expdp de Oracle Data Pump probando al menos cinco de las posibles opciones que ofrece dicho comando y documentándolas adecuadamente.</strong></p>

<p>Para realizar la exportación de la estructura de todas las tablas, y para ello vamos a utilizar las siguientes opciones:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">SCHEMAS</code>: Especifica el esquema de la base de datos que se va a exportar.</li>
  <li>
<code class="language-plaintext highlighter-rouge">DUMPFILE</code>: Especifica el nombre del fichero de exportación.</li>
  <li>
<code class="language-plaintext highlighter-rouge">LOGFILE</code>: Especifica el nombre del fichero de log.</li>
  <li>
<code class="language-plaintext highlighter-rouge">DIRECTORY</code>: Especifica el directorio donde se almacenarán los archivos de exportación.</li>
  <li>
<code class="language-plaintext highlighter-rouge">CONTENT</code>: Especifica el contenido que se va a exportar.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">expdp</span> <span class="n">scott</span><span class="o">/</span><span class="n">tiger</span> <span class="n">schemas</span><span class="o">=</span><span class="n">scott</span> <span class="n">dumpfile</span><span class="o">=</span><span class="n">scottfull</span><span class="p">.</span><span class="n">dmp</span> <span class="n">logfile</span><span class="o">=</span><span class="n">scottfull</span><span class="p">.</span><span class="n">log</span> <span class="n">directory</span><span class="o">=</span><span class="n">BD_EXPORT</span> <span class="n">CONTENT</span><span class="o">=</span><span class="n">METADATA_ONLY</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/11.png" alt="11"></p>

<p><img src="/assets/images/banners/mysql.png" alt="mysql"></p>

<h2 id="ejercicio-4">Ejercicio 4</h2>

<p><strong>Intenta realizar operaciones similares de importación y exportación con las herramientas proporcionadas con MySQL desde línea de comandos, documentando el proceso.</strong></p>

<ul>
  <li>
    <p>Vamos a utilizar la misma base de datos que hemos empleado en Oracle, la base de datos <code class="language-plaintext highlighter-rouge">scott</code>. Para realizar la importación, lo haremos con el siguiente comando:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  mysql <span class="nt">-u</span> root <span class="nt">-p</span> scott &lt; scott.sql
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/12.png" alt="12"></p>

    <p>Como podemos observar, el fichero se ha creado correctamente.</p>
  </li>
  <li>
    <p>Para asegurarnos de que la importación se realiza correctamente, contruiré una base de datos limpia para realizar la importación y comparar los resultados.</p>

    <p><img src="/assets/images/asgdb/movimientos/13.png" alt="13"></p>

    <p><img src="/assets/images/asgdb/movimientos/14.png" alt="14"></p>

    <p>Como podemos observar, la importación se ha realizado correctamente. Hemos realizado una consulta a la tabla <code class="language-plaintext highlighter-rouge">EMP</code> y los resultados son los mismos que en la base de datos original.</p>

    <p><img src="/assets/images/asgdb/movimientos/15.png" alt="15"></p>
  </li>
</ul>

<p><img src="/assets/images/interconexion/postgresql.png" alt="postgres"></p>

<h2 id="ejercicio-5">Ejercicio 5</h2>

<p><strong>Intenta realizar operaciones similares de importación y exportación con las herramientas proporcionadas con Postgres desde línea de comandos, documentando el proceso.</strong></p>

<ul>
  <li>
    <p>Vamos a utilizar la base de datos <code class="language-plaintext highlighter-rouge">scott</code>. Para realizar la importación, lo haremos con el siguiente comando:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  pg_dump <span class="nt">-U</span> postgres scott <span class="o">&gt;</span> scott_import.sql
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/16.png" alt="16"></p>
  </li>
  <li>
    <p>Para asegurarnos de que la importación se realiza correctamente, contruiré una base de datos limpia para realizar la importación y comparar los resultados.</p>

    <p><img src="/assets/images/asgdb/movimientos/17.png" alt="17"></p>

    <p>Podemos ver que la base de datos creada está totalmente limpia, y que la base de datos que vamos a importar contiene datos.</p>

    <p><img src="/assets/images/asgdb/movimientos/18.png" alt="18"></p>
  </li>
  <li>
    <p>Importamos la base de datos con el siguiente comando:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  psql <span class="nt">-U</span> postgres scott &lt; scott_import.sql
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/19.png" alt="19"></p>
  </li>
  <li>
    <p>Comprobamos que la importación se ha realizado correctamente.</p>

    <p><img src="/assets/images/asgdb/movimientos/20.png" alt="20"></p>

    <p><img src="/assets/images/asgdb/movimientos/21.png" alt="21"></p>
  </li>
</ul>

<p><img src="/assets/images/banners/mongo.png" alt="mongo"></p>

<h2 id="ejercicio-6">Ejercicio 6</h2>

<p><strong>Exporta los documentos de una colección de MongoDB que cumplan una determinada condición e impórtalos en otra base de datos.</strong></p>

<ul>
  <li>
    <p>Vamos a utilizar la base de datos <code class="language-plaintext highlighter-rouge">asir</code> que hemos creado en MongoDB. Pero solamente vamos a exportar los documentos que cumplan la condición de que su campo de <code class="language-plaintext highlighter-rouge">horas</code> sea 6.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  mongoexport <span class="nt">-u</span> admin <span class="nt">--db</span> admin <span class="nt">--collection</span> Primero <span class="nt">--query</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">horas</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">6</span><span class="se">\"</span><span class="s2">}"</span> <span class="nt">--out</span> Primero.json
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/22.png" alt="22"></p>

    <p>Como podemos ver en la imagen anterior, se ha exportado correctamente el fichero <code class="language-plaintext highlighter-rouge">Primero.json</code>.</p>
  </li>
  <li>
    <p>Ahora vamos a importar el fichero <code class="language-plaintext highlighter-rouge">Primero.json</code> en la base de datos <code class="language-plaintext highlighter-rouge">asir2</code>.</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  mongoimport <span class="nt">--db</span> Primero <span class="nt">--collection</span> SeisHoras <span class="nt">--type</span> json <span class="nt">--file</span> Primero.json
</code></pre></div>    </div>

    <p><img src="/assets/images/asgdb/movimientos/23.png" alt="23"></p>

    <p><img src="/assets/images/asgdb/movimientos/24.png" alt="24"></p>
  </li>
</ul>

<p><img src="/assets/images/interconexion/oracle.png" alt="oracle"></p>

<h2 id="ejercicio-7">Ejercicio 7</h2>

<p><strong>SQL<em>Loader es una herramienta que sirve para cargar grandes volúmenes de datos en una instancia de ORACLE. Exportad los datos de una base de datos completa desde Postgres a texto plano con delimitadores y emplead SQL</em>Loader para realizar el proceso de carga de dichos datos a una instancia ORACLE. Debéis documentar todo el proceso, explicando los distintos ficheros de configuración y de log que tiene SQL*Loader.</strong></p>

<p>Para realizar este proceso, en mi caso, voy a emplear la base de datos SCOTT que tengo en postgres de anteriores ejercicios. Estos datos los vamos a importar a un fichero <code class="language-plaintext highlighter-rouge">csv</code> y luego vamos a importarlos a una base de datos de Oracle.</p>

<ul>
  <li><strong>Función exportación a csv</strong></li>
</ul>

<p>Para ello, vamos a tener que realizar una función en PGSQL que nos permita exportar los datos a un fichero <code class="language-plaintext highlighter-rouge">csv</code>. La función sería la siguiente:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">export_csv</span><span class="p">(</span><span class="n">name_tab</span> <span class="nb">TEXT</span><span class="p">,</span> <span class="n">ruta</span> <span class="nb">TEXT</span><span class="p">)</span>
<span class="k">RETURNS</span> <span class="n">VOID</span> <span class="k">AS</span> <span class="err">$$</span>
<span class="k">DECLARE</span>
    <span class="n">name_tab</span> <span class="nb">TEXT</span><span class="p">;</span>
<span class="k">BEGIN</span>
    <span class="k">FOR</span> <span class="n">name_tab</span> <span class="k">IN</span>
        <span class="k">SELECT</span> <span class="k">table_name</span>
        <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
        <span class="k">WHERE</span> <span class="n">table_schema</span> <span class="o">=</span> <span class="s1">'public'</span>
        <span class="k">AND</span> <span class="n">table_type</span> <span class="o">=</span> <span class="s1">'BASE TABLE'</span>
    <span class="n">LOOP</span>
        <span class="k">EXECUTE</span> <span class="n">format</span> <span class="p">(</span>
            <span class="s1">'COPY %I TO %L WITH (FORMAT CSV, DELIMITER </span><span class="se">''</span><span class="s1">,</span><span class="se">''</span><span class="s1">, HEADER TRUE)'</span><span class="p">,</span> <span class="n">name_tab</span><span class="p">,</span> <span class="n">ruta</span> <span class="o">||</span> <span class="n">name_tab</span> <span class="o">||</span> <span class="s1">'.csv'</span>
        <span class="p">);</span>
    <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="err">$$</span> <span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</code></pre></div></div>

<p>Ahora vamos a ejecutar la función para exportar los datos a un fichero <code class="language-plaintext highlighter-rouge">csv</code>.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">export_csv</span><span class="p">(</span><span class="s1">'scott'</span><span class="p">,</span> <span class="s1">'/home/postgres/'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/25.png" alt="25"></p>

<p>Como podemos observar, se han exportado correctamente los datos a un fichero <code class="language-plaintext highlighter-rouge">csv</code>.</p>

<p><img src="/assets/images/asgdb/movimientos/26.png" alt="26"></p>

<p>Y los pasamos por scp a la máquina de Oracle.</p>

<p><img src="/assets/images/asgdb/movimientos/27.png" alt="27"></p>

<ul>
  <li><strong>Creación de ficheros de control</strong></li>
</ul>

<p>Ahora vamos a crear los ficheros de control para la importación de los datos a Oracle. Para ello, vamos a crear un fichero de control para cada tabla que vamos a importar. En mi caso, voy a importar las tablas <code class="language-plaintext highlighter-rouge">EMP</code>, <code class="language-plaintext highlighter-rouge">DEPT</code> y <code class="language-plaintext highlighter-rouge">BONUS</code>.</p>

<p><strong>Fichero de control para la tabla DEPT</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano dept.ctl
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">OPTIONS</span> <span class="p">(</span><span class="n">SKIP</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">LOAD</span> <span class="k">DATA</span>
<span class="n">INFILE</span> <span class="s1">'/home/postgres/dept.csv'</span>
<span class="n">APPEND</span>
<span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">dept</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span> <span class="n">OPTIONALLY</span> <span class="n">ENCLOSED</span> <span class="k">BY</span> <span class="s1">'"'</span>
<span class="k">TRAILING</span> <span class="n">NULLCOLS</span>
<span class="p">(</span><span class="n">deptno</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/28.png" alt="28"></p>

<ul>
  <li>
<strong>Fichero de control para la tabla EMP</strong>
    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">OPTIONS</span> <span class="p">(</span><span class="n">SKIP</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">LOAD</span> <span class="k">DATA</span>
<span class="n">INFILE</span> <span class="s1">'/home/oracle/emp.csv'</span>
<span class="n">APPEND</span>
<span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">emp</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span> <span class="n">OPTIONALLY</span> <span class="n">ENCLOSED</span> <span class="k">BY</span> <span class="s1">'"'</span>
<span class="k">TRAILING</span> <span class="n">NULLCOLS</span>
<span class="p">(</span><span class="n">EMPNO</span><span class="p">,</span> 
<span class="n">ENAME</span><span class="p">,</span>
<span class="n">JOB</span><span class="p">,</span>
<span class="n">MGR</span><span class="p">,</span>
<span class="n">HIREDATE</span> <span class="nb">DATE</span> <span class="nv">"YYYY-MM-DD HH24:MI:SS"</span><span class="p">,</span>
<span class="n">SAL</span> <span class="nb">DECIMAL</span> <span class="k">EXTERNAL</span> <span class="p">(</span><span class="mi">7</span><span class="p">),</span>
<span class="n">COMM</span> <span class="nb">DECIMAL</span> <span class="k">EXTERNAL</span> <span class="p">(</span><span class="mi">7</span><span class="p">),</span>
<span class="n">DEPTNO</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><img src="/assets/images/asgdb/movimientos/29.png" alt="29"></p>

<ul>
  <li>Opciones empleadas
    <ul>
      <li>
<strong>SKIP</strong>: Nos permite saltarnos una línea del fichero de entrada.</li>
      <li>
<strong>APPEND</strong>: Nos permite añadir los datos al final de la tabla.</li>
      <li>
<strong>FIELDS TERMINATED BY</strong>: Nos permite indicar el delimitador de los campos.</li>
      <li>
<strong>OPTIONALLY ENCLOSED BY</strong>: Nos permite indicar el delimitador de los campos.</li>
      <li>
<strong>TRAILING NULLCOLS</strong>: Nos permite indicar que los campos vacíos se rellenen con <code class="language-plaintext highlighter-rouge">NULL</code>.</li>
      <li>
<strong>INTO TABLE</strong>: Nos permite indicar la tabla a la que se van a importar los datos.</li>
    </ul>
  </li>
  <li><strong>Importación de datos a Oracle</strong></li>
</ul>

<p>Creamos un nuevo usuario en Oracle para poder importar los datos.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">mov</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="k">admin</span><span class="p">;</span>
<span class="k">DEFAULT</span> <span class="n">TABLESPACE</span> <span class="n">users</span> 
<span class="k">TEMPORARY</span> <span class="n">TABLESPACE</span> <span class="k">temp</span>
<span class="n">PROFILE</span> <span class="k">DEFAULT</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span> <span class="k">TO</span> <span class="n">mov</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/30.png" alt="30"></p>

<p>Y creamos también las tablas en Oracle.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dept</span> <span class="p">(</span>
    <span class="n">deptno</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">dname</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span>
    <span class="n">loc</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp</span> <span class="p">(</span>
    <span class="n">empno</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ename</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">job</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
    <span class="n">mgr</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">hiredate</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">sal</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">comm</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">deptno</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/31.png" alt="31"></p>

<p><img src="/assets/images/asgdb/movimientos/32.png" alt="32"></p>

<p>Ahora vamos a importar los datos a Oracle. Para ello, vamos a ejecutar los siguientes comandos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlldr mov/admin <span class="nv">control</span><span class="o">=</span>/home/oracle/dept.ctl <span class="nv">log</span><span class="o">=</span>/home/oracle/dept.log
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/33.png" alt="33"></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlldr mov/admin <span class="nv">control</span><span class="o">=</span>/home/oracle/emp.ctl <span class="nv">log</span><span class="o">=</span>/home/oracle/emp.log
</code></pre></div></div>

<p><img src="/assets/images/asgdb/movimientos/35.png" alt="35"></p>

<p>Y sus respectivos ficheros de log.</p>

<p><img src="/assets/images/asgdb/movimientos/36.png" alt="36"></p>

<p><img src="/assets/images/asgdb/movimientos/37.png" alt="37"></p>

<p>Cabe destacar, que durante el testeo de este último ejercicio, he obtenido la ayuda de mi compañero <strong>Alejandro Montes</strong>.</p>

<p>Como podemos comprobar, se ha realizado correctamente la importación de los datos a Oracle desde una base de datos Postgres.</p>

<p><img src="/assets/images/asgdb/movimientos/38.png" alt="38"></p>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/asgdb/2023/02/07/auditoria.html" title="Auditoría en bases de datos">Auditoría en bases de datos</a><a class="next" href="/hlc+sri/2023/02/08/kubernetes-parametrizados.html" title="Taller Kubernetes: Despliegues parametrizados">Taller Kubernetes: Despliegues parametrizados</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/iaw/2023/01/09/java-simple.html" title="Taller Kubernetes: Despliegues parametrizados">Desarrollo y despliegue de una aplicación Java simple</a></li>
<li><a class="post-link" href="/seguridad/2023/01/09/vpn.html" title="Taller Kubernetes: Despliegues parametrizados">Acceso remoto con OpenVPN y certificados x509</a></li>
<li><a class="post-link" href="/seguridad/2023/01/13/vpn-d.html" title="Taller Kubernetes: Despliegues parametrizados">VPN sitio a sitio con WireGuard</a></li>
<li><a class="post-link" href="/aso/2022/11/10/kernel.html" title="Taller Kubernetes: Despliegues parametrizados">Compilación de un kernel a medida</a></li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">MENÚ 📝</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div></div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
