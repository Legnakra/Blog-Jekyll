<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>

  <title>Auditoría en bases de datos</title>
  <meta name='description' content="¿Qué es una auditoría en bases de datos?">
  <link rel='canonical' href="flexton.netlify.com/2023/02/07/auditoria/">
  <link rel='alternate' type='application/rss+xml' title='Welcome to MariaTec' href="flexton.netlify.com/feed.xml">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Volkhov:400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">

  <style>
    
    /*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:rgba(0,0,0,0);-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,dl,dd,ol,ul,fieldset,legend,figure,hr{margin:0;padding:0}li>ul,li>ol{margin-bottom:0}table{border-collapse:collapse;border-spacing:0}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icon{position:relative;display:inline-block;width:25px;height:25px;overflow:hidden;fill:currentColor}.icon__cnt{width:100%;height:100%;background:inherit;fill:inherit;pointer-events:none;transform:translateX(0);-ms-transform:translate(0.5px, -0.3px)}.icon--m{width:50px;height:50px}.icon--l{width:100px;height:100px}.icon--xl{width:150px;height:150px}.icon--xxl{width:200px;height:200px}.icon__spinner{position:absolute;top:0;left:0;width:100%;height:100%}.icon--ei-spinner .icon__spinner,.icon--ei-spinner-2 .icon__spinner{-webkit-animation:spin 1s steps(12) infinite;animation:spin 1s steps(12) infinite}.icon--ei-spinner-3 .icon__spinner{-webkit-animation:spin 1.5s linear infinite;animation:spin 1.5s linear infinite}.icon--ei-sc-facebook{fill:#3b5998}.icon--ei-sc-github{fill:#333}.icon--ei-sc-google-plus{fill:#dd4b39}.icon--ei-sc-instagram{fill:#3f729b}.icon--ei-sc-linkedin{fill:#0976b4}.icon--ei-sc-odnoklassniki{fill:#ed812b}.icon--ei-sc-skype{fill:#00aff0}.icon--ei-sc-soundcloud{fill:#f80}.icon--ei-sc-tumblr{fill:#35465c}.icon--ei-sc-twitter{fill:#55acee}.icon--ei-sc-vimeo{fill:#1ab7ea}.icon--ei-sc-vk{fill:#45668e}.icon--ei-sc-youtube{fill:#e52d27}.icon--ei-sc-pinterest{fill:#bd081c}.icon--ei-sc-telegram{fill:#08c}*,*::after,*::before{box-sizing:border-box}h1,h2,h3,h4,h5,h6,ul,ol,dl,blockquote,p,address,hr,table,fieldset,figure,pre{margin-bottom:15px}ul,ol,dd{margin-left:15px}.highlight{background:#f7f7f7}.highlighter-rouge .highlight{background:#eef}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}body{font-family:"Open Sans",Helvetica Neue,Helvetica,Arial,sans-serif;font-size:15px;line-height:28px;color:#404040;background-color:#fbfbfb;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*::selection{color:#fff;background-color:#3af}h1,h2,h3,h4,h5,h6{font-family:"Volkhov","Times New Roman",Times,serif;font-weight:400;line-height:initial}h1{font-size:32px}h2{font-size:28px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}img{max-width:100%;height:auto;vertical-align:middle}a{text-decoration:none;color:#3af;transition:.35s}a:hover{color:#0086e6}blockquote{padding-left:15px;border-left:3px solid #3af;font-family:"Volkhov","Times New Roman",Times,serif;font-style:normal;font-size:18px;background-color:rgba(220,235,245,.2)}blockquote p{padding:10px}hr{height:1px;margin:30px 0;border:0;background-color:#f0f0f0}pre{overflow:auto;padding:25px;font-size:14px;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier,monospace}code{overflow:auto;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier,monospace;font-size:14px;background-color:#f7f7f7}p code,li code{padding:3px 5px}.o-wrapper{max-width:1440px;position:relative}.o-opacity{animation-duration:.7s;animation-delay:.2s;animation-fill-mode:both;animation-name:opacity}@keyframes opacity{from{opacity:0}to{opacity:1}}.c-btn{display:inline-block;white-space:nowrap;vertical-align:middle;font-family:"Volkhov",serif;font-size:12px;text-align:center;padding:8px 15px;cursor:pointer;transition:.35s}.c-btn--primary{color:#fff;background-color:#3af;background:linear-gradient(135deg, #33aaff 0%, #62d5ff 100%)}.c-btn--secondary{color:#fff;background-color:#cfcfdd;background:linear-gradient(135deg, #a2a2bd 0%, #cfcfdd 100%)}.c-btn--round{border-radius:30px}.c-btn--shadow{box-shadow:8px 10px 20px 0 rgba(46,61,73,.15)}.c-btn--shadow:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,.2)}.c-btn--middle{display:block;width:300px;max-width:100%}.c-btn--big{display:block;width:100%}.c-btn:hover{color:#fff;transition:.35s}.c-btn:active{transform:translateY(2px)}.c-sidebar{display:flex;flex-direction:column;justify-content:space-between;position:fixed;top:0;left:0;bottom:0;width:360px;padding:40px 20px 20px;text-align:center;box-shadow:1px 1px 0 rgba(31,35,46,.15);background-color:#fff}.c-sidebar-author .c-author__cover{width:100px;height:100px;margin:0 auto 10px;border-radius:50%;overflow:hidden;background-color:#cfcfdd}.c-sidebar-author .c-author__cover img{width:100%;height:100%;border-radius:50%;transition:.35s}.c-sidebar-author .c-author__cover img:hover{transform:scale3d(0.9, 0.9, 1)}.c-sidebar-author .c-contact-menu .c-btn{min-width:110px}.c-sidebar-author .c-contact-menu .c-btn .icon{width:18px;height:18px;vertical-align:text-bottom;fill:#fff}.c-sidebar-author .c-author__info{font-family:"Volkhov",serif}.c-sidebar-author .c-author__name{font-size:18px;font-weight:700;line-height:21px}.c-sidebar-author .c-author__job{font-size:12px;color:#a0a0a0;margin:5px 0 0}.c-sidebar-author .c-contact-menu{margin:30px 0}.c-sidebar-author .c-contact-menu .c-btn--secondary{margin-right:10px}.c-sidebar-author .c-author__about{max-width:400px;margin:0 auto 15px;font-size:13px}.c-sidebar-footer .c-social__title{position:relative;font-family:"Volkhov",serif;font-size:15px;font-weight:700;color:#444}.c-sidebar-footer .c-social__title::before{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;left:0;background-color:#444}.c-sidebar-footer .c-social__title::after{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;right:0;background-color:#444}.c-sidebar-footer .c-social__list{list-style-type:none;padding:0;margin:15px 0}.c-sidebar-footer .c-social__list .c-social__item{display:inline-block;width:27px;height:27px}.c-sidebar-footer .c-social__list .icon{width:27px;height:27px;fill:#444;vertical-align:middle;transition:.35s}.c-sidebar-footer .c-social__list .icon:hover{fill:#3af;transform:scale(1.2);transition:.35s}.c-sidebar-footer .c-copyright p{font-size:13px;margin:0}@media only screen and (max-width: 900px){.c-sidebar{position:relative;width:100%;padding:20px}.c-sidebar .c-contact-menu{margin:20px 0}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}@media only screen and (max-width: 480px){.c-sidebar-author .c-author__cover{width:80px;height:80px}.c-sidebar-author .c-author__cover img{width:100%;height:100%}.c-sidebar-author .c-contact-menu{margin:15px 0}.c-sidebar-author .c-contact-menu .c-btn{min-width:80px;font-size:10px;padding:4px 15px;margin-right:5px}.c-sidebar-author .c-contact-menu .c-btn .icon{width:16px;height:16px}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-social__list .icon{width:25px;height:25px}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}.c-content{position:relative;display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;padding:0 20px 0;margin-left:360px}@media only screen and (max-width: 900px){.c-content{position:static;padding:0 15px 0;margin-left:0}}.c-posts{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-post{width:100%;max-width:100%;margin-bottom:20px;display:flex;flex-direction:row;align-items:stretch;min-height:180px;border-radius:10px;overflow:hidden;transition:.35s;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,.15)}.c-post:hover{transform:translate(0px, -2px);box-shadow:0 15px 45px -10px rgba(10,16,34,.2)}.c-post .c-post-thumbnail{display:block;width:30%;max-width:100%;min-height:180px;border-radius:10px 0 0 10px;background-color:rgba(220,235,245,.2);background-size:cover;background-position:50% 50%}.c-post .c-post-content{padding:15px;width:70%}.c-post .c-post-content .c-post-title{font-size:30px;font-weight:400;margin:0 0 15px}.c-post .c-post-content .c-post-title a{text-decoration:none;color:#263959}.c-post .c-post-content .c-post-date,.c-post .c-post-content .c-post-words{font-size:12px}.c-load-more{padding:20px;margin:20px auto 40px;font-size:13px;color:#fff;border:none;background-color:#3af;outline:none}.c-load-more:hover{background-color:#0086e6}@media only screen and (max-width: 1200px){.c-post{width:48%;max-width:100%;margin:0 1% 20px;flex-direction:column}.c-post .c-post-thumbnail{width:100%;border-radius:10px 10px 0 0}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}@media only screen and (max-width: 480px){.c-post{width:100%;max-width:100%;margin:0 0 20px}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}.c-article{width:100%;margin:20px 0}.c-wrap-content{padding:20px;background-color:#fff}.c-article__image{position:relative;background-color:rgba(220,235,245,.2);background-position:center;background-size:cover;background-repeat:no-repeat}.c-article__image:after{content:"";display:block;padding-top:56%}.c-article__header{margin-bottom:20px;text-align:center}.c-article__header .c-article__title{margin-bottom:10px}.c-article__date span{font-size:13px;text-transform:uppercase;color:#a0a0a0}.c-article__footer{margin:30px 0 0;padding-bottom:30px;text-align:center;border-bottom:1px solid #f0f0f0}.c-article__footer .c-article__share{transition:.35s}.c-article__footer .c-article__share a .icon{vertical-align:middle;transition:.35s}.c-article__footer .c-article__share a .icon:hover{opacity:.7;transition:.35s}.c-article__footer .c-article__tag{margin-bottom:5px}.c-article__footer .c-article__tag a{display:inline-block;vertical-align:middle;padding:5px 10px;font-family:"Volkhov","Times New Roman",Times,serif;font-size:10px;line-height:10px;text-transform:uppercase;background-color:rgba(115,138,160,.6);color:#fff}.c-article__footer .c-article__tag a:hover{background-color:rgba(80,100,118,.6)}.c-article__footer .c-article__tag a:last-child{margin-right:0}.c-recent-post{padding:30px 0}.c-recent-post .c-recent__title{font-size:14px;text-align:center;text-transform:uppercase;margin-bottom:30px}.c-recent-post .c-recent__box{display:flex;flex-direction:row;flex-wrap:wrap}.c-recent-post .c-recent__item{max-width:23%;flex-basis:23%;margin:0 1% 20px;border-radius:10px;overflow:hidden;text-align:center;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,.15);transition:.35s}.c-recent-post .c-recent__item h4{margin-bottom:5px;font-size:12px;text-transform:uppercase}.c-recent-post .c-recent__item h4 a{color:#444}.c-recent-post .c-recent__item:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,.2)}.c-recent-post .c-recent__footer{padding:15px}.c-recent-post .c-recent__image{display:block;width:100%;min-height:180px;background-color:rgba(220,235,245,.2);background-size:cover;background-position:center;background-repeat:no-repeat}.c-recent-post .c-recent__date{color:#a0a0a0;font-size:12px}@media only screen and (max-width: 1200px){.c-recent-post .c-recent__item{max-width:48%;flex-basis:48%}}@media only screen and (max-width: 900px){.c-article{margin:15px 0}}@media only screen and (max-width: 480px){.c-wrap-content{padding:15px}.c-article__header{margin-bottom:5px}.c-article__header .c-article__title{font-size:24px;margin-bottom:5px}.c-recent-post .c-recent__item{max-width:100%;flex-basis:100%;margin:0 0 20px}}.c-blog-tags{width:100%;padding:20px;margin:20px 0 40px;background-color:#fff}.c-blog-tags h1{text-align:center;margin-bottom:0}.c-blog-tags h2{font-size:18px;text-transform:uppercase;margin:30px 0;color:#757575}.c-tag__list{list-style:none;padding:0 0 40px;margin:40px 0 0;border-bottom:1px solid #f0f0f0}.c-tag__list li{display:inline-block;margin-right:15px}.c-tag__list li a{color:#404040;text-transform:uppercase;font-size:12px}.c-tag__list li a:hover{color:#000}.c-tag__item{margin-bottom:15px}.c-tag__image{width:50px;height:50px;border-radius:50%;margin-right:5px}@media only screen and (max-width: 480px){.c-blog-tags{padding:15px}.c-blog-tags h1{font-size:27px}.c-blog-tags h2{font-size:16px;margin:15px 0}.c-tag__list{padding:0 0 30px;margin:30px 0 0}.c-tag__item{margin-bottom:5px}.c-tag__image{display:none}}.c-header{position:relative;width:100%;margin:20px 0}.c-header__box{position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.c-header__box .icon--ei-search{position:absolute;top:7px;left:15px;fill:#ccc}.c-search{width:80%}.c-search .c-search__box{display:flex;align-items:center}.c-search .c-search__text{position:relative;width:100%;padding:10px 10px 10px 40px;border:1px solid #dce4ea;border-radius:30px;outline:none;color:#a0a0a0}.c-search .c-search__text::placeholder{color:#ccc}.c-search .c-search__text:hover{box-shadow:0 1px 0px rgba(132,135,138,.1);transition:.35s}.c-search .c-search-results-list{position:absolute;width:100%;margin:10px 0 0;list-style-type:none;background-color:#fff;z-index:1}.c-search .c-search-results-list li{display:flex;flex-wrap:wrap;align-items:center;margin:0;padding:20px 25px 0;background-color:#fff;line-height:1.4;border-left:solid 1px #edeeee;border-right:solid 1px #edeeee}.c-search .c-search-results-list li:first-child{border-top-left-radius:5px;border-top-right-radius:5px;border-top:solid 1px #edeeee}.c-search .c-search-results-list li:last-child{border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding-bottom:25px;border-bottom:solid 1px #edeeee}.c-search .c-search-results-list li a{font-size:16px}.c-nav{flex-grow:1;padding-left:20px}.c-nav .c-nav__list{display:flex;justify-content:flex-end}.c-nav .c-nav__list .c-nav__item{display:flex;align-items:center;float:left;padding:4px 10px;font-size:10px;text-transform:uppercase;white-space:nowrap;border:1px solid #dce4ea;box-shadow:0 1px 0px rgba(132,135,138,.4);will-change:transform;transform:translateY(0px);cursor:pointer}.c-nav .c-nav__list .c-nav__item:hover{color:#222;background-color:#fff}.c-nav .c-nav__list .c-nav__item.is-active{box-shadow:0 0 0 rgba(132,135,138,.5);transform:translateY(1px);color:#cfcfdd}.c-nav .c-nav__list .c-nav__item.is-active:hover{background-color:#fbfbfb}.c-nav .c-nav__list .c-nav__item:first-child{border-radius:10px 0 0 10px}.c-nav .c-nav__list .c-nav__item:last-child{border-radius:0 10px 10px 0}.c-nav .c-nav__list .c-nav__item .icon{width:18px;height:18px;margin-right:3px}@media only screen and (max-width: 900px){.c-header{margin:15px 0}}@media only screen and (max-width: 480px){.c-header .c-header__box{flex-direction:column}.c-header .c-search{width:100%}.c-header .c-search .c-search__text{padding:8px 8px 8px 40px}.c-header .c-nav{margin-top:15px}.c-header .c-nav .c-nav__list{justify-content:center}.c-header .c-nav .c-nav__item{padding:4px 8px}}.c-categories{width:100%}.c-categories__list{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-categories__item{max-width:25%;flex-basis:25%;padding:0 10px 20px}.c-categories__link{height:100%;display:flex;flex-direction:column;align-items:center;padding:20px 10px;border-radius:5px;box-shadow:5px 5px 25px rgba(46,61,73,.15);background-color:#fff;transition:.35s}.c-categories__link:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,.2)}.c-categories__link:hover .c-categories__img .c-categories__more{opacity:1;transition:.35s}.c-categories__link .c-categories__container{width:100%;word-wrap:break-word}.c-categories__link .c-categories__container.c-empty-figure{display:flex;flex-direction:column;justify-content:center;flex-grow:1}.c-categories__img{position:relative;max-width:100%}.c-categories__img figure{position:relative;width:200px;max-width:100%;margin-bottom:20px;overflow:hidden;background-size:cover;background-repeat:no-repeat;background-position:center;border-radius:50%;box-shadow:inset 0 1px 3px rgba(141,165,185,.3)}.c-categories__img figure:after{content:"";display:block;padding-top:100%}.c-categories__img figure:before{content:"";position:absolute;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,.15)}.c-categories__img .c-categories__more{display:inline-block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);font-weight:700;color:#fff;text-transform:uppercase;text-shadow:0 1px 0 rgba(104,172,191,.3);opacity:0;transition:.35s}.c-categories__container{text-align:center}.c-categories__container .c-categories__header{font-size:13px;margin-bottom:10px;font-weight:normal;text-transform:uppercase;color:#404040}.c-categories__container .c-categories__count{font-family:"Volkhov",serif;font-size:12px;color:#404040;margin-bottom:0}.c-categories__container .c-categories__count span{display:inline-block;width:20px;height:20px;line-height:20px;vertical-align:baseline;margin-right:5px;border-radius:50%;color:#fff;background-color:#ee6c6c}@media only screen and (max-width: 1200px){.c-categories .c-categories__item{max-width:33.333%;flex-basis:33.333%}}@media only screen and (max-width: 1050px){.c-categories .c-categories__item{max-width:50%;flex-basis:50%}}@media only screen and (max-width: 480px){.c-categories .c-categories__item{max-width:100%;flex-basis:100%;padding:0 0 20px}}.c-form-box{position:absolute;top:0;width:calc(100% - 40px);min-height:100vh;padding:0 20px;background-color:#fff;z-index:1}.c-form-bnt__close{position:absolute;top:0px;left:0;width:30px;height:30px;cursor:pointer;transition:.35s}.c-form-bnt__close:hover{transform:scale(0.8);opacity:.8}.c-form{position:relative;width:750px;max-width:100%;margin:40px auto}.c-form .c-form__title{margin:0 0 40px;min-width:0;border:0;padding:0;font-family:"Volkhov","Times New Roman",Times,serif;text-transform:uppercase;text-align:center}.c-form a{color:#404040}.c-form__group{margin-bottom:20px}.c-form__group label{display:block;text-transform:uppercase;font-size:10px}.c-form__group input,.c-form__group textarea{width:100%;padding:10px 15px;color:#404040;border:1px solid #dce4ea;outline:none;transition:.35s}.c-form__group input:focus,.c-form__group textarea:focus{box-shadow:0 4px 25px rgba(132,135,138,.1)}.c-form__group button{padding:20px;text-transform:uppercase;outline:none;border:none}.c-thank-you p{position:relative;padding:20px 40px;width:750px;max-width:100%;text-transform:uppercase;font-size:12px;line-height:18px;font-weight:700;margin:40px auto 0;text-align:center;color:#fff;background:linear-gradient(135deg, #55b5ad 0%, #5ec9c5 100%)}.c-thank-you p .c-form-bnt__close{width:25px;height:25px;background:rgba(0,0,0,0)}.c-thank-you p a{color:#fff}@media only screen and (max-width: 900px){.c-form-box{width:100%;left:0;right:0}}@media only screen and (max-width: 480px){.c-form-bnt__close{width:25px;height:25px}}.c-newsletter{padding:30px 0 60px;margin:0 auto;border-bottom:1px solid #f0f0f0}.c-newsletter__header{text-align:center}.c-newsletter__header .c-newsletter__title{font-size:14px;text-transform:uppercase;text-align:center}.c-newsletter__header .c-newsletter__subtitle{margin-bottom:15px}.c-newsletter-form{width:100%;max-width:750px;margin:0 auto}.c-newsletter-form .c-newsletter-form__group{display:flex}.c-newsletter__email{width:70%;height:40px;padding:10px 15px;border:1px solid #ddd;border-right-color:rgba(0,0,0,0);outline:none;transition:.35s}.c-newsletter__email:focus{box-shadow:0 4px 25px rgba(132,135,138,.1)}.c-newsletter__button{width:30%;height:40px;color:#fff;background-color:#3af;transition:.35s;border:none;outline:none;cursor:pointer}.c-newsletter__button:hover{background-color:#0086e6}@media only screen and (max-width: 480px){.c-newsletter__button{font-size:13px}}.c-comments{padding:30px 0;border-top:1px solid #f0f0f0}.c-top{position:fixed;width:40px;height:40px;bottom:20px;color:#757575;cursor:pointer;transition:.35s;right:-100px;z-index:10;opacity:.5}.c-top--active{right:15px}.c-top:hover{color:#757575;opacity:1}.u-text-left{text-align:left}.u-text-right{text-align:right}.u-text-center{text-align:center}.u-text-justify{text-align:justify}.u-block{display:block}.u-inline-block{display:inline-block}.u-inline{display:inline}.u-full-width{display:block;width:100%}.u-vertical-center{display:flex;align-items:center;justify-content:center}.u-responsive-image{max-width:100%;height:auto;vertical-align:middle}.u-show{display:block !important}.u-hide{display:none !important}.u-invisible{visibility:hidden}.u-float-left{float:left}.u-float-right{float:right}.u-no-padding-top{padding-top:0}.u-no-padding-bottom{padding-bottom:0}.u-no-padding-left{padding-left:0}.u-no-padding-right{padding-right:0}.u-no-padding{padding:0}.u-no-margin-top{margin-top:0}.u-no-margin-bottom{margin-bottom:0}.u-no-margin-left{margin-left:0}.u-no-margin-right{margin-right:0}.u-no-margin{margin:0}.u-lists-reset{list-style-type:none;margin:0;padding:0}.u-clearfix::before,.u-clearfix::after{content:"";display:table;clear:both}.u-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}
  </style>
</head>

<body>
  
  <div class="o-wrapper">
    <aside class="c-sidebar">
  <div class="c-sidebar-author">
    <div class="c-author__cover">
      <a href="/">
        <img src="/images/1.jpg" alt="María Alloza">
      </a>
    </div>
    <div class="c-author__info">
      <div class="c-author__name">María Alloza</div>
      <span class="c-author__job">DevOps Engineer</span>
    </div>
    <div class="c-contact-menu">
      
      <a href="/contact" class="c-contact-btn c-btn c-btn--secondary c-btn--round c-btn--shadow"><span data-icon='ei-envelope' data-size='s'></span> Send me</a>
      
      
      <a href="https://twitter.com/intent/user?screen_name=marixusa" class="c-btn c-btn--primary c-btn--round c-btn--shadow"><span data-icon='ei-sc-twitter' data-size='s'></span> Sígueme</a>
      
    </div>
    <p class="c-author__about">Soy Administradora de Sistemas en camino a convertirme en DevOps Engineer. Siempre con ganas de aprender y compartir.</p>
  </div>

  <div class="c-sidebar-footer">
    <div class="c-social">
      <div class="c-social__title">Social</div>
      <ul class="c-social__list u-lists-reset">
        
          <li class="c-social__item"><a href="https://twitter.com/marixusa" target="_blank"><div data-icon='ei-sc-twitter' data-size='s'></div></a></li>
        
        
        
        
          <li class="c-social__item"><a href="https://github.com/Legnakra" target="_blank"><div data-icon='ei-sc-github' data-size='s'></div></a></li>
        
        
        
        
        
        
        
        
        
        
          <li class="c-social__item"><a href="https://in.linkedin.com/in/www.linkedin.com/in/mariajesusalloza" target="_blank"><div data-icon='ei-sc-linkedin' data-size='s'></div></a></li>
        
      </ul>
    </div>
    <div class="c-copyright">
      <p>2023 &copy; María Alloza</p>
    </div>
  </div>
</aside> <!-- /.c-sidebar -->

<main class="c-content">
  <article class="c-article">
  <div class="c-article__content">
    <header class="c-header u-hide u-no-margin-top">
      <div class="c-header__box">
        <div class="c-search u-full-width">
          <div class="c-search__box">
            <label for="js-search-input" class="u-screen-reader-text">Search for Blog</label>
            <input type="text" id="js-search-input" class="c-search__text" autocomplete="off" placeholder="Type to search...">
            <div data-icon='ei-search' data-size='s'></div>
          </div>
          <ul id="js-results-container" class="c-search-results-list"></ul>
        </div>
      </div>
    </header>
    
    <div class="c-article__image o-opacity" style="background-image: url( /images/pack.png )"></div>
    
    <div class="c-wrap-content">
      <header class="c-article__header">
        <h1 class="c-article__title">Auditoría en bases de datos</h1>
        <div class="c-article__date">
          <span>2023, Feb 07</span>
        </div>
      </header>
      <h2 id="qué-es-una-auditoría-en-bases-de-datos">¿Qué es una auditoría en bases de datos?</h2>

<p>Una auditoría en bases de datos es un proceso que permite verificar el correcto funcionamiento de una base de datos, así como el cumplimiento de las políticas de seguridad y de las normas de calidad de los datos.  Dicho de otra forma, es un proceso que permite medir, demostrar, monitorear y registrar los accesos a la información que se haya almacenada en en una base de datos.</p>

<p>Un administrador puede realizar auditorías con acciones individuales, como el tipo de declaración de lenguaje de consulta estructurado (SQL) ejecutada, o en combinaciones de datos que pueden incluir el nombre del usuario, la aplicación o la marca de tiempo, por ejemplo. Los auditores deben auditar las actividades exitosas y fallidas, e incluir o excluir usuarios específicos de la auditoría.</p>

<h2 id="ejercicios-prácticos">Ejercicios prácticos</h2>

<p><img src="/images/interconexion/oracle.png" alt="oracle" /></p>

<h3 id="ejercicio-1">Ejercicio 1</h3>

<p><strong>Activa desde SQL*Plus la auditoría de los intentos de acceso exitosos al sistema. Comprueba su funcionamiento.</strong></p>

<p>Lo primero que debemos hacer es activar la auditoría, que en ORACLE depende de un parámetro de sistema, <code class="language-plaintext highlighter-rouge">AUDIT_TRAIL</code>. Este parámetro puede tener los siguientes valores:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">NONE</code>: No se realiza ninguna auditoría.</li>
  <li><code class="language-plaintext highlighter-rouge">DB</code>: Se realiza una auditoría en la base de datos.</li>
  <li><code class="language-plaintext highlighter-rouge">OS</code>: Se realiza una auditoría en el sistema operativo.</li>
</ul>

<p>Antes de nada, vamos a comprobar el valor actual del parámetro:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">parameter</span> <span class="n">audit</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/1.png" alt="1" /></p>

<p>Como podemos ver, enmi caso, el valor actual es <code class="language-plaintext highlighter-rouge">BD</code>. Si por elcontrario, el valor actual hubiese sido <code class="language-plaintext highlighter-rouge">NONE</code>, por lo que no se podría realizar ninguna auditoría. Para activar la auditoría, debemos ejecutar el siguiente comando:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">audit_trail</span><span class="o">=</span><span class="n">db</span> <span class="k">scope</span><span class="o">=</span><span class="n">spfile</span><span class="p">;</span></code></pre></figure>

<p>Para que la modificación sea efectiva, debemos reiniciar la base de datos:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">shutdown</span> <span class="k">immediate</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">startup</span></code></pre></figure>

<p>Si comprobamos de nuevo el valor del parámetro, veremos que ahora es <code class="language-plaintext highlighter-rouge">DB</code>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">parameter</span> <span class="n">audit_trail</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/2.png" alt="2" /></p>

<p>Por lo que, podemos confirmar que los cambios se han realizado correctamente. Pero,ahora deberemos activar la auditoría de intentos fallidos al sistema.</p>

<p>Por ejemplo, imaginemos que nos han contratado para realizar la  FCT en una empresa y que, por error, no somos capaces de acceder a la base de datos. Para ver nuestros intentos fallidos, deberá tener habilitada la auditoría de inicio de sesión, pero concretamente, la auditoría de intentos fallidos al sistema. Para ello, debemos ejecutar el siguiente comando:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">audit</span> <span class="k">session</span> <span class="n">ELSIF</span> <span class="n">p_codigo</span> <span class="o">=</span> <span class="n">ever</span> <span class="k">not</span> <span class="n">successful</span><span class="p">;</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">audit</span> <span class="k">session</span> <span class="k">by</span> <span class="n">maria</span><span class="p">;</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/3.png" alt="3" /></p>

<p>Vamos a entrar en la base de datos pero, vaya… ¡nos hemos equivocado de contraseña! Pero a la tercera va la vencida y, ¡por fin! ¡Hemos accedido!</p>

<p>Si ahora comprobamos el contenido de la tabla <code class="language-plaintext highlighter-rouge">dba_audit_session</code>, veremos que se ha registrado el intento fallido:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">OS_USERNAME</span><span class="p">,</span> <span class="nb">TIMESTAMP</span><span class="p">,</span> <span class="n">ACTION_NAME</span><span class="p">,</span> <span class="n">RETURNCODE</span>
<span class="k">FROM</span> <span class="n">dba_audit_session</span>
<span class="k">WHERE</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">'MARIA'</span><span class="p">;</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/4.png" alt="4" /></p>

<p>En la imagen anterior podemos ver cuando nos hemos conectado a la base de datos y cuando hemos intentado acceder con una contraseña incorrecta. Cuando sucede esto, el valor de <code class="language-plaintext highlighter-rouge">returncode</code> es <code class="language-plaintext highlighter-rouge">ORA-01017</code>. El código <code class="language-plaintext highlighter-rouge">ORA-01017</code> significa que el usuario no existe o la contraseña es incorrecta. Si el valor de <code class="language-plaintext highlighter-rouge">returncode</code> es <code class="language-plaintext highlighter-rouge">0</code>, significa que el intento ha sido exitoso.</p>

<p>Existen otros códigos de error que nos pueden ser de utilidad a la hora de realizar auditorías. Estos códigos de error son:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ORA-00911</code>: Caracteres no válidos.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-01004</code>: Acceso denegado.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-01017</code>: Usuario o contraseña incorrectos.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-01045</code>: Sin permiso CREATE SESSION.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-28000</code>: Cuenta bloqueada.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-28001</code>: Contraseña expirada.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-28002</code>: Contraseña en periodo de caducidad.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-28003</code>: Contraseña vulnerable.</li>
  <li><code class="language-plaintext highlighter-rouge">ORA-28011</code>: Contraseña en periodo de caducidad.</li>
  <li>…etc.</li>
</ul>

<p>Pero en elsiguiente ejercicio, veremos como podemos traducir estos códigos de error a mensajes de texto comprensibles.</p>

<p>En caso de que queramos desactivar la auditoría, debemos ejecutar el siguiente comando:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">NOAUDIT</span> <span class="k">CREATE</span> <span class="k">SESSION</span> <span class="k">WHENEVER</span> <span class="k">NOT</span> <span class="n">SUCCESSFUL</span><span class="p">;</span></code></pre></figure>

<h3 id="ejercicio-2">Ejercicio 2</h3>

<p><strong>Realiza un procedimiento en PL/SQL que te muestre los accesos fallidos junto con el motivo de los mismos, transformando el código de error almacenado en un mensaje de texto comprensible. Contempla todos los motivos posibles para que un acceso sea fallido.</strong></p>

<p>Para realizar este ejercicio, vamos a crear un procedimiento en PL/SQL que nos muestre los accesos fallidos por credenciales incorrectas.</p>

<ul>
  <li>Creamos el procedimiento que nos mostrará los mensajes de error.</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">MensajesTraducidos</span> <span class="p">(</span><span class="n">p_codigo</span> <span class="n">VARCHAR2</span><span class="p">)</span>
    <span class="k">RETURN</span> <span class="n">VARCHAR2</span>
    <span class="k">IS</span>
        <span class="n">v_mensaje</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="k">BEGIN</span>
        <span class="k">CASE</span> <span class="n">p_codigo</span>
            <span class="k">WHEN</span> <span class="mi">911</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Caracteres no validos'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">1004</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Acceso denegado'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">1017</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Usuario o contrasena incorrectos'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">1033</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Usuario inexistente'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">1045</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Sin permiso CREATE SESSION'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">28000</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Cuenta bloqueada'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">28001</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Contraseña expirada'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">28002</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Contraseña en periodo de caducidad'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">28003</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Contraseña vulnerable'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">28011</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Contraseña en periodo de caducidad'</span><span class="p">;</span>
            <span class="k">WHEN</span> <span class="mi">28512</span> <span class="k">THEN</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Cuenta bloqueada'</span><span class="p">;</span>
            <span class="k">ELSE</span> <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="s1">'Error desconocido. Por favor, contacte con el administrador.'</span><span class="p">;</span>
        <span class="k">END</span> <span class="k">CASE</span><span class="p">;</span>
    <span class="k">RETURN</span> <span class="n">v_mensaje</span><span class="p">;</span>
    <span class="k">END</span><span class="p">;</span>
    <span class="o">/</span>
    </code></pre></figure>

<ul>
  <li>Creamos la cabecera del procedimiento que nos mostrará los accesos fallidos.</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">PROCEDURE</span> <span class="n">CabeceraErroresLogin</span>
    <span class="k">IS</span>
    <span class="k">BEGIN</span>
        <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'-------------------------------'</span><span class="p">);</span>
        <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'Accesos fallidos de conexion'</span><span class="p">);</span>
        <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'-------------------------------'</span><span class="p">);</span>
    <span class="k">END</span><span class="p">;</span>
    <span class="o">/</span>
    </code></pre></figure>

<ul>
  <li>Creamos el procedimiento que nos mostrará los accesos fallidos.</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">PROCEDURE</span> <span class="n">AccesosFallidos</span>
    <span class="k">IS</span>
        <span class="k">CURSOR</span> <span class="n">c_fallo</span> <span class="k">IS</span>
            <span class="k">SELECT</span> <span class="n">OS_USERNAME</span><span class="p">,</span><span class="n">RETURNCODE</span><span class="p">,</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="nb">TIMESTAMP</span>
            <span class="k">FROM</span> <span class="n">DBA_AUDIT_SESSION</span>
            <span class="k">WHERE</span> <span class="n">ACTION_NAME</span> <span class="o">=</span> <span class="s1">'LOGON'</span>
            <span class="k">AND</span> <span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">TIMESTAMP</span> <span class="k">DESC</span><span class="p">;</span>
        <span class="n">v_mensaje</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="k">BEGIN</span>
        <span class="n">CabeceraErroresLogin</span><span class="p">;</span>
        <span class="k">FOR</span> <span class="n">fallo</span> <span class="k">IN</span> <span class="n">c_fallo</span> <span class="n">LOOP</span>
            <span class="n">v_mensaje</span><span class="p">:</span><span class="o">=</span><span class="n">MensajesTraducidos</span><span class="p">(</span><span class="n">fallo</span><span class="p">.</span><span class="n">RETURNCODE</span><span class="p">);</span>
            <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'Usuario del sistema: '</span> <span class="o">||</span> <span class="n">fallo</span><span class="p">.</span><span class="n">OS_USERNAME</span><span class="p">);</span>
            <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'Usuario: '</span> <span class="o">||</span> <span class="n">fallo</span><span class="p">.</span><span class="n">USERNAME</span><span class="p">);</span>
            <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'Fecha: '</span> <span class="o">||</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">fallo</span><span class="p">.</span><span class="nb">TIMESTAMP</span><span class="p">,</span> <span class="s1">'DD/MM/YYYY HH24:MI:SS'</span><span class="p">));</span>
            <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'Codigo de error: '</span> <span class="o">||</span> <span class="n">fallo</span><span class="p">.</span><span class="n">RETURNCODE</span><span class="p">);</span>
            <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'Mensaje: '</span> <span class="o">||</span> <span class="n">v_mensaje</span><span class="p">);</span>
            <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">'- - - - -'</span><span class="p">);</span>
        <span class="k">END</span> <span class="n">LOOP</span><span class="p">;</span>
    <span class="k">END</span><span class="p">;</span>
    <span class="o">/</span>
    </code></pre></figure>

<ul>
  <li>Ejecutamos el procedimiento.</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">EXEC</span> <span class="n">AccesosFallidos</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/5.png" alt="5" /></p>

<h3 id="ejercicio-3">Ejercicio 3</h3>

<p><strong>Activa la auditoría de las operaciones DML realizadas por SCOTT. Comprueba su funcionamiento.</strong></p>

<p>En DML (Data Manipulation Language) se incluyen las sentencias que permiten modificar los datos de una base de datos. Estas sentencias son:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">INSERT</code>: Inserta un nuevo registro en una tabla.</li>
  <li><code class="language-plaintext highlighter-rouge">UPDATE</code>: Modifica los datos de un registro.</li>
  <li><code class="language-plaintext highlighter-rouge">DELETE</code>: Elimina un registro de una tabla.</li>
</ul>

<p>Estas sentencias se pueden ejecutar de forma directa o mediante un procedimiento almacenado. En este ejercicio, vamos a realizar una auditoría de las operaciones DML realizadas por el usuario <code class="language-plaintext highlighter-rouge">SCOTT</code>. Para ello, debemos ejecutar el siguiente comando:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="n">AUDIT</span> <span class="k">INSERT</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">UPDATE</span> <span class="k">TABLE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">TABLE</span> <span class="k">BY</span> <span class="n">SCOTT</span> <span class="k">BY</span> <span class="k">ACCESS</span><span class="p">;</span></code></pre></figure>

<p>Para comprobar que la auditoría se ha realizado correctamente, vamos a insertar un nuevo registro en la tabla <code class="language-plaintext highlighter-rouge">DEPT</code>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="s1">'VENTAS'</span><span class="p">,</span> <span class="s1">'MADRID'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">'COMPRAS'</span><span class="p">,</span> <span class="s1">'BARCELONA'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s1">'CONTABILIDAD'</span><span class="p">,</span> <span class="s1">'SEVILLA'</span><span class="p">);</span>
<span class="c1">---</span>
<span class="k">DELETE</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span> <span class="mi">7876</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span> <span class="mi">7902</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="n">EMP</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span> <span class="mi">7934</span><span class="p">;</span>
<span class="c1">---</span>
<span class="k">UPDATE</span> <span class="n">EMP</span> <span class="k">SET</span> <span class="n">COMM</span> <span class="o">=</span> <span class="mi">1000</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span> <span class="mi">7788</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">EMP</span> <span class="k">SET</span> <span class="n">COMM</span> <span class="o">=</span> <span class="mi">2000</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span> <span class="mi">7839</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">EMP</span> <span class="k">SET</span> <span class="n">COMM</span> <span class="o">=</span> <span class="mi">3000</span> <span class="k">WHERE</span> <span class="n">EMPNO</span> <span class="o">=</span> <span class="mi">7844</span><span class="p">;</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/6.png" alt="6" /></p>

<p>Si conectándonos con el usuario administrador, o ‘SYSDBA’, ejecutamos la siguiente sentencia:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">OBJ_NAME</span><span class="p">,</span> <span class="n">ACTION_NAME</span><span class="p">,</span> <span class="nb">TIMESTAMP</span>
<span class="k">FROM</span> <span class="n">DBA_AUDIT_TRAIL</span>
<span class="k">WHERE</span> <span class="n">USERNAME</span> <span class="o">=</span> <span class="s1">'SCOTT'</span><span class="p">;</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/7.png" alt="7" /></p>

<h3 id="ejercicio-4">Ejercicio 4</h3>

<p><strong>Realiza una auditoría de grano fino para almacenar información sobre la inserción de empleados con sueldo superior a 2000 en la tabla emp de scott.</strong></p>

<p>¿Auditoría de grano fino?</p>

<p>¡Pues claro que sí!</p>

<p>De hecho, es la auditoría que vamos a realizar en este ejercicio.</p>

<p>La auditoría de grano fino o FGA (Fine-Grained Auditing) es una característica de Oracle Database que permite registrar los cambios que se producen en los datos de una base de datos. Registrando los cambios que se producen en los datos, podemos realizar este tipo de auditoría que nos permiten conocer qué cambios se han producido en los datos, y por qué usuario se han producido.</p>

<p>Permite que las políticas de auditoría se asocien con columnas en las tablas de la aplicación junto con las condiciones necesarias para que se genere un registro de auditoría. Las políticas de FGA se asignan a las tablas de aplicaciones mediante la API de FGA. Las políticas de auditoría detalladas se pueden usar para crear registros de auditoría cuando se accede a una tabla durante períodos específicos o se accede a columnas específicas. FGA complementa la nueva auditoría unificada de Oracle Database 12c al permitir que las condiciones de auditoría se asocien con columnas específicas.</p>

<p>Los registros de seguimiento de auditoría creados por Fine Grained Auditing se pueden capturar y analizar en Oracle Audit Vault y Database Firewall, alertando automáticamente al equipo de seguridad sobre posibles actividades maliciosas.</p>

<p>El único inconveniente de esta auditoría es que requiere de una licencia adicional de Oracle Database Enterprise Edition y que para el rendimiento de la base de datos, es recomendable que se use únicamente en casos puntuales, ya que lo disminuye.</p>

<p>Pero, dejémonos de cháchara y vamos a realizar la auditoría de grano fino que nos pide el ejercicio.</p>

<p>Debemos tener en cuenta que, deberemos hacerlo en cualquier versión de Oracle, siempre y cuando esta sea superior a la 11g, ya que es a partir de esta versión donde se implementó la auditoría de grano fino.</p>

<p>Lo primero que vamos a hacer es crear un procedimiento para que, un objeto en concreto de una tabla, se audite cuando se realice una inserción en dicha tabla.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">BEGIN</span>
    <span class="n">DBMS_FGA</span><span class="p">.</span><span class="n">ADD_POLICY</span> <span class="p">(</span>
        <span class="n">object_schema</span> <span class="o">=&gt;</span> <span class="s1">'SCOTT'</span><span class="p">,</span>
        <span class="n">object_name</span> <span class="o">=&gt;</span> <span class="s1">'EMP'</span><span class="p">,</span>
        <span class="n">policy_name</span> <span class="o">=&gt;</span> <span class="s1">'AUDITAR_EMPLEADOS'</span><span class="p">,</span>
        <span class="n">audit_condition</span> <span class="o">=&gt;</span> <span class="s1">'SAL &gt; 2000'</span><span class="p">,</span>
        <span class="n">statement_types</span> <span class="o">=&gt;</span> <span class="s1">'INSERT'</span><span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/8.png" alt="8" /></p>

<p>Para la comprobación, vamos a insertar varios empleados, 1 con un salario inferior a 2000 y otro con un salario superior a 2000.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMP</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7934</span><span class="p">,</span> <span class="s1">'FRANK'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7782</span><span class="p">,</span> <span class="n">TO_DATE</span><span class="p">(</span><span class="s1">'23-01-1982'</span><span class="p">,</span> <span class="s1">'DD-MM-YYYY'</span><span class="p">),</span> <span class="mi">2100</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMP</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7935</span><span class="p">,</span> <span class="s1">'JUAN'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7782</span><span class="p">,</span> <span class="n">TO_DATE</span><span class="p">(</span><span class="s1">'23-01-1982'</span><span class="p">,</span> <span class="s1">'DD-MM-YYYY'</span><span class="p">),</span> <span class="mi">1300</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/9.png" alt="9" /></p>

<p>Ahora, vamos a comprobar que se ha realizado la auditoría de grano fino correctamente. Para ello, vamos a ejecutar la siguiente sentencia:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">DB_USER</span><span class="p">,</span> <span class="n">OBJECT_NAME</span><span class="p">,</span> <span class="n">SQL_TEXT</span><span class="p">,</span> <span class="k">CURRENT_USER</span><span class="p">,</span> <span class="nb">TIMESTAMP</span>
<span class="k">FROM</span> <span class="n">DBA_FGA_AUDIT_TRAIL</span>
<span class="k">WHERE</span> <span class="n">POLICY_NAME</span> <span class="o">=</span> <span class="s1">'AUDITAR_EMPLEADOS'</span><span class="p">;</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/10.png" alt="10" /></p>

<p>Como podemos observar, se muestra la información de la inserción de los empleados, pero solo se muestra la información del empleado que tiene un salario superior a 2000, que era el que se tenía que auditar.</p>

<h3 id="ejercicio-5">Ejercicio 5</h3>

<p><strong>Explica la diferencia entre auditar una operación by access o by session ilustrándolo con ejemplos.</strong></p>

<p>Vamos a diferenciar entre estas dos opciones de auditoría:</p>

<ul>
  <li>
    <p><strong>Auditoría by access</strong>: Cuando se realiza una auditoría by access, se registra la información de la operación que se ha realizado, pero no se registra la información del usuario que ha realizado la operación. 
Por ejemplo, si tenemos un usuario que se conecta a la base de datos y ejecuta una sentencia, la auditoría by access, registrará la información de la sentencia que se ha ejecutado, pero no registrará la información del usuario que ha ejecutado la sentencia.</p>
  </li>
  <li>
    <p><strong>Auditoría by session</strong>: Cuando se realiza una auditoría by session, se registra la información de la operación que se ha realizado, y se registra la información del usuario que ha realizado la operación.
Por ejemplo, si tenemos un usuario que se conecta a la base de datos y ejecuta una sentencia, la auditoría by session, registrará la información de la sentencia que se ha ejecutado, y registrará la información del usuario que ha ejecutado la sentencia.</p>
  </li>
</ul>

<p>Pero para probar verdaderamente su funcionamiento, vamos a insertar nuevos registros en la tabla <code class="language-plaintext highlighter-rouge">DEPT</code> de la base de datos <code class="language-plaintext highlighter-rouge">SCOTT</code> y vamos a comprobar que se ha realizado la auditoría correctamente.</p>

<h4 id="auditoría-by-session">Auditoría by session</h4>

<ul>
  <li>Activamosla auditoría en la tabla <code class="language-plaintext highlighter-rouge">DEPT</code>;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="n">AUDIT</span> <span class="k">INSERT</span><span class="p">,</span><span class="k">UPDATE</span><span class="p">,</span><span class="k">DELETE</span> <span class="k">ON</span> <span class="n">DEPT</span> <span class="k">BY</span> <span class="k">SESSION</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/11.png" alt="11" /></p>

<ul>
  <li>Realizamos la inserción de los registros en la tabla <code class="language-plaintext highlighter-rouge">DEPT</code>;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s1">'VENTAS'</span><span class="p">,</span> <span class="s1">'MADRID'</span><span class="p">);</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="s1">'COMPRAS'</span><span class="p">,</span> <span class="s1">'BARCELONA'</span><span class="p">);</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/12.png" alt="12" /></p>

<ul>
  <li>Realizamos la consulta para comprobar que se ha realizado la auditoría correctamente;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">SELECT</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">ACTION_NAME</span><span class="p">,</span> <span class="nb">TIMESTAMP</span><span class="p">,</span> <span class="n">OBJ_NAME</span>
    <span class="k">FROM</span> <span class="n">DBA_AUDIT_TRAIL</span>
    <span class="k">WHERE</span> <span class="n">USERNAME</span> <span class="o">=</span> <span class="s1">'SCOTT'</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">TIMESTAMP</span> <span class="k">DESC</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/13.png" alt="13" /></p>

<h4 id="auditoría-by-access">Auditoría by access</h4>

<ul>
  <li>Activamos la auditoría en la tabla <code class="language-plaintext highlighter-rouge">EMP</code>;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="n">AUDIT</span> <span class="k">INSERT</span><span class="p">,</span><span class="k">UPDATE</span><span class="p">,</span><span class="k">DELETE</span> <span class="k">ON</span> <span class="n">DEPT</span> <span class="k">BY</span> <span class="k">ACCESS</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/14.png" alt="14" /></p>

<ul>
  <li>Realizamos la inserción de los registros en la tabla <code class="language-plaintext highlighter-rouge">DEPT</code>;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMP</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7799</span><span class="p">,</span> <span class="s1">'CHARLES'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7799</span><span class="p">,</span> <span class="n">TO_DATE</span><span class="p">(</span><span class="s1">'23-01-1982'</span><span class="p">,</span> <span class="s1">'DD-MM-YYYY'</span><span class="p">),</span> <span class="mi">2100</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">EMP</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7987</span><span class="p">,</span> <span class="s1">'CHRIS'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7987</span><span class="p">,</span> <span class="n">TO_DATE</span><span class="p">(</span><span class="s1">'23-01-1982'</span><span class="p">,</span> <span class="s1">'DD-MM-YYYY'</span><span class="p">),</span> <span class="mi">1300</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/15.png" alt="15" /></p>

<ul>
  <li>Realizamos la consulta para comprobar que se ha realizado la auditoría correctamente;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">SELECT</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">ACTION_NAME</span><span class="p">,</span> <span class="nb">TIMESTAMP</span><span class="p">,</span> <span class="n">OBJ_NAME</span>
    <span class="k">FROM</span> <span class="n">DBA_AUDIT_OBJECT</span>
    <span class="k">WHERE</span> <span class="n">USERNAME</span> <span class="o">=</span> <span class="s1">'SCOTT'</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="nb">TIMESTAMP</span> <span class="k">DESC</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/16.png" alt="16" /></p>

<p>Para resumir es que la diferencia entre <code class="language-plaintext highlighter-rouge">BY ACCESS</code> y <code class="language-plaintext highlighter-rouge">BY SESSION</code> radica en cómo la vista del diccionario de datos DBA_AUDIT_TRAIL registra las acciones que capturan:</p>

<p>POR ACCESO: Inserta un registro en la pista de auditoría para cada declaración auditada.</p>

<p>POR SESIÓN: inserta solo un registro de auditoría en la pista de auditoría, para cada usuario y objeto de esquema, durante una sesión que incluye una acción auditada.</p>

<h3 id="ejercicio-6">Ejercicio 6</h3>

<p><strong>Documenta las diferencias entre los valores db y db_extended del parámetro audit_trail de ORACLE. Demuéstralas poniendo un ejemplo de la información sobre una operación concreta recopilada con cada uno de ellos.</strong></p>

<p>El parámetro <code class="language-plaintext highlighter-rouge">audit_trail</code> de Oracle, nos permite controlar el tipo de auditoría que se va a realizar en la base de datos. Este parámetro puede tener varios valores, pero vamos a centrarnos en los siguientes:</p>

<ul>
  <li>
    <p><strong>db</strong>: Dirige los registros de auditoría a la pista de auditoría de la base de datos (la tabla SYS.AUD$), excepto los registros que siempre se escriben en la pista de auditoría del sistema operativo. Utilice esta configuración para una base de datos general para facilitar la gestión.</p>

    <p>Si la base de datos se inició en modo de solo lectura con AUDIT_TRAIL establecido en db, Oracle Database establece internamente AUDIT_TRAIL en os. Consulte el registro de alertas para obtener más información.</p>
  </li>
  <li>
    <p><strong>db_extended</strong>: Realiza todas las acciones de AUDIT_TRAIL=db y también completa las columnas de tipo CLOB de enlace SQL y texto SQL de la tabla SYS.AUD$, cuando están disponibles. Estas dos columnas se rellenan solo cuando se especifica este parámetro. Cuando se usa la auditoría estándar con DB, EXTENDIDA, los predicados de la base de datos privada virtual (VPD) y los nombres de las políticas también se completan en la tabla SYS.AUD$.</p>

    <p>Si la base de datos se inició en modo de solo lectura con AUDIT_TRAIL establecido en db, extendido, Oracle Database establece internamente AUDIT_TRAIL en os. Consulte el registro de alertas para obtener más información.</p>
  </li>
</ul>

<p>Hasta ahora, hemos estado realizando auditoría con el parámetro <code class="language-plaintext highlighter-rouge">audit_trail</code> en el valor <code class="language-plaintext highlighter-rouge">db</code>, pero vamos a cambiarlo a <code class="language-plaintext highlighter-rouge">db_extended</code> y vamos a activarla.</p>

<ul>
  <li>Cambiamos el valor del parámetro <code class="language-plaintext highlighter-rouge">audit_trail</code> a <code class="language-plaintext highlighter-rouge">db_extended</code>, pero primero vamos a comprbar el valor actual del parámetro;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">SHOW</span> <span class="k">PARAMETER</span> <span class="n">audit_trail</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/17.png" alt="17" /></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">ALTER</span> <span class="k">SYSTEM</span> <span class="k">SET</span> <span class="n">audit_trail</span> <span class="o">=</span> <span class="n">db</span><span class="p">,</span><span class="n">extended</span> <span class="k">SCOPE</span><span class="o">=</span><span class="n">SPFILE</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/18.png" alt="18" /></p>

<ul>
  <li>Reiniciamos la base de datos;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="n">SHUTDOWN</span> <span class="k">IMMEDIATE</span><span class="p">;</span>
    <span class="n">STARTUP</span><span class="p">;</span>
    </code></pre></figure>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>![19](/images/asgdb/auditoria/19.png)
</code></pre></div></div>

<ul>
  <li>Comprobamos que el valor del parámetro <code class="language-plaintext highlighter-rouge">audit_trail</code> es <code class="language-plaintext highlighter-rouge">db_extended</code>;</li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">SHOW</span> <span class="k">PARAMETER</span> <span class="n">audit_trail</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/20.png" alt="20" /></p>

<p><img src="/images/interconexion/postgresql.png" alt="postgres" /></p>

<h3 id="ejercicio-7">Ejercicio 7</h3>

<p><strong>Averigua si en Postgres se pueden realizar los cuatro primeros apartados. Si es así, documenta el proceso adecuadamente.</strong></p>

<p>En PostgreSQL, la auditoría se realiza a travésde extensiones, como <code class="language-plaintext highlighter-rouge">pgAudit</code> o <code class="language-plaintext highlighter-rouge">Audit Trigger</code>. En este caso, vamos a utilizar la extensión <code class="language-plaintext highlighter-rouge">Audit Trigger</code>.</p>

<p>En mi caso, he decidido instalar la extensión <code class="language-plaintext highlighter-rouge">Audit Trigger</code> en la base de datos <code class="language-plaintext highlighter-rouge">postgres</code>, pero también se puede instalar en cualquier otra base de datos.</p>

<p>Su proceso de instalación es muy sencillo. Lo primero que haremos será descargarnos la extensión desde el siguiente enlace:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">wget https://raw.githubusercontent.com/2ndQuadrant/audit-trigger/master/audit.sql</code></pre></figure>

<p>Cuando tengamos la extensión descargada, ingresamos en el servidor de PostgreSQL y ejecutamos el siguiente comando:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo</span> <span class="nt">-u</span> postgres psql
<span class="se">\i</span> audit.sql</code></pre></figure>

<p><img src="/images/asgdb/auditoria/21.png" alt="21" /></p>

<ul>
  <li>
    <p>EJERCICIO 1: Auditoría de accesos exitosos.</p>

    <p>Para mostrar los usuarios activos en la base de datos, vamos a hacer uso de la vista <code class="language-plaintext highlighter-rouge">pg_stat_activity</code>, y lo haremos realizando la siguiente consulta:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">        <span class="k">SELECT</span> <span class="k">distinct</span> <span class="n">usename</span>
        <span class="k">FROM</span> <span class="n">pg_stat_activity</span>
        </code></pre></figure>

<p><img src="/images/asgdb/auditoria/22.png" alt="22" /></p>

<ul>
  <li>EJERCICIO 2: Auditoría de accesos fallidos.</li>
</ul>

<p>Para realizar la auditoría de accesos fallidos, vamos a hacer uso del log de acceso de PostgreSQL. Para ello, vamos a activar el log de acceso en el fichero de configuración de PostgreSQL, que se encuentra en la ruta <code class="language-plaintext highlighter-rouge">/etc/postgresql/9.5/main/postgresql.conf</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        <span class="nb">sudo </span>nano /etc/postgresql/9.5/main/postgresql.conf
        </code></pre></figure>

<p>Una vez dentro del fichero de configuración, vamos a buscar la siguiente línea:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        <span class="c">#log_line_prefix = ''            # special values: '%m' for timestamp, '%u' for user,</span>
        </code></pre></figure>

<p>Y la vamos a modificar de la siguiente manera:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        log_line_prefix <span class="o">=</span> <span class="s1">'%m %u %d %r %p %h %a %q '</span>
        </code></pre></figure>

<p>Y tambien vamos a modificar la siguiente linea:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        log_statement <span class="o">=</span> ‘all’
        </code></pre></figure>

<p>Para que se nos muestre el query que se esta ejecutando.</p>

<p>Una vez modificado el fichero de configuración, vamos a reiniciar el servicio de PostgreSQL.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        <span class="nb">sudo </span>service postgresql restart
        </code></pre></figure>

<p>Y comprobamos que se ha realizado la auditoría correctamente.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        <span class="nb">tail</span> <span class="nt">-f</span> /var/log/postgresql/postgresql-13-main.log
        </code></pre></figure>

<p><img src="/images/asgdb/auditoria/23.png" alt="23" /></p>

<ul>
  <li>EJERCICIO 3: Auditoría de DML.</li>
</ul>

<p>Para realizar la auditoría de DML, vamos a hacer uso de la extensión <code class="language-plaintext highlighter-rouge">Audit Trigger</code>. Para ello, vamos a crear una tabla en la base de datos <code class="language-plaintext highlighter-rouge">postgres</code> y vamos a insertar, actualizar y borrar datos de la base de datos SCOTT.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="c1">---INSERTAR DATOS</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="s1">'VENTAS'</span><span class="p">,</span> <span class="s1">'MADRID'</span><span class="p">);</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">'COMPRAS'</span><span class="p">,</span> <span class="s1">'BARCELONA'</span><span class="p">);</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">DEPT</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s1">'CONTABILIDAD'</span><span class="p">,</span> <span class="s1">'SEVILLA'</span><span class="p">);</span>
    <span class="c1">---BORRAR DATOS</span>
    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>
    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">DEPT</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="c1">---ACTUALIZAR DATOS</span>
    <span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'BARCELONA'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'SEVILLA'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">UPDATE</span> <span class="n">DEPT</span> <span class="k">SET</span> <span class="n">LOC</span> <span class="o">=</span> <span class="s1">'MADRID'</span> <span class="k">WHERE</span> <span class="n">DEPTNO</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/24.png" alt="24" /></p>

<p>Una vez realizadas estas operaciones, vamos a comprobar Audit Trigger para ver si se ha realizado la auditoría correctamente.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">select</span> <span class="n">audit</span><span class="p">.</span><span class="n">audit_table</span><span class="p">(</span><span class="s1">'DEPT'</span><span class="p">);</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/25.png" alt="25" /></p>

<p>Para visualizar los datos de la auditoría, nos loguearemos con el usuario <code class="language-plaintext highlighter-rouge">postgres</code> y, concretamente, desde la base de datos que estamos auditando, en este caso, la base de datos <code class="language-plaintext highlighter-rouge">scott</code>, ejecutamos la siguiente consulta:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">select</span> <span class="n">session_user_name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="k">table_name</span><span class="p">,</span> <span class="n">action_tstamp_clk</span><span class="p">,</span> <span class="n">client_query</span> 
    <span class="k">from</span> <span class="n">audit</span><span class="p">.</span><span class="n">logged_actions</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/26.png" alt="26" /></p>

<p>Como podemos observar en la imagen, podemos ver el usuario, la acción que ha realizado (<strong>I</strong>nsert, <strong>U</strong>pdate, <strong>D</strong>elete), la tabla en la que ha realizado la acción, la fecha y hora en la que ha realizado la acción y el query que ha ejecutado.</p>

<p><img src="/images/interconexion/mysql.png" alt="mysql" /></p>

<h3 id="ejercicio-8">Ejercicio 8</h3>

<p><strong>Averigua si en MySQL se pueden realizar los apartados 1, 3 y 4. Si es así, documenta el proceso adecuadamente.</strong></p>

<p>Para auditar en MySQL, vamos a necesitar dos bases de datos. Para hacer la aditoría vamos a recurrir de un plugin <code class="language-plaintext highlighter-rouge">server_audit</code> que nos permite auditar las acciones que se realizan en el servidor de MySQL.</p>

<p>Para instalar el plugin, deberemos ejecutar <code class="language-plaintext highlighter-rouge">INSTALL SONAME 'server_audit';</code> conectados en la base de datos.</p>

<p><img src="/images/asgdb/auditoria/27.png" alt="27" /></p>

<ul>
  <li>Ejercicio 1: Auditoría de accesos exitosos. (<strong>EXTRA</strong> Auditoría de accesos fallidos.)</li>
</ul>

<p>Tras la instalación del plugin, vamos a necesitar modificar el fichero de configuración de MySQL, que se encuentra en la ruta <code class="language-plaintext highlighter-rouge">/etc/mysql/mariadb.conf.d/50-server.cnf</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="c">#Descomentamos las siguientes lineas</span>
    general_log_file       <span class="o">=</span> /var/log/mysql/mysql.log
    general_log            <span class="o">=</span> 1
    <span class="c">#Y añadimos la siguiente linea</span>
    log_error              <span class="o">=</span> /var/log/mysql/error.log
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/28.png" alt="28" /></p>

<p>Antes de reiniciar el servicio, vamos a cambiar el propietario del fichero de log de MySQL, para que el usuario <code class="language-plaintext highlighter-rouge">mysql</code> pueda escribir en el fichero.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="nb">sudo chown </span>mysql: /var/log/mysql/
    systemctl restart mysql
    systemctl restart mariadb
    </code></pre></figure>

<p>Una vez reiniciado el servicio, vamos a comprobar que se ha realizado la auditoría correctamente. Para ello, intentaremos hacer accesos fallidos y accesos exitosos, para controlar que funciona correctamente.</p>

<p><img src="/images/asgdb/auditoria/29.png" alt="29" /></p>

<p><img src="/images/asgdb/auditoria/30.png" alt="30" /></p>

<ul>
  <li>Ejercicio 3: Auditoría de DML.</li>
</ul>

<p>El siguiente paso es editar el fichero de configuración de MySQL, que se encuentra en la ruta <code class="language-plaintext highlighter-rouge">/etc/mysql/mariadb.conf.d/50-server.cnf</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="nb">sudo </span>nano /etc/mysql/mysql.conf.d/mysqld.cnf
    </code></pre></figure>

<p>Una vez dentro del fichero de configuración, vamos a buscar la siguiente línea:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="nv">server_audit_events</span><span class="o">=</span>CONNECT,QUERY,TABLE
    <span class="nv">server_audit_logging</span><span class="o">=</span>ON
    <span class="nv">server_audit_incl_users</span><span class="o">=</span>scott
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/31.png" alt="31" /></p>

<p>Una vez modificado el fichero de configuración, vamos a reiniciar el servicio de MySQL.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="nb">sudo </span>service mysql restart
    </code></pre></figure>

<p>Nos conectamos con el usuario que queremos auditar, en este caso, el usuario <code class="language-plaintext highlighter-rouge">scott</code> y vamos a realizar las operaciones que queremos auditar.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dept</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">'COMPRAS'</span><span class="p">,</span> <span class="s1">'BARCELONA'</span><span class="p">);</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dept</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s1">'CONTABILIDAD'</span><span class="p">,</span> <span class="s1">'SEVILLA'</span><span class="p">);</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dept</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="s1">'VENTAS'</span><span class="p">,</span> <span class="s1">'MADRID'</span><span class="p">);</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/32.png" alt="32" /></p>

<p><img src="/images/asgdb/auditoria/33.png" alt="33" /></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">dept</span> <span class="k">WHERE</span> <span class="n">deptno</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">dept</span> <span class="k">WHERE</span> <span class="n">deptno</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">dept</span> <span class="k">WHERE</span> <span class="n">deptno</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/34.png" alt="34" /></p>

<p><img src="/images/asgdb/auditoria/35.png" alt="35" /></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">UPDATE</span> <span class="n">dept</span> <span class="k">SET</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">'BARCELONA'</span> <span class="k">WHERE</span> <span class="n">deptno</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">UPDATE</span> <span class="n">dept</span> <span class="k">SET</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">'SEVILLA'</span> <span class="k">WHERE</span> <span class="n">deptno</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">UPDATE</span> <span class="n">dept</span> <span class="k">SET</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">'MADRID'</span> <span class="k">WHERE</span> <span class="n">deptno</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/36.png" alt="36" /></p>

<p><img src="/images/asgdb/auditoria/37.png" alt="37" /></p>

<ul>
  <li>Ejercicio 4: Sueldo superior a 2000.</li>
</ul>

<p>Ahora vamos a auditar la tabla <code class="language-plaintext highlighter-rouge">emp</code> para que se nos muestre cuando se realice una inserción o actualización del sueldo de un empleado cuando este sea superior a 2000.</p>

<p>Nos conectamos con el usuario que queremos auditar, en este caso, el usuario <code class="language-plaintext highlighter-rouge">scott</code> y vamos a realizar las operaciones que queremos auditar.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7999</span><span class="p">,</span> <span class="s1">'JOSH'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7902</span><span class="p">,</span> <span class="s1">'1980-12-17'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">emp</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7987</span><span class="p">,</span> <span class="s1">'MERY'</span><span class="p">,</span> <span class="s1">'CLERK'</span><span class="p">,</span> <span class="mi">7902</span><span class="p">,</span> <span class="s1">'1980-12-17'</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/38.png" alt="38" /></p>

<p><img src="/images/asgdb/auditoria/39.png" alt="39" /></p>

<p><img src="/images/interconexion/mongo.png" alt="mongo" /></p>

<h3 id="ejercicio-9">Ejercicio 9</h3>

<p><strong>Averigua las posibilidades que ofrece MongoDB para auditar los cambios que va sufriendo un documento. Demuestra su funcionamiento.</strong></p>

<p>MongoDB Enterprise incluye una capacidad de auditoría para instancias mongod y mongos. La función de auditoría permite a los administradores y usuarios realizar un seguimiento de la actividad del sistema para implementaciones con múltiples usuarios y aplicaciones.</p>

<h4 id="instalación-de-mongodb-enterprise-en-debian-11">Instalación de MongoDB Enterprise en Debian 11</h4>

<ul>
  <li>Importar la clave pública utilizada por el sistema de gestión de paquetes.</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    wget <span class="nt">-qO</span> - https://www.mongodb.org/static/pgp/server-6.0.asc | <span class="nb">sudo </span>apt-key add -
    </code></pre></figure>

<ul>
  <li>Cree un archivo /etc/apt/sources.list.d/mongodb-enterprise.list para MongoDB.</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="nb">echo</span> <span class="s2">"deb http://repo.mongodb.com/apt/debian bullseye/mongodb-enterprise/6.0 main"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/mongodb-enterprise.list
    </code></pre></figure>

<ul>
  <li>Vuelva a cargar la base de datos del paquete local.</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="nb">sudo </span>apt-get update
    </code></pre></figure>

<ul>
  <li>Instale la última versión estable de MongoDB Enterprise.</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> mongodb-enterprise
        </code></pre></figure>

<ul>
  <li>Habilitar y configurar la salida de auditoría.</li>
</ul>

<p>La instalación de auditoría puede escribir eventos de auditoría en la consola, el syslog, un archivo JSON o un archivo BSON. Para habilitar la auditoría en MongoDB Enterprise, establezca un destino de salida de auditoría con <code class="language-plaintext highlighter-rouge">--auditDestination</code>.</p>

<ul>
  <li>Configuración de auditoría</li>
</ul>

<p>MongoDB Enterprise admite la auditoría de varias operaciones. Una solución de auditoría completa debe incluir todos los procesos del servidor <code class="language-plaintext highlighter-rouge">mongod</code> y los procesos <code class="language-plaintext highlighter-rouge">mongos</code> en el cluster.</p>

<p>La función de auditoría puede escribir eventos de auditoría en la consola, el syslog (la opción no está disponible en Windows), un archivo JSON o un archivo BSON.</p>

<ul>
  <li>Habilitar y configurar la salida de auditoría</li>
</ul>

<p>Para habilitar la auditoría en MongoDB Enterprise, establezca un destino de salida de auditoría con <code class="language-plaintext highlighter-rouge">--auditDestination</code>.</p>

<ul>
  <li>Salida a Syslog</li>
</ul>

<p>Para habilitar la auditoría e imprimir eventos de auditoría en el syslog (la opción no está disponible en Windows) en formato JSON, especifique syslog para la configuración –auditDestination. Por ejemplo:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    mongod <span class="nt">--dbpath</span> /data/db <span class="nt">--auditDestination</span> syslog
    </code></pre></figure>

<p>También podemos incluir opciones según nuestras necesidades. Por ejemplo, si deseamos que los clientes remotos se conecten a su implementación o si los miembros de su implementación se ejecutan en diferentes hosts, lo especificaremos con la opción <code class="language-plaintext highlighter-rouge">--bind_ip</code>.</p>

<p>También puede especificar estas opciones en el archivo de configuración:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    storage:
       dbPath: data/db
    auditLog:
       destination: syslog
    </code></pre></figure>

<ul>
  <li>Salida a la consola</li>
</ul>

<p>Para habilitar la auditoría e imprimir los eventos de auditoría en la salida estándar (es decir, stdout), especifique la consola para la configuración –auditDestination</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    mongod <span class="nt">--dbpath</span> /data/db <span class="nt">--auditDestination</span> console
    </code></pre></figure>

<p>A lo igual que en la salida a syslog, podemos especificarle la opción <code class="language-plaintext highlighter-rouge">--bind_ip</code> para que los clientes remotos se conecten a su implementación o si los miembros de su implementación se ejecutan en diferentes hosts.</p>

<p>También puede especificar estas opciones en el archivo de configuración:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    storage:
       dbPath: data/db
    auditLog:
       destination: console
    </code></pre></figure>

<ul>
  <li>Salida a un archivo JSON</li>
</ul>

<p>Para habilitar la auditoría e imprimir los eventos de auditoría en un archivo JSON, especifique el archivo para la configuración –auditDestination. Por ejemplo:</p>

<table>
  <thead>
    <tr>
      <th>Opción</th>
      <th>Valor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>–auditDestination</td>
      <td>file</td>
    </tr>
    <tr>
      <td>–auditFormat</td>
      <td>JSON</td>
    </tr>
    <tr>
      <td>–auditPath</td>
      <td>El fichero de salida. Acepta el nombre de ruta completo o el nombre de ruta relativo.</td>
    </tr>
  </tbody>
</table>

<p>Por ejemplo, lo siguiente habilita la auditoría y registra los eventos de auditoría en un archivo con el nombre de ruta relativa <code class="language-plaintext highlighter-rouge">data/db/auditLog.json</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    mongod <span class="nt">--dbpath</span> data/db <span class="nt">--auditDestination</span> file <span class="nt">--auditFormat</span> JSON <span class="nt">--auditPath</span> data/db/auditLog.json
    </code></pre></figure>

<p>El archivo de auditoría se puede rotar con el comando <code class="language-plaintext highlighter-rouge">logRotate</code>, ya sea junto con el registro del servidor o de forma independiente. Los detalles de la rotación se pueden configurar con la opción de archivo de configuración <code class="language-plaintext highlighter-rouge">systemLog.logRotate</code> o la opción de línea de comandos <code class="language-plaintext highlighter-rouge">--logRotate</code>.</p>

<p>También puede especificar estas opciones en el archivo de configuración:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    storage:
       dbPath: data/db
    auditLog:
       destination: file
       format: JSON
       path: data/db/auditLog.json
    </code></pre></figure>

<ul>
  <li>Salida a un archivo BSON</li>
</ul>

<p>Para habilitar la auditoría e imprimir los eventos de auditoría en un archivo BSON, especifique el archivo para la configuración –auditDestination. Por ejemplo:</p>

<table>
  <thead>
    <tr>
      <th>Opción</th>
      <th>Valor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>–auditDestination</td>
      <td>file</td>
    </tr>
    <tr>
      <td>–auditFormat</td>
      <td>BSON</td>
    </tr>
    <tr>
      <td>–auditPath</td>
      <td>El fichero de salida. Acepta el nombre de ruta completo o el nombre de ruta relativo.</td>
    </tr>
  </tbody>
</table>

<p>Por ejemplo, lo siguiente habilita la auditoría y registra los eventos de auditoría en un archivo con el nombre de ruta relativa <code class="language-plaintext highlighter-rouge">data/db/auditLog.bson</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">        mongod <span class="nt">--dbpath</span> data/db <span class="nt">--auditDestination</span> file <span class="nt">--auditFormat</span> BSON <span class="nt">--auditPath</span> data/db/auditLog.bson
        </code></pre></figure>

<p>A lo igual que en los anteriores casos, podemos especificarle la opción <code class="language-plaintext highlighter-rouge">--bind_ip</code> para que los clientes remotos se conecten a su implementación o si los miembros de su implementación se ejecutan en diferentes hosts.</p>

<p>El archivo de auditoría se puede rotar con el comando <code class="language-plaintext highlighter-rouge">logRotate</code>, ya sea junto con el registro del servidor o de forma independiente. Los detalles de la rotación se pueden configurar con la opción de archivo de configuración <code class="language-plaintext highlighter-rouge">systemLog.logRotate</code> o la opción de línea de comandos <code class="language-plaintext highlighter-rouge">--logRotate</code>.</p>

<p>También puede especificar estas opciones en el archivo de configuración:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    storage:
       dbPath: data/db
    auditLog:
       destination: file
       format: BSON
       path: data/db/auditLog.bson
    </code></pre></figure>

<p>El siguiente ejemplo convierte el registro de auditoría en un formato legible mediante bsondump y genera el resultado:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    bsondump <span class="nt">--file</span> auditLog.bson
    </code></pre></figure>

<p>En mi caso, de las opciones anteriores, he decidido utilizar la salida a un archivo JSON. Para ello, hemos ejecutado el siguiente comando en nuestra consola:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mongod <span class="nt">--dbpath</span> /var/lib/mongodb/ <span class="nt">--auditDestination</span> file <span class="nt">--auditFormat</span> JSON <span class="nt">--auditPath</span> /var/lib/mongodb/auditLog.json</code></pre></figure>

<p><img src="/images/asgdb/auditoria/40.png" alt="40" /></p>

<p>Una vez configurado, vamos a comprobar que la auditoría funciona de forma correcta mirando los logs que se han generado de MongoDB en el fichero <code class="language-plaintext highlighter-rouge">auditLog.json</code>. Pero para leer el fichero, necesitamos un programa que nos permita leerlo. En mi caso, he utilizado el programa <code class="language-plaintext highlighter-rouge">jq</code> que nos permite leer ficheros JSON de forma sencilla.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt <span class="nb">install </span>jq</code></pre></figure>

<p><img src="/images/asgdb/auditoria/41.png" alt="41" /></p>

<p>Una vez instalado, vamos a comprobar que la auditoría funciona de forma correcta mirando los logs que se han generado de MongoDB en el fichero <code class="language-plaintext highlighter-rouge">auditLog.json</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat</span> /var/lib/mongodb/auditLog.json | jq</code></pre></figure>

<p><img src="/images/asgdb/auditoria/42.png" alt="42" /></p>

<p>Para darle un poco de movimiento a la auditoría, vamos a crear una base de datos y una colección. Para ello, vamos a utilizar el cliente de MongoDB que hemos instalado en el servidor.</p>

<ul>
  <li>Creamos el usuario:</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    mongosh 
    use admin
    db.createUser<span class="o">({</span>user: <span class="s1">'admin'</span>, <span class="nb">pwd</span>: <span class="s1">'admin'</span>, roles: <span class="o">[{</span>role: <span class="s1">'userAdminAnyDatabase'</span>, db: <span class="s1">'admin'</span><span class="o">}</span>, <span class="o">{</span>role: <span class="s1">'readWriteAnyDatabase'</span>, db: <span class="s1">'admin'</span><span class="o">}]})</span> 
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/43.png" alt="43" /></p>

<ul>
  <li>Creamos la colección</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    mongosh <span class="nt">-u</span> admin <span class="nt">-p</span> admin <span class="nt">--authenticationDatabase</span> admin
    use auditoria
    db.createCollection<span class="o">(</span><span class="s2">"Alumnos"</span><span class="o">)</span>
    db.createCollection<span class="o">(</span><span class="s2">"Profesores"</span><span class="o">)</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/44.png" alt="44" /></p>

<ul>
  <li>Creamos inserciones</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.Alumnos.insertOne<span class="o">({</span>nombre: <span class="s2">"Juan"</span>, apellidos: <span class="s2">"Pérez"</span>, edad: 20<span class="o">})</span>
    db.Alumnos.insertOne<span class="o">({</span>nombre: <span class="s2">"Ana"</span>, apellidos: <span class="s2">"García"</span>, edad: 21<span class="o">})</span>
    db.Alumnos.insertMany<span class="o">([{</span>nombre: <span class="s2">"Pedro"</span>, apellidos: <span class="s2">"González"</span>, edad: 22<span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"María"</span>, apellidos: <span class="s2">"Martínez"</span>, edad: 23<span class="o">}])</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/45.png" alt="45" /></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.Profesores.insertOne<span class="o">({</span>nombre: <span class="s2">"Luis"</span>, apellidos: <span class="s2">"García"</span>, edad: 40<span class="o">})</span>
    db.Profesores.insertOne<span class="o">({</span>nombre: <span class="s2">"María"</span>, apellidos: <span class="s2">"González"</span>, edad: 41<span class="o">})</span>
    db.Profesores.insertMany<span class="o">([{</span>nombre: <span class="s2">"Antonio"</span>, apellidos: <span class="s2">"Martínez"</span>, edad: 42<span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Ana"</span>, apellidos: <span class="s2">"Pérez"</span>, edad: 43<span class="o">}])</span>
    db.Profesores.insertMany<span class="o">([{</span>nombre: <span class="s2">"Luis"</span>, apellidos: <span class="s2">"García"</span>, edad: 40<span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"María"</span>, apellidos: <span class="s2">"González"</span>, edad: 41<span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Antonio"</span>, apellidos: <span class="s2">"Martínez"</span>, edad: 42<span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Ana"</span>, apellidos: <span class="s2">"Pérez"</span>, edad: 43<span class="o">}])</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/46.png" alt="46" /></p>

<ul>
  <li>Creamos un rol</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.createRole<span class="o">({</span> role: <span class="s2">"director"</span>,privileges: <span class="o">[{</span> resource: <span class="o">{</span> db: <span class="s2">"auditoria"</span>, collection: <span class="s2">""</span> <span class="o">}</span>, actions: <span class="o">[</span> <span class="s2">"find"</span>, <span class="s2">"insert"</span>, <span class="s2">"update"</span>, <span class="s2">"remove"</span> <span class="o">]</span> <span class="o">}]</span>, roles: <span class="o">[]</span> <span class="o">})</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/47.png" alt="47" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Y se lo asignamos a un nuevo usuario:
</code></pre></div></div>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.createUser<span class="o">({</span>user: <span class="s1">'director'</span>, <span class="nb">pwd</span>: <span class="s1">'director'</span>, roles: <span class="o">[{</span>role: <span class="s1">'director'</span>, db: <span class="s1">'auditoria'</span><span class="o">}]})</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/48.png" alt="48" /></p>

<p>Para añadir más contenido a nuestra auditoría, vamos a realizar búsquedas con el usuario <code class="language-plaintext highlighter-rouge">director</code> que hemos creado.</p>

<ul>
  <li>Buscamos todos los alumnos</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.Alumnos.find<span class="o">()</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/49.png" alt="49" /></p>

<ul>
  <li>Buscamos todos los profesores</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.Profesores.find<span class="o">()</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/50.png" alt="50" /></p>

<ul>
  <li>Buscamos a los alumnos que se llamen Ana</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    db.Alumnos.find<span class="o">({</span>nombre: <span class="s2">"Ana"</span><span class="o">})</span>
    </code></pre></figure>

<p><img src="/images/asgdb/auditoria/51.png" alt="51" /></p>

<p>Ahora, vamos a comprobar que la auditoría funciona de forma correcta mirando los logs que se han generado de MongoDB en el fichero <code class="language-plaintext highlighter-rouge">auditLog.json</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat</span> /var/lib/mongodb/auditLog.json | jq</code></pre></figure>

<ul>
  <li>Creación de la colección y su correspondiente índice.</li>
</ul>

<p><img src="/images/asgdb/auditoria/52.png" alt="52" /></p>

<ul>
  <li>Creación del rol y del usuario.</li>
</ul>

<p><img src="/images/asgdb/auditoria/53.png" alt="53" /></p>

<p><img src="/images/asgdb/auditoria/54.png" alt="54" /></p>

<ul>
  <li>Login con el nuevo usuario</li>
</ul>

<p><img src="/images/asgdb/auditoria/55.png" alt="55" /></p>

<ul>
  <li>Desconexion del usuario</li>
</ul>

<p><img src="/images/asgdb/auditoria/56.png" alt="56" /></p>

<h3 id="ejercicio-10">Ejercicio 10</h3>

<p><strong>Averigua si en MongoDB se pueden auditar los accesos a una colección concreta. Demuestra su funcionamiento.</strong></p>

<p>En MongDB, podemos auditar los accesos a una colección concreta mediante la ejecución del siguiente comando:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">db.setLogLevel<span class="o">(</span>level, component<span class="o">)</span></code></pre></figure>

<p>Con él, podemos ver los accesos a la colección que se esté utilizando en ese momento. Para ello, vamos a crear una base de datos, una coleccion y utilizaremos nuevo usuario administrador para realizar las operaciones.</p>

<p>Con esto, se establece un único nivel de detalle para los mensajes de registro.</p>

<p>db.setLogLevel() toma los siguientes parámetros:</p>

<table>
  <thead>
    <tr>
      <th>Parámetro</th>
      <th>Tipo</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>level</td>
      <td>Número entero</td>
      <td>El nivel de detalle de los mensajes de registro. Los valores posibles son: <strong>0</strong> (ninguno), <strong>1</strong> (errores), <strong>2</strong> (errores y advertencias), <strong>3</strong> (errores, advertencias y mensajes informativos), <strong>4</strong> (errores, advertencias, mensajes informativos y mensajes de depuración).</td>
    </tr>
    <tr>
      <td>component</td>
      <td>Cadena</td>
      <td>El componente para el que se establece el nivel de detalle. Los valores posibles son: “accessControl”, “command”, “index”, “query”, “replication”, “sharding”, “storage”, “write”, “audit”, “cluster”, “control”, “ftdc”, “geo”, “network”, “query”, “repl”, “security”, “sharding”, “storage”, “write”.</td>
    </tr>
  </tbody>
</table>

<p>En cuanto a su comportamiento, establece un único nivel de verbosidad. Para establecer varios niveles de detalle en una sola operación, tendremos que utilizar el comando <code class="language-plaintext highlighter-rouge">setParameter</code> para establecer el parámetro <code class="language-plaintext highlighter-rouge">logComponentVerbosity</code>. También puede especificar la configuración de verbosidad en el archivo de configuración.</p>

<p>Para llevar a cabo el ejercicio, vamos a ejecutar el siguiente comando:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">db.setLogLevel<span class="o">(</span>3, <span class="s2">"accessControl"</span><span class="o">)</span></code></pre></figure>

<p>Pero, ¿qué significa esto? Pues que se establece un nivel de detalle (verbosidad) de 3 para el componente <code class="language-plaintext highlighter-rouge">accessControl</code>. Esto quiere decir que se mostrarán los mensajes de error, advertencia e información.</p>

<p>Vamos a loguearnos con el usuario <code class="language-plaintext highlighter-rouge">admin</code> que hemos creado anteriormente y vamos crear un nuevo usuario administrador.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Accedemos a la consola de mongo</span>
mongo <span class="nt">-u</span> admin <span class="nt">-p</span> admin <span class="nt">--authenticationDatabase</span> admin
<span class="c"># Accedemos a la base de datos</span>
use audit
<span class="c"># Creamos un nuevo usuario administrador</span>
db.createUser <span class="o">({</span>user: <span class="s1">'asir'</span>, <span class="nb">pwd</span>: <span class="s1">'admin'</span>, roles: <span class="o">[{</span>role: <span class="s1">'root'</span>, db: <span class="s1">'admin'</span><span class="o">}]})</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/57.png" alt="57" /></p>

<p>Ahora nos conectaremos con el nuevo usuario que hemos creado.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mongosh <span class="nt">-u</span> asir <span class="nt">-p</span> admin <span class="nt">--authenticationDatabase</span> admin</code></pre></figure>

<p>Y creamos una dos colecciones, <code class="language-plaintext highlighter-rouge">1curso</code> y <code class="language-plaintext highlighter-rouge">2curso</code> e insertaremos las siguientes asignaturas:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">use asir
db.createCollection<span class="o">(</span><span class="s2">"Primero"</span><span class="o">)</span>
db.createCollection<span class="o">(</span><span class="s2">"Segundo"</span><span class="o">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">db.Primero.insertMany<span class="o">([{</span>nombre: <span class="s2">"Sistemas Operativos"</span>, horas: <span class="s2">"6"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Lenguajes de Marcas"</span>, horas: <span class="s2">"4"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Redes"</span>, horas: <span class="s2">"5"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Bases de Datos"</span>, horas: <span class="s2">"6"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Formación y Orientación Laboral"</span>, horas: <span class="s2">"4"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Fundamento de hardware"</span>, horas: <span class="s2">"4"</span><span class="o">}])</span>

db.Segundo.insertMany<span class="o">([{</span>nombre: <span class="s2">"Implantación de Aplicaciones Web"</span>, horas: <span class="s2">"6"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Cloud Computing"</span>, horas: <span class="s2">"4"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Seguridad Informática"</span>, horas: <span class="s2">"3"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Empresa e Iniciativa Emprendedora"</span>, horas: <span class="s2">"4"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Administración de Sistemas Operativos"</span>, horas: <span class="s2">"6"</span><span class="o">}</span>, <span class="o">{</span>nombre: <span class="s2">"Administración de Sistemas Gestores de Bases de Datos"</span>, horas: <span class="s2">"3"</span><span class="o">}])</span></code></pre></figure>

<p><img src="/images/asgdb/auditoria/58.png" alt="58" /></p>

<p><img src="/images/asgdb/auditoria/59.png" alt="59" /></p>

<p>Ejecutamos el comando <code class="language-plaintext highlighter-rouge">db.setLogLevel(3, "accessControl")</code> para ver los accesos a la colección que se esté utilizando en ese momento.</p>

<p><img src="/images/asgdb/auditoria/60.png" alt="60" /></p>

<p>Para la comprobación de su funcionamiento, he realizado 1 login corecto y otro incorrecto.</p>

<p><img src="/images/asgdb/auditoria/61.png" alt="61" /></p>

<p>Y como podemos comprobar en la siguiente imagen:</p>

<p><img src="/images/asgdb/auditoria/62.png" alt="62" /></p>

<p>…se ha registrado el acceso correcto y el incorrecto.</p>

      <div class="c-article__footer u-clearfix">
        <div class="c-article__tag">
          
          <a href="/tags#oracle">&#35; oracle</a>
          
          <a href="/tags#auditoria">&#35; auditoria</a>
          
          <a href="/tags#sql">&#35; sql</a>
          
          <a href="/tags#plsql">&#35; plsql</a>
          
          <a href="/tags#mongodb">&#35; mongodb</a>
          
          <a href="/tags#mysql">&#35; mysql</a>
          
          <a href="/tags#postgresql">&#35; postgresql</a>
          
        </div>
      </div>
      </div> <!-- /.c-recent-post -->
    </div> <!-- /.c-wrap-content -->
  </div> <!-- /.c-article__content -->
</article> <!-- /.c-article-page -->
</main> <!-- /.c-content -->

  </div> <!-- /.o-wrapper -->
  <div class="c-top" data-icon='ei-chevron-up' data-size='s' title="Scroll To Top"></div> <!-- /.c-top -->
  <script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/evil-icons.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script src="/js/simple-jekyll-search.min.js"></script>
<script src="/js/main.js"></script>
<!-- /javascripts -->
</body>
</html>