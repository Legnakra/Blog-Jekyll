<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2023-01-15T21:35:39+01:00</updated><id>/feed.xml</id><title type="html">sysmaria</title><subtitle>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</subtitle><entry><title type="html">Servidor de correo en los servidores de clase</title><link href="/hlc+sri/2023/01/10/correo.html" rel="alternate" type="text/html" title="Servidor de correo en los servidores de clase" /><published>2023-01-10T11:59:07+01:00</published><updated>2023-01-10T11:59:07+01:00</updated><id>/hlc+sri/2023/01/10/correo</id><content type="html" xml:base="/hlc+sri/2023/01/10/correo.html"><![CDATA[<p>En este post, vamos a implementar en nuestro <a href="https://sysmaria.netlify.app/hlc+sri/2022/12/05/escenario.html">escenario</a> un servidor de correo.</p>

<p><img src="/assets/images/escenario/escenario.png" alt="Escenario" /></p>

<h1 id="ejercicio-1">Ejercicio 1</h1>

<p>Instalaremos y configuraremos un servidor de correo en <code class="language-plaintext highlighter-rouge">delta</code>. El nombre del sistema de correo será nuestro nombre de dominio <code class="language-plaintext highlighter-rouge">maria.gonzalonazareno.org</code>.</p>

<p>Utilizando la utilidad mail manda un correo desde un usuario del servidor a otro usuario del servidor. El usuario destinatario debe leer el correo con el mismo programa.</p>

<h1 id="ejercicio-2">Ejercicio 2</h1>

<p>Configura tu servidor de correo para que use como relay el servidor de correo de nuestra <code class="language-plaintext highlighter-rouge">red babuino-smtp.gonzalonazareno.org</code>. Con la utilidad <code class="language-plaintext highlighter-rouge">mail</code> envía un correo a tu cuenta personal de gmail, hotmail,…</p>

<p>Muestra el log del sistema donde se comprueba que el correo se ha enviado con éxito.</p>

<p>Comprueba las cabeceras del correo que has recibido e indica donde vemos los servidores por los que ha pasado el correo.</p>

<h1 id="ejercicio-3">Ejercicio 3</h1>

<p>En este ejercicio debemos responder desde nuestra cuenta de correo personal al correo que recibimos en el ejercicio anterior. Recuerda que para que todo funcione debemos indicarle al profesor el nombre de tu dominio para que configure de manera adecuada el parámetro <code class="language-plaintext highlighter-rouge">relay_domains</code> en <code class="language-plaintext highlighter-rouge">babuino-smtp</code>. Además debes configurar de manera adecuada el registro MX de tu servidor DNS.</p>

<p>Muestra el log del sistema donde se comprueba que el correo se ha recibido con éxito.</p>

<h1 id="comprobación">Comprobación</h1>

<ol>
  <li>
    <p>Prueba de funcionamiento del ejercicio1. Se debe mostrar el log para asegurarse que se ha enviado el correo.</p>
  </li>
  <li>
    <p>Muestra las cabeceras del correo recibido en el ejercicio 2 mostrando las cabeceras donde vemos los servidores por los que ha pasado el correo</p>
  </li>
  <li>
    <p>Muestra el log del sistema donde se comprueba que el correo se ha recibido con éxito en el ejercicio 3</p>
  </li>
  <li>
    <p><strong>Ejercicio propuesto por elprofesor</strong>:</p>
  </li>
</ol>]]></content><author><name></name></author><category term="HLC+SRI" /><summary type="html"><![CDATA[En este post, vamos a implementar en nuestro escenario un servidor de correo.]]></summary></entry><entry><title type="html">Desarrollo y despliegue de una aplicación Java simple</title><link href="/iaw/2023/01/09/java-simple.html" rel="alternate" type="text/html" title="Desarrollo y despliegue de una aplicación Java simple" /><published>2023-01-09T12:47:17+01:00</published><updated>2023-01-09T12:47:17+01:00</updated><id>/iaw/2023/01/09/java-simple</id><content type="html" xml:base="/iaw/2023/01/09/java-simple.html"><![CDATA[<p>En este post vamos a crear una aplicación Java simple y desplegarla en un servidor Tomcat con Maven.</p>

<p><strong>Tomcat</strong> es un servidor web que permite ejecutar aplicaciones Java. En este post vamos a ver como desplegar una aplicación Java en un servidor Tomcat.</p>

<p>Mientras que <strong>Maven</strong> es una herramienta de construcción de software que nos permite gestionar el ciclo de vida de un proyecto Java. En este post vamos a ver como crear un proyecto Java con Maven.</p>

<h2 id="escenario">Escenario</h2>
<ol>
  <li>
    <p>Instala tomcat9 como hemos visto en la documentación.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> apt <span class="nb">install </span>tomcat9 tomcat9-admin
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configuramos el panel de administración Tomcat-Manager y configúralo para su acceso.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> nano /etc/tomcat9/tomcat-users.xml
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;tomcat-users&gt;</span>
     <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"manager-gui"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">"tomcat"</span> <span class="na">password=</span><span class="s">"s3cret"</span> <span class="na">roles=</span><span class="s">"manager-gui"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/tomcat-users&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Instala la aplicación maven que nos va a ayudar a compilar aplicaciones java.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> apt <span class="nb">install </span>maven
</code></pre></div>    </div>
  </li>
  <li>
    <p>A continuación vamos a generar un proyecto, que será el esqueleto de nuestra aplicación Java, para ello ejecutamos:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mvn archetype:generate <span class="nt">-DgroupId</span><span class="o">=</span>com.app.example <span class="nt">-DartifactId</span><span class="o">=</span>java-app <span class="nt">-DarchetypeArtifactId</span><span class="o">=</span>maven-archetype-quickstart <span class="nt">-DinteractiveMode</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>    </div>

    <p>La estructura de nuestro directorio sería la siguiente:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> java-app/
 ├── pom.xml
 └── src
     ├── main
     │   ├── java
     │   │   └── com
     │   │       └── app
     │   │           └── example
     │   │               └── App.java
     │   └── resources
     └── <span class="nb">test</span>
         └── java
             └── com
                 └── app
                     └── example
                         └── AppTest.java
</code></pre></div>    </div>
  </li>
  <li>
    <p>Modificamos el fichero <code class="language-plaintext highlighter-rouge">java-app/pom.xml</code> para que tenga la siguiente estructura:</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="cp">&lt;?xml version = "1.0" encoding = "UTF-8"?&gt;</span>
     <span class="nt">&lt;project</span> <span class="na">xmlns =</span> <span class="s">"http://maven.apache.org/POM/4.0.0"</span> 
        <span class="na">xmlns:xsi =</span> <span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>

     <span class="na">xsi:schemaLocation =</span> <span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

        <span class="nt">&lt;groupId&gt;</span>com.tutorialspoint<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>hello-world<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>

        <span class="nt">&lt;parent&gt;</span>
           <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
           <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
           <span class="nt">&lt;version&gt;</span>2.3.0.RELEASE<span class="nt">&lt;/version&gt;</span>
           <span class="nt">&lt;relativePath/&gt;</span> 
        <span class="nt">&lt;/parent&gt;</span>

        <span class="nt">&lt;properties&gt;</span>
           <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
           <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
           <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
           <span class="nt">&lt;tomcat.version&gt;</span>9.0.37<span class="nt">&lt;/tomcat.version&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>

        <span class="nt">&lt;dependencies&gt;</span>
           <span class="nt">&lt;dependency&gt;</span>
              <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
              <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
           <span class="nt">&lt;/dependency&gt;</span>
           <span class="nt">&lt;dependency&gt;</span>  
              <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>  
     	 <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>  
     	 <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>  
           <span class="nt">&lt;/dependency&gt;</span>   
           <span class="nt">&lt;dependency&gt;</span>
              <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
              <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
           <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;/dependencies&gt;</span>

        <span class="nt">&lt;build&gt;</span>
           <span class="nt">&lt;plugins&gt;</span>
              <span class="nt">&lt;plugin&gt;</span>
                 <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                 <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;/plugin&gt;</span>
           <span class="nt">&lt;/plugins&gt;</span>
        <span class="nt">&lt;/build&gt;</span>

     <span class="nt">&lt;/project&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Construimos la aplicación, y para ello modificamos el fichero <code class="language-plaintext highlighter-rouge">src/main/java/com/app/example/App.java</code> para que tenga la siguiente estructura:</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">package</span> <span class="nn">com.app.example</span><span class="o">;</span>

 <span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.boot.builder.SpringApplicationBuilder</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.boot.web.servlet.support.SpringBootServletInitializer</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
 <span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

 <span class="nd">@SpringBootApplication</span>
 <span class="nd">@RestController</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="kd">extends</span> <span class="nc">SpringBootServletInitializer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">SpringApplicationBuilder</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">SpringApplicationBuilder</span> <span class="n">application</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">application</span><span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="nc">App</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">App</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">hello</span><span class="o">()</span> <span class="o">{</span>
       <span class="k">return</span> <span class="s">"&lt;center&gt;Hola mundo!!!&lt;/center&gt;"</span><span class="o">;</span>
    <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Construimos la aplicación, y para ello ejecutamos:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mvn package
</code></pre></div>    </div>
  </li>
  <li>
    <p>Copiamos el fichero <code class="language-plaintext highlighter-rouge">java-app/target/hello-world-1.war</code> a la carpeta <code class="language-plaintext highlighter-rouge">/var/lib/tomcat9/webapps/</code> y reiniciamos el servicio de tomcat9.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> systemctl restart tomcat9
</code></pre></div>    </div>

    <p><img src="/assets/images/java-simple/1.png" alt="1" /></p>
  </li>
</ol>

<h2 id="comprobación">Comprobación</h2>
<p>Si accedemos a la ip de nuestro servidor, veremos el mensaje <code class="language-plaintext highlighter-rouge">Hola mundo!!!</code> en el navegador.</p>

<p><img src="/assets/images/java-simple/2.png" alt="2" /></p>

<p>Y si accedemos al Tomcat-Manager, veremos que la aplicación se ha desplegado correctamente.</p>

<p><img src="/assets/images/java-simple/3.png" alt="3" /></p>]]></content><author><name></name></author><category term="IAW" /><summary type="html"><![CDATA[En este post vamos a crear una aplicación Java simple y desplegarla en un servidor Tomcat con Maven.]]></summary></entry><entry><title type="html">VPN con OpenVPN y certificados x509</title><link href="/seguridad/2023/01/09/vpn.html" rel="alternate" type="text/html" title="VPN con OpenVPN y certificados x509" /><published>2023-01-09T12:47:17+01:00</published><updated>2023-01-09T12:47:17+01:00</updated><id>/seguridad/2023/01/09/vpn</id><content type="html" xml:base="/seguridad/2023/01/09/vpn.html"><![CDATA[<h1 id="qué-es-una-vpn-y-para-qué-sirve">Qué es una VPN y para qué sirve</h1>

<p>Una VPN (Virtual Private Network) es una red privada virtual que permite conectar dos o más redes privadas entre sí a través de una red pública como Internet. Las VPNs son muy útiles para conectar redes privadas a través de Internet de forma segura, ya que los datos que se transmiten a través de una VPN están cifrados y protegidos de forma que sólo los usuarios autorizados pueden acceder a ellos.</p>

<h1 id="acceso-remoto-con-openvpn-y-certificados-x509">Acceso remoto con OpenVPN y certificados x509</h1>

<p>En este apartado vamos a realizar un VPN de acceso remoto con OpenVPN y certificados x509. Para ello vamos a utilizar una máquina virtual en Proxmox con Debian 11.</p>

<h2 id="creamos-la-clave-privada-y-realizamos-la-firma-de-la-misma">Creamos la clave privada y realizamos la firma de la misma</h2>

<ol>
  <li>Creamos nuestra clave desde root:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> openssl genrsa 4096 <span class="o">&gt;</span> /etc/ssl/private/openvpn.key
</code></pre></div>    </div>
  </li>
  <li>Creamos el certificado de la clave privada:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> openssl req <span class="nt">-new</span> <span class="nt">-key</span> /etc/ssl/private/openvpn.key <span class="nt">-out</span> /root/openvpn.csr

 Country Name <span class="o">(</span>2 letter code<span class="o">)</span> <span class="o">[</span>AU]:ES
 State or Province Name <span class="o">(</span>full name<span class="o">)</span> <span class="o">[</span>Some-State]:Sevilla
 Locality Name <span class="o">(</span>eg, city<span class="o">)</span> <span class="o">[]</span>:Dos Hermanas
 Organization Name <span class="o">(</span>eg, company<span class="o">)</span> <span class="o">[</span>Internet Widgits Pty Ltd]:Maria
 Organizational Unit Name <span class="o">(</span>eg, section<span class="o">)</span> <span class="o">[]</span>:ASIR2
 Common Name <span class="o">(</span>e.g. server FQDN or YOUR name<span class="o">)</span> <span class="o">[]</span>:vpn-maria
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="configuramos-el-servidor-openvpn">Configuramos el servidor OpenVPN</h2>

<ol>
  <li>Instalamos el paquete openvpn:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> apt <span class="nb">install </span>openvpn
</code></pre></div>    </div>
  </li>
  <li>Creamos el directorio de configuración:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">mkdir</span> /etc/openvpn
</code></pre></div>    </div>
  </li>
  <li>Creamos el fichero de configuración del servidor:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> nano /etc/openvpn/server.conf
</code></pre></div>    </div>
  </li>
  <li>Añadimos la siguiente configuración:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> dev tun
 remote vpn-maria
 ifconfig ip_servidor ip_cliente
 pull
 proto tcp-client
 tls-client
 remote-cert-tls server
 ca /etc/ssl/certs/openvpn.crt
 cert /etc/openvpn/openvpn.crt
 key /etc/ssl/private/openvpn.key
 comp-lzo
 keepalive 10 60
 log /var/log/openvpn.log
 verb 3
</code></pre></div>    </div>
  </li>
  <li>Reinicio el servicio:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> systemctl restart openvpn
</code></pre></div>    </div>
  </li>
  <li>Comprobamos que el servicio está activo:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ip route
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="configuracion-del-servidor-openvpn-entre-dos-equipos-en-el-cloud">Configuracion del servidor OpenVPN entre dos equipos en el cloud.</h2>

<p>Uno de los dos equipos (el que actuará como servidor) estará conectado a dos redes.</p>

<p>Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con  los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.</p>

<p>Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La dirección 10.99.99.1 se asignará al servidor VPN.</p>

<p>Los ficheros de configuración del servidor y del cliente se crearán en el directorio /etc/openvpn de cada máquina, y se llamarán servidor.conf y cliente.conf respectivamente.</p>

<p>Tras el establecimiento de la VPN, la máquina cliente debe ser capaz de acceder a una máquina que esté en la otra red a la que está conectado el servidor.</p>

<h3 id="proceso-de-configuración-del-escenario">Proceso de configuración del escenario</h3>

<ol>
  <li></li>
  <li></li>
  <li></li>
</ol>

<h1 id="acceso-remoto-site-to-site-con-openvpn-y-certificados-x509">Acceso remoto site to site con OpenVPN y certificados x509</h1>

<p>En este apartado vamos a realizar un VPN de acceso remoto site to site con OpenVPN y certificados x509. Para ello vamos a utilizar una máquina virtual en Proxmox con Debian 11.</p>

<h2 id="configuracion-del-servidor-openvpn-entre-dos-equipos-en-el-cloud-1">Configuracion del servidor OpenVPN entre dos equipos en el cloud.</h2>

<p>Cada equipo estará conectado a dos redes, una de ellas en común</p>

<p>Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con con los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.</p>

<p>Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN.</p>

<p>Tras el establecimiento de la VPN, una máquina de cada red detrás de cada servidor VPN debe ser capaz de acceder a una máquina del otro extremo.</p>

<h1 id="acceso-remoto-con-wireguard">Acceso remoto con Wireguard</h1>

<p>En este apartado vamos amontar un acceso remoto, pero esta vez lo vamos a realizar con <strong>Wireguard</strong>. Para ello vamos a utilizar una máquina virtual en Proxmox con Debian 11. Para comprobar su funcionamiento vamos a utilizar clientes Windows, Linux y Android.</p>]]></content><author><name></name></author><category term="SEGURIDAD" /><summary type="html"><![CDATA[Qué es una VPN y para qué sirve]]></summary></entry><entry><title type="html">Despliegue de aplicaciones Java</title><link href="/iaw/2023/01/09/java-cms.html" rel="alternate" type="text/html" title="Despliegue de aplicaciones Java" /><published>2023-01-09T12:47:17+01:00</published><updated>2023-01-09T12:47:17+01:00</updated><id>/iaw/2023/01/09/java-cms</id><content type="html" xml:base="/iaw/2023/01/09/java-cms.html"><![CDATA[<p>En este post vamos a realizar el despliegue de una aplicación Java en nuestro VPS. Para ello, vamos a utilizar el servidor web Apache Tomcat.</p>

<h1 id="instalación-de-tomcat">Instalación de Tomcat</h1>

<p>Para instalar Tomcat, vamos a utilizar el gestor de paquetes de Debian, <code class="language-plaintext highlighter-rouge">apt-get</code>. Para ello, vamos a ejecutar el siguiente comando:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>tomcat9
</code></pre></div></div>

<h2 id="tarea-1-desarrollo-y-despliegue-de-una-aplicación-java">Tarea 1: Desarrollo y despliegue de una aplicación Java</h2>

<p>De forma similar a lo que hemos hecho el <a href="https://sysmaria.netlify.app/iaw/2022/12/28/java-simple.html">despliegue simple</a>, despliegue de forma manual la aplicación Java que encontrarás en <a href="https://github.com/josedom24/rock-paper-scissors">siguiente repositorio</a>.</p>]]></content><author><name></name></author><category term="IAW" /><summary type="html"><![CDATA[En este post vamos a realizar el despliegue de una aplicación Java en nuestro VPS. Para ello, vamos a utilizar el servidor web Apache Tomcat.]]></summary></entry><entry><title type="html">Recolección centralizada de logs de sistema, mediante journald</title><link href="/aso/2023/01/04/journald.html" rel="alternate" type="text/html" title="Recolección centralizada de logs de sistema, mediante journald" /><published>2023-01-04T11:59:07+01:00</published><updated>2023-01-04T11:59:07+01:00</updated><id>/aso/2023/01/04/journald</id><content type="html" xml:base="/aso/2023/01/04/journald.html"><![CDATA[<p>En este post, vamos a implementar en nuestro <a href="https://sysmaria.netlify.app/hlc+sri/2022/12/05/escenario.html">escenario</a> un sistema de recolección de log mediante journald. Para ello debes, implementar un sistema de recolección de log mediante el paquete <code class="language-plaintext highlighter-rouge">systemd-journal-remote</code>, o similares.</p>

<p><img src="/assets/images/escenario/escenario.png" alt="Escenario" /></p>

<h1 id="preparación-del-escenario">Preparación del escenario</h1>

<p>Lo primero que deberemos hacer es instalar en cada una de las máquinas de nuestro escenario, incluyendo los contenedores de LXC el paquete <code class="language-plaintext highlighter-rouge">systemd-journal-remote</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt <span class="nb">install </span>systemd-journal-remote
</code></pre></div></div>

<ul>
  <li>
    <p>ALFA</p>
  </li>
  <li>
    <p>BETA</p>
  </li>
  <li>
    <p>CHARLIE</p>
  </li>
  <li>
    <p>DELTA</p>
  </li>
</ul>

<h1 id="configuración-de-journald-en-alfa">Configuración de journald EN <strong>ALFA</strong></h1>

<p>En esta máquina, vamos a configurar el servicio <code class="language-plaintext highlighter-rouge">systemd-journal-remote</code> para que recoga los logs de las demás máquinas. Al no hacer uso del https, vamos a desactivarlo en el fichero <code class="language-plaintext highlighter-rouge">/lib/systemd/system/systemd-journal-remote.service</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Journal Remote Service
Documentation
<span class="nv">After</span><span class="o">=</span>network.target
<span class="nv">Requires</span><span class="o">=</span>network.target

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">ExecStart</span><span class="o">=</span>/usr/lib/systemd/systemd-journal-remote
<span class="nv">Restart</span><span class="o">=</span>on-failure
<span class="nv">RestartSec</span><span class="o">=</span>5s
<span class="nv">StandardOutput</span><span class="o">=</span>null
<span class="nv">StandardError</span><span class="o">=</span>null

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div></div>

<p>Activamos el servicio:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable </span>systemd-journal-remote.service
systemctl <span class="nb">enable </span>systemd-journal-remote.socket
</code></pre></div></div>

<p>Una vez comprobado que nuestro servicio está activo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status systemd-journal-remote.service
systemctl status systemd-journal-remote.socket
</code></pre></div></div>

<p>Solo nos resta por cerciorarnos que el directorio <code class="language-plaintext highlighter-rouge">/var/log/journal/remote</code> existe y tiene los permisos adecuados.De no ser así, lo creamos y le damos los permisos adecuados:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> /var/log/journal/remote
<span class="nb">chown </span>systemd-journal-remote:systemd-journal-remote /var/log/journal/remote
</code></pre></div></div>

<h1 id="configuración-de-los-servidores-bravo-charlie-y-delta">Configuración de los servidores Bravo, Charlie y Delta</h1>

<p>Tras la configuración anterior, el siguiente paso es configurar los clientes para que envíen sus logs a la máquina ALFA. Por ello, vamos a crear un usuario en <code class="language-plaintext highlighter-rouge">bravo</code>, <code class="language-plaintext highlighter-rouge">charlie</code> y <code class="language-plaintext highlighter-rouge">delta</code> que se llame <code class="language-plaintext highlighter-rouge">systemd</code>, perteneciente al grupo <code class="language-plaintext highlighter-rouge">systemd-journal-upload</code> y al que le desactivaremos el login.</p>

<p>Algo a tener en cuenta será que el usuario <code class="language-plaintext highlighter-rouge">systemd</code> tendrá el directorio <code class="language-plaintext highlighter-rouge">home</code> en <code class="language-plaintext highlighter-rouge">/run/systemd</code>, por lo que deberemos crearlo y darle los permisos adecuados:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#BRAVO</span>
<span class="nb">sudo </span>adduser <span class="nt">--system</span> <span class="nt">--home</span> /run/systemd <span class="nt">--no-create-home</span> <span class="nt">--user-group</span> systemd-journal-upload

<span class="c">#CHARLIE</span>
<span class="nb">sudo </span>adduser <span class="nt">--system</span> <span class="nt">--home</span> /run/systemd <span class="nt">--no-create-home</span> <span class="nt">--user-group</span> systemd-journal-upload

<span class="c">#DELTA</span>
<span class="nb">sudo </span>adduser <span class="nt">--system</span> <span class="nt">--home</span> /run/systemd <span class="nt">--no-create-home</span> <span class="nt">--user-group</span> systemd-journal-upload
</code></pre></div></div>

<p>Una vez configurado el usuario en cada una de los clientes, vamos a configurar el fichero <code class="language-plaintext highlighter-rouge">/etc/systemd/journald-upload.conf</code> para que estos mismos clientes envíen sus logs a la máquina ALFA:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/#URL=/URL=http:\/\/alfa.maria.gonzalonazareno.org:19531/g'</span> /etc/systemd/journald-upload.conf
</code></pre></div></div>

<p>Como apreciamos en la siguiente imagen, los cambios se han efectuado correctamente:</p>

<p><img src="/assets/images/journald/journald-upload.conf.png" alt="journald-upload.conf" /></p>

<p>Comprobado esto, solo nos queda activar el servicio <code class="language-plaintext highlighter-rouge">systemd-journal-upload</code> en cada uno de los clientes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#BRAVO, CHARLIE Y DELTA</span>
<span class="nb">sudo </span>systemctl restart systemd-journal-upload.service
</code></pre></div></div>

<p>Para finalizar, podemos comprobar que en el directorio <code class="language-plaintext highlighter-rouge">/var/log/journal/remote</code> de la máquina ALFA, se han creado los ficheros generados por los logs de los clientes:</p>

<p><img src="/assets/images/journald/remote.png" alt="remote" /></p>

<p>Haciendo uso del comando journalctl, podemos ver los logs de cada cliente:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#BRAVO</span>
<span class="nb">sudo </span>journalctl <span class="nt">--file</span> /var/log/journal/remote/remote-172.16.0.200.journal

<span class="c">#CHARLIE</span>
<span class="nb">sudo </span>journalctl <span class="nt">--file</span> /var/log/journal/remote/remote-192.168.0.2.journal

<span class="c">#DELTA</span>
<span class="nb">sudo </span>journalctl <span class="nt">--file</span> /var/log/journal/remote/remote-192.168.0.3.journal
</code></pre></div></div>

<p><img src="/assets/images/journald/journalctl.png" alt="journalctl" /></p>]]></content><author><name></name></author><category term="ASO" /><summary type="html"><![CDATA[En este post, vamos a implementar en nuestro escenario un sistema de recolección de log mediante journald. Para ello debes, implementar un sistema de recolección de log mediante el paquete systemd-journal-remote, o similares.]]></summary></entry><entry><title type="html">Servidores Web, Base de Datos y DNS en nuestros escenario de OpenStack</title><link href="/hlc+sri/2023/01/03/dns.html" rel="alternate" type="text/html" title="Servidores Web, Base de Datos y DNS en nuestros escenario de OpenStack" /><published>2023-01-03T11:06:21+01:00</published><updated>2023-01-03T11:06:21+01:00</updated><id>/hlc+sri/2023/01/03/dns</id><content type="html" xml:base="/hlc+sri/2023/01/03/dns.html"><![CDATA[<p>Tomando como referencia el <a href="https://sysmaria.netlify.app/hlc+sri/2022/12/05/escenario.html">escenario</a>, vamos a realizar la instalación de un servidor web, un servidor de base de datos y un servidor DNS.</p>

<h1 id="servidor-dns">Servidor DNS</h1>
<p>Vamos a instalar un servidor dns en <code class="language-plaintext highlighter-rouge">charlie</code> que nos permita gestionar la resolución directa e inversa de nuestros nombres. Vamos a poseer un servidor dns con autoridad sobre un subdominio de nuestro dominio principal gonzalonazareno.org, que se llamará <code class="language-plaintext highlighter-rouge">mariajesus.gonzalonazareno.org</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>bind9
</code></pre></div></div>

<h2 id="creamos-las-vistas">Creamos las vistas</h2>

<p>Para ello, vamos a crear vistas pero, ¿qué es una vista? Una vista es una forma de organizar las zonas de resolución en un servidor DNS. Una vista es una zona de resolución que se puede configurar de forma independiente. Por ejemplo, podemos tener una vista para la resolución de los nombres de las máquinas de la red interna y otra vista para la resolución de los nombres de las máquinas de la red externa.</p>

<p>De esta forma, podemos tener un servidor DNS que resuelva los nombres de las máquinas de la red interna y otro servidor DNS que resuelva los nombres de las máquinas de la red externa.</p>

<p>En nuestro caso, vamos a crear cinco vistas:</p>

<ul>
  <li>Una vista que será la que tendrán <code class="language-plaintext highlighter-rouge">alfa</code>, <code class="language-plaintext highlighter-rouge">charlie</code> y <code class="language-plaintext highlighter-rouge">delta</code> con la IP <code class="language-plaintext highlighter-rouge">192.168.0.0</code>.</li>
  <li>Una vista DMZ que resuelva a bravo con la IP <code class="language-plaintext highlighter-rouge">172.16.0.0</code>.</li>
  <li>Una vista externa que se muestre al exterior con la IP <code class="language-plaintext highlighter-rouge">172.22.0.0</code>.</li>
  <li>Dos vistas para la resolución inversa, una para la vista interna y otra para la vista DMZ.</li>
</ul>

<p>Para realizar la configuración, debemos realizarla en el fichero <code class="language-plaintext highlighter-rouge">/etc/bind/named.conf.local</code>, quedando de la siguiente manera:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>view interna <span class="o">{</span>
    match-clients <span class="o">{</span> 192.168.0.0/24<span class="p">;</span> 127.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
    allow-recursion <span class="o">{</span> any<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"mariajesus.gonzalonazareno.org"</span> 
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.interna.mariajesus.gonzalonazareno.org"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"0.168.192.in-addr.arpa"</span> 
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.0.168.192"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"16.172.in-addr.arpa"</span> 
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.16.172"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        include <span class="s2">"/etc/bind/zones.rfc1918"</span><span class="p">;</span>
        include <span class="s2">"/etc/bind/named.conf.default-zones"</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

view externa <span class="o">{</span>
    match-clients <span class="o">{</span> 172.22.0.0/16<span class="p">;</span> 192.168.202.2<span class="p">;</span> 172.29.0.0/16<span class="p">;</span><span class="o">}</span><span class="p">;</span>
    allow-recursion <span class="o">{</span> any<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"mariajesus.gonzalonazareno.org"</span> 
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.externa.mariajesus.gonzalonazareno.org"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        include <span class="s2">"/etc/bind/zones.rfc1918"</span><span class="p">;</span>
        include <span class="s2">"/etc/bind/named.conf.default-zones"</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

view dmz <span class="o">{</span>
    match-clients <span class="o">{</span> 172.16.0.0/16<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
    allow-recursion <span class="o">{</span> any<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"mariajesus.gonzalonazareno.org"</span>
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.dmz.mariajesus.gonzalonazareno.org"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"16.172.in-addr.arpa"</span>
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.16.172"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        zone <span class="s2">"0.168.192.in-addr.arpa"</span>
        <span class="o">{</span>
               <span class="nb">type </span>master<span class="p">;</span>
               file <span class="s2">"db.0.168.192"</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
        include <span class="s2">"/etc/bind/zones.rfc1918"</span><span class="p">;</span>
        include <span class="s2">"/etc/bind/named.conf.default-zones"</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/1.png" alt="1" /></p>

<p>Y también modificaremos el fichero <code class="language-plaintext highlighter-rouge">/etc/bind/named.conf</code> de la siguiente manera:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// This is the primary configuration file <span class="k">for </span>the BIND DNS server named.
//
// Please <span class="nb">read</span> /usr/share/doc/bind9/README.Debian.gz <span class="k">for </span>information on the
// structure of BIND configuration files <span class="k">in </span>Debian, <span class="k">*</span>BEFORE<span class="k">*</span> you customize
// this configuration file.
//
// If you are just adding zones, please <span class="k">do </span>that <span class="k">in</span> /etc/bind/named.conf.local

include <span class="s2">"/etc/bind/named.conf.options"</span><span class="p">;</span>
include <span class="s2">"/etc/bind/named.conf.local"</span><span class="p">;</span>
//include <span class="s2">"/etc/bind/named.conf.default-zones"</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/2.png" alt="2" /></p>

<h2 id="creamos-las-zonas">Creamos las zonas</h2>

<h3 id="zona-externa">Zona Externa</h3>

<p>Para crear la zona externa, debemos crear el fichero <code class="language-plaintext highlighter-rouge">/var/cache/bind/db.externa.mariajesus.gonzalonazareno.org</code> con el siguiente contenido:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$TTL</span>    86400
@       IN      SOA     alfa.mariajesus.gonzalonazareno.org. root.mariajesus.gonzalonazareno.org. <span class="o">(</span>
                              1         <span class="p">;</span> Serial
                         604800         <span class="p">;</span> Refresh
                          86400         <span class="p">;</span> Retry
                        2419200         <span class="p">;</span> Expire
                          86400 <span class="o">)</span>       <span class="p">;</span> Negative Cache TTL
<span class="p">;</span>
@       IN      NS      alfa.mariajesus.gonzalonazareno.org.

<span class="nv">$ORIGIN</span> mariajesus.gonzalonazareno.org.

alfa        IN      A       172.22.201.46
dns         IN      CNAME   alfa
www         IN      CNAME   alfa

</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/3.png" alt="3" /></p>

<h3 id="zona-interna">Zona Interna</h3>

<p>Para crear la zona interna, debemos crear el fichero <code class="language-plaintext highlighter-rouge">/var/cache/bind/db.interna.mariajesus.gonzalonazareno.org</code> con el siguiente contenido:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$TTL</span>    86400
@       IN      SOA     charlie.mariajesus.gonzalonazareno.org. root.mariajesus.gonzalonazareno.org. <span class="o">(</span>
                              1         <span class="p">;</span> Serial
                         604800         <span class="p">;</span> Refresh
                          86400         <span class="p">;</span> Retry
                        2419200         <span class="p">;</span> Expire
                          86400 <span class="o">)</span>       <span class="p">;</span> Negative Cache TTL
<span class="p">;</span>
@       IN      NS      charlie.mariajesus.gonzalonazareno.org.

<span class="nv">$ORIGIN</span> mariajesus.gonzalonazareno.org.

alfa        IN      A       192.168.0.1
bravo       IN      A       172.16.0.200
charlie     IN      A       192.168.0.2
delta       IN      A       192.168.0.3
bd          IN      CNAME   delta
dns         IN      CNAME   charlie
www         IN      CNAME   bravo
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/4.png" alt="4" /></p>

<h3 id="zona-dmz">Zona DMZ</h3>

<p>Para crear la zona DMZ, debemos crear el fichero <code class="language-plaintext highlighter-rouge">/var/cache/bind/db.dmz.mariajesus.gonzalonazareno.org</code> con el siguiente contenido:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$TTL</span>    86400
@       IN      SOA     charlie.mariajesus.gonzalonazareno.org. root.mariajesus.gonzalonazareno.org. <span class="o">(</span>
                              1         <span class="p">;</span> Serial
                         604800         <span class="p">;</span> Refresh
                          86400         <span class="p">;</span> Retry
                        2419200         <span class="p">;</span> Expire
                          86400 <span class="o">)</span>       <span class="p">;</span> Negative Cache TTL
<span class="p">;</span>
@       IN      NS      charlie.mariajesus.gonzalonazareno.org.

<span class="nv">$ORIGIN</span> mariajesus.gonzalonazareno.org.

alfa        IN      A       172.16.0.1
bravo       IN      A       172.16.0.200
charlie     IN      A       192.168.0.2
delta       IN      A       192.168.0.3
bd          IN      CNAME   delta
dns         IN      CNAME   charlie
www         IN      CNAME   bravo
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/5.png" alt="5" /></p>

<h3 id="zona-inversa-interna">Zona Inversa Interna</h3>

<p>Para crear la zona inversa interna, debemos crear el fichero <code class="language-plaintext highlighter-rouge">/var/cache/bind/db.0.168.192</code> con el siguiente contenido:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$TTL</span>    86400
@       IN      SOA     charlie.mariajesus.gonzalonazareno.org. root.mariajesus.gonzalonazareno.org. <span class="o">(</span>
                              1         <span class="p">;</span> Serial
                         604800         <span class="p">;</span> Refresh
                          86400         <span class="p">;</span> Retry
                        2419200         <span class="p">;</span> Expire
                          86400 <span class="o">)</span>       <span class="p">;</span> Negative Cache TTL
<span class="p">;</span>
@       IN      NS      charlie.mariajesus.gonzalonazareno.org.

<span class="nv">$ORIGIN</span> 0.168.192.in-addr.arpa.

1       IN      PTR     alfa.mariajesus.gonzalonazareno.org.
2       IN      PTR     charlie.mariajesus.gonzalonazareno.org.
3       IN      PTR     delta.mariajesus.gonzalonazareno.org.
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/6.png" alt="6" /></p>

<h3 id="zona-inversa-dmz">Zona Inversa DMZ</h3>

<p>Para crear la zona inversa interna, debemos crear el fichero <code class="language-plaintext highlighter-rouge">/var/cache/bind/db.16.172</code> con el siguiente contenido:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$TTL</span>    86400
@       IN      SOA     charlie.mariajesus.gonzalonazareno.org. root.mariajesus.gonzalonazareno.org. <span class="o">(</span>
                              1         <span class="p">;</span> Serial
                         604800         <span class="p">;</span> Refresh
                          86400         <span class="p">;</span> Retry
                        2419200         <span class="p">;</span> Expire
                          86400 <span class="o">)</span>       <span class="p">;</span> Negative Cache TTL
<span class="p">;</span>
@       IN      NS      charlie.mariajesus.gonzalonazareno.org.

<span class="nv">$ORIGIN</span> 16.172.in-addr.arpa.

1.0     IN      PTR     alfa.mariajesus.gonzalonazareno.org.
200.0   IN      PTR     bravo.mariajesus.gonzalonazareno.org.
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/7.png" alt="7" /></p>

<p>No debemos olvidar que también debemos modificar el fichero <code class="language-plaintext highlighter-rouge">/etc/bind/zones.rfc1918</code> para desactivar las zonas inversas por defecto:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zone <span class="s2">"10.in-addr.arpa"</span>      <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>

//zone <span class="s2">"16.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"17.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"18.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"19.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"20.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"21.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
//zone <span class="s2">"22.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"23.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"24.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"25.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"26.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"27.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"28.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"29.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"30.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
zone <span class="s2">"31.172.in-addr.arpa"</span>  <span class="o">{</span> <span class="nb">type </span>master<span class="p">;</span> file <span class="s2">"/etc/bind/db.empty"</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/8.png" alt="8" /></p>

<h3 id="configuración-del-forwarder">Configuración del forwarder</h3>

<p>Vamos a modificar el fichero <code class="language-plaintext highlighter-rouge">/etc/bind/named.conf.options</code> para que el servidor <code class="language-plaintext highlighter-rouge">papión</code> actúe como forwarder:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       forwarders <span class="o">{</span>
              192.168.202.2<span class="p">;</span>
       <span class="o">}</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/9.png" alt="9" /></p>

<p>Reiniciamos el servicio bind9:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart bind9
</code></pre></div></div>

<h1 id="servidor-web">Servidor Web</h1>

<p>En <code class="language-plaintext highlighter-rouge">bravo</code> vamos a instalar un servidor web apache. Recuerda que es una máquina con rocky linux. Para ello, debemos ejecutar los siguientes comandos:</p>

<p><strong>NOTA</strong>: Recordemos que esta máquina es una máquina con un sistema Rocky Linux.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>dnf <span class="nb">install </span>httpd php php-mysqlnd php-gd php-fpm
</code></pre></div></div>

<p>Iniciamos, habilitamos el servicio apache y comprobamos que está en ejecución:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl <span class="nb">enable </span>httpd
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>php-fpm
<span class="nt">---</span>
<span class="nb">sudo </span>systemctl status httpd
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/10.png" alt="10" /></p>

<p>Creamos el VirtualHost, pero para ello:</p>

<ol>
  <li>
    <p>Creamos los directorios <code class="language-plaintext highlighter-rouge">sites-available</code> y <code class="language-plaintext highlighter-rouge">sites-enabled</code> en <code class="language-plaintext highlighter-rouge">/etc/httpd</code>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
mkdir /etc/httpd/sites-available /etc/httpd/sites-enabled
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configuramos <code class="language-plaintext highlighter-rouge">/etc/httpd/conf/httpd.conf</code> para que cargue los ficheros de configuración de los VirtualHosts:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
#Añadimos esta línea al final del fichero
IncludeOptional sites-enabled/*.conf
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el fichero <code class="language-plaintext highlighter-rouge">/etc/httpd/sites-available/www.mariajesus.gonzalonazareno.org.conf</code>. Recordemos también que debemos incluir la configuración para agregar php al servidor web, por lo que el fichero quedaría con el siguiente contenido:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
&lt;VirtualHost *:80&gt;
    ServerName www.mariajesus.gonzalonazareno.org
    DocumentRoot /var/www/html/mariajesus
    ErrorLog /var/www/html/mariajesus/log/error.log
    CustomLog /var/www/html/mariajesus/log/access.log combined

    &lt;FilesMatch \.php$&gt;
        SetHandler "proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"
    &lt;/FilesMatch&gt;
&lt;/VirtualHost&gt;
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el enlace simbólico en <code class="language-plaintext highlighter-rouge">/etc/httpd/sites-enabled</code>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo ln -s /etc/httpd/sites-available/www.mariajesus.gonzalonazareno.org.conf /etc/httpd/sites-enabled/www.mariajesus.gonzalonazareno.org.conf
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el fichero <code class="language-plaintext highlighter-rouge">/var/www/html/mariajesus/info.php</code>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```php
&lt;?php
phpinfo();
?&gt;
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el index.html en <code class="language-plaintext highlighter-rouge">/var/www/html/mariajesus</code>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```html
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset='utf-8'&gt;
    &lt;meta name='viewport' content='width=device-width, initial-scale=1'&gt;
    &lt;title&gt;www.mariajesus.gonzalonazareno.org&lt;/title&gt;
       &lt;style type="text/css"&gt;
      /*&lt;![CDATA[*/
   
            html {
             height: 100%;
             width: 100%;
           }  
             body {
       background: rgb(20,72,50);
       background: -moz-linear-gradient(180deg, rgba(23,43,70,1) 30%, rgba(0,0,0,1) 90%)  ;
       background: -webkit-linear-gradient(180deg, rgba(23,43,70,1) 30%, rgba(0,0,0,1) 90%) ;
       background: linear-gradient(180deg, rgba(23,43,70,1) 30%, rgba(0,0,0,1) 90%);
       background-repeat: no-repeat;
       background-attachment: fixed;
       filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#3c6eb4",endColorstr="#3c95b4",GradientType=1); 
             color: white;
             font-size: 0.9em;
             font-weight: 400;
             font-family: 'Montserrat', sans-serif;
             margin: 0;
             padding: 10em 6em 10em 6em;
             box-sizing: border-box;      

           }
                   h1 {
         text-align: center;
         margin: 0;
         padding: 0.6em 2em 0.4em;
         color: #fff;
         font-weight: bold;
         font-family: 'Montserrat', sans-serif;
         font-size: 2em;
       }
       h1 strong {
         font-weight: bolder;
         font-family: 'Montserrat', sans-serif;
       }
       h2 {
         font-size: 1.5em;
         font-weight:bold;
       }
             .title {
         border: 1px solid black;
         font-weight: bold;
         position: relative;
         float: right;
         width: 150px;
         text-align: center;
         padding: 10px 0 10px 0;
         margin-top: 0;
       }
             .description {
         padding: 45px 10px 5px 10px;
         clear: right;
         padding: 15px;
       }
             .section {
         padding-left: 3%;
        margin-bottom: 10px;
       }
             img {
               padding: 2px;
         margin: 2px;
       }
       a:hover img {
         padding: 2px;
         margin: 2px;
       }
             :link {
         color: rgb(199, 252, 77);
         text-shadow:
       }
       :visited {
         color: rgb(122, 206, 255);
       }
       a:hover {
         color: rgb(16, 44, 122);
       }
       .row {
         width: 100%;
         padding: 0 10px 0 10px;
       }
             footer {
         padding-top: 6em;
         margin-bottom: 6em;
         text-align: center;
         font-size: xx-small;
         overflow:hidden;
         clear: both;
       }
             .summary {
         font-size: 140%;
         text-align: center;
       }
             #rocky-poweredby img {
         margin-left: -10px;
       }
             #logos img {
         vertical-align: top;
       }
             /* Desktop  View Options */
             @media (min-width: 768px)  {
               body {
           padding: 10em 20% !important;
         }
               .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6,
         .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12 {
           float: left;
         }
               .col-md-1 {
           width: 8.33%;
         }
         .col-md-2 {
           width: 16.66%;
         }
         .col-md-3 {
           width: 25%;
         }
         .col-md-4 {
           width: 33%;
         }
         .col-md-5 {
           width: 41.66%;
         }
         .col-md-6 {
           border-left:3px ;
           width: 50%;
                     }
         .col-md-7 {
           width: 58.33%;
         }
         .col-md-8 {
           width: 66.66%;
         }
         .col-md-9 {
           width: 74.99%;
         }
         .col-md-10 {
           width: 83.33%;
         }
         .col-md-11 {
           width: 91.66%;
         }
         .col-md-12 {
           width: 100%;
         }
       }
             /* Mobile View Options */
       @media (max-width: 767px) {
         .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6,
         .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 {
           float: left;
         }
               .col-sm-1 {
           width: 8.33%;
         }
         .col-sm-2 {
           width: 16.66%;
         }
         .col-sm-3 {
           width: 25%;
         }
         .col-sm-4 {
           width: 33%;
         }
         .col-sm-5 {
           width: 41.66%;
         }
         .col-sm-6 {
           width: 50%;
         }
         .col-sm-7 {
           width: 58.33%;
         }
         .col-sm-8 {
           width: 66.66%;
         }
         .col-sm-9 {
           width: 74.99%;
         }
         .col-sm-10 {
           width: 83.33%;
         }
         .col-sm-11 {
           width: 91.66%;
         }
         .col-sm-12 {
           width: 100%;
         }
         h1 {
           padding: 0 !important;
         }
       }

             &lt;/style&gt;
       &lt;/head&gt;
       &lt;body&gt;
              &lt;h1&gt;¡Bienvenid@ a la web!&lt;/h1&gt;
              &lt;h2&gt;Esta es una web de prueba en Rocky Linux &lt;/h2&gt;
              &lt;p&gt;Podemos comprobar la información de este sitio web de forma más detallada en &lt;a href="info.php"&gt;info.php&lt;/a&gt;.&lt;/p&gt;
       &lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div>    </div>
  </li>
</ol>

<p><strong>IMPORTANTE</strong></p>

<p>Estamos ante un escenario con una máquina Rocky Linux 9, por lo que debemos hacer una modificación en el fichero <code class="language-plaintext highlighter-rouge">/etc/sysconfig/selinux</code> para que el servidor web funcione correctamente. Tras ello, reiniciamos la máquina.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">SELINUX</span><span class="o">=</span>diabled
</code></pre></div></div>

<p><img src="/assets/images/dns-escenario/11.png" alt="11" /></p>

<p><img src="/assets/images/dns-escenario/12.png" alt="12" /></p>

<h1 id="servidor-de-base-de-datos">Servidor de Base de Datos</h1>

<p>En <code class="language-plaintext highlighter-rouge">delta</code> vamos a instalar un servidor de base de datos mariajesusdb (<code class="language-plaintext highlighter-rouge">bd.mariajesus.gonzalonazareno.org</code>). A este seervidor de base de datos se debe permitir el acceso desde todas las máquinas del escenario.</p>

<h2 id="instalación-y-configuración-remota-de-mariadb">Instalación y configuración remota de MariaDB</h2>

<ol>
  <li>
    <p>Instalamos el servidor de base de datos, en este caso MariaDB.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo apt install mariadb-server
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configuramos MariaDB para conectarnos de forma remota.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo mysql_secure_installation
```

```bash
NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we ll need the current password for the root user. If you ve just installed MariaDB, and you haven t set the root password yet, the password will be blank, so you should just press enter here.

Enter current password for root (enter for none):********
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorisation.

You already have a root password set, so you can safely answer 'n'.

Change the root password? [Y/n] Y
New password:********
Re-enter new password:********
Password updated successfully!
Reloading privilege tables..
 ... Success!

By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment.

Remove anonymous users? [Y/n] Y
 ... Success!

Normally, root should only be allowed to connect from localhost. This ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] Y
 ... Success!

By default, MariaDB comes with a database named test that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment.

Remove test database and access to it? [Y/n] Y
 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far will take effect immediately.

Reload privilege tables now? [Y/n] Y
 ... Success!

Cleaning up...

All done! If you ve completed all of the above steps, your MariaDB installation should now be secure.

Thanks for using MariaDB!
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el usuario:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
sudo mysql -u root -p
----
CREATE USER 'mariajesus'@'%' IDENTIFIED BY 'admin';
GRANT ALL PRIVILEGES ON *.* TO 'mariajesus'@'%';
FLUSH PRIVILEGES;
exit;
```

![13](/assets/images/dns-escenario/13.png)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Habilitamos el acceso remoto a la base de datos modificando el fichero <code class="language-plaintext highlighter-rouge">/etc/mysql/mariadb.conf.d/50-server.cnf</code> y lo modificamos de la siguiente manera:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
bind-address = 0.0.0.0
```

![14](/assets/images/dns-escenario/14.png)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Reiniciamos el servicio de MariaDB y comprobamos su estado.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
systemctl restart mariadb
systemctl status mariadb
```

![15](/assets/images/dns-escenario/15.png)
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="configuración-del-acceso-remoto-a-la-base-de-datos-desde-bravo">Configuración del acceso remoto a la base de datos desde <code class="language-plaintext highlighter-rouge">bravo</code></h2>

<ol>
  <li>
    <p>Instalamos el cliente de MariaDB en <code class="language-plaintext highlighter-rouge">bravo</code>.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
dnf install mariadb-server
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Modificamos el fichero <code class="language-plaintext highlighter-rouge">/etc/resolv.conf</code> donde pondremos la ip de <code class="language-plaintext highlighter-rouge">charlie</code> como servidor DNS.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
nameserver 192.168.0.2
```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Comprobamos que podemos acceder a la base de datos desde <code class="language-plaintext highlighter-rouge">bravo</code>.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```bash
mysql - u mariajesus -p mariajesus -h bd -p
```

![16](/assets/images/dns-escenario/16.png)
</code></pre></div>    </div>
  </li>
</ol>]]></content><author><name></name></author><category term="HLC+SRI" /><summary type="html"><![CDATA[Tomando como referencia el escenario, vamos a realizar la instalación de un servidor web, un servidor de base de datos y un servidor DNS.]]></summary></entry><entry><title type="html">Certificados digitales. HTTPS</title><link href="/seguridad/2023/01/02/Criptograf%C3%ADa3.html" rel="alternate" type="text/html" title="Certificados digitales. HTTPS" /><published>2023-01-02T16:45:16+01:00</published><updated>2023-01-02T16:45:16+01:00</updated><id>/seguridad/2023/01/02/Criptograf%C3%ADa3</id><content type="html" xml:base="/seguridad/2023/01/02/Criptograf%C3%ADa3.html"><![CDATA[<h2 id="certificado-digital-de-persona-física">Certificado digital de persona física</h2>

<p><img src="/assets/images/certificado/cert.png" alt="certificado" /></p>

<p>Un certificado digital es un documento electrónico que contiene información sobre la identidad de una persona física o jurídica, y que se utiliza para firmar documentos electrónicos. El certificado digital contiene información sobre la persona que lo solicita, como su nombre, apellidos, DNI, fecha de nacimiento, etc. Además, contiene información sobre la entidad que lo emite, como el nombre de la entidad, el CIF, la dirección, etc.</p>

<h3 id="tarea-1-instalación-del-certificado">Tarea 1: Instalación del certificado</h3>

<p><strong>NOTA</strong>: Para solicitar el certificado, podemos hacerlo a través de una acreditación presencial en una oficina de la FNMT o usando el DNI electrónico.</p>

<ol>
  <li>
    <p>Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito.</p>

    <ul>
      <li>
        <p>Instalamos el certificado en el navegador. Para ello, accedemos a la página de la FNMT y descargamos el certificado. Nos pedirá nuestro DNI, nuestro primer apellido y un código de validación que nos han mandado a nuestro correo, con el que hemos solicitado el certificado. Una vez descargado, lo instalamos en el navegador.</p>

        <p><img src="/assets/images/certificado/1.png" alt="1" /></p>
      </li>
      <li>
        <p>A continuación, tras aceptar los términos y condiciones, nos pedirá que introduzcamos la contraseña que hemos establecido al solicitar el certificado. Una vez introducida, nos pedirá que introduzcamos la contraseña de nuestro certificado para poder instalarlo.</p>

        <p><img src="/assets/images/certificado/2.png" alt="2" /></p>
      </li>
      <li>
        <p>Tras la descarga, nos preguntará si queremos crear una copia de seguridad del certificado.</p>

        <p><img src="/assets/images/certificado/3.png" alt="3" /></p>
      </li>
      <li>
        <p>Finalmente, nos confirmará que la copia de seguridad se ha realizado correctamente.</p>

        <p><img src="/assets/images/certificado/4.png" alt="4" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Muestra una captura de pantalla donde se vea las preferencias del navegador donde se ve instalado tu certificado.</p>

    <ul>
      <li>Para ver las preferencias del navegador, accedemos a <code class="language-plaintext highlighter-rouge">Ajustes &gt; Privacidad y Seguridad &gt; Certificados &gt; Ver Certificados</code>. Se abrirá una ventana con todos los certificados instalados en nuestro navegador. En ella, podemos ver el certificado que hemos instalado.</li>
    </ul>

    <p><img src="/assets/images/certificado/5.png" alt="5" /></p>
  </li>
  <li>
    <p>¿Cómo puedes hacer una copia de tu certificado?¿Como vas a realizar la copia de seguridad de tu certificado?. Razona la respuesta.</p>

    <ul>
      <li>Para hacer una copia de seguridad de nuestro certificado, debemos dirigirnos a <code class="language-plaintext highlighter-rouge">Ajustes &gt; Privacidad y Seguridad &gt; Certificados &gt; Ver Certificados</code>. Se nos abrirá la misma ventana de la imagen anterior. Clicamos en el certificado que queremos hacer una copia de seguridad y pulsamos en “Hacer copia”. Se nos abrirá una ventana en la que nos pedirá que introduzcamos la contraseña de nuestro certificado. Una vez introducida, nos pedirá que introduzcamos una contraseña para proteger nuestra copia de seguridad. Finalmente, tendremos nuestra copia de seguridad.</li>
    </ul>

    <p>En mi caso, he almacenado mi clave en un NAS privado, en un directorio cifrado con clave alfanumérica. De esta forma, si alguien accede a mi NAS, no podrá acceder a mi clave privada, ya que no conoce la clave de cifrado.</p>

    <p><img src="/assets/images/certificado/6.png" alt="6" /></p>
  </li>
  <li>
    <p>Investiga como exportar la clave pública de tu certificado.</p>

    <ul>
      <li>
        <p>Con la copia de seguridad que tenemos de nuestra clave, y en mi caso, teniendo acceso a mi NAS, tanto en local como por VPN, puedo exportar mi clave a otros dispositivos. En mi caso, he exportado mi clave a mi móvil, (teniedo este sistema operativo iOS).</p>
      </li>
      <li>
        <p>Para la comprobación, he instalado la aplicación de la DGT y poder tener mi documentación en mi dispositivo móvil.</p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="tarea-2-validación-del-certificado">Tarea 2: Validación del certificado</h3>

<ol>
  <li>
    <p>Instala en tu ordenador el software autofirma y desde la página de VALIDe valida tu certificado. Muestra capturas de pantalla donde se comprueba la validación.</p>

    <ul>
      <li>
        <p>Para instalar autofirma, debemos dirigirnos a la página de autofirma y descargar el instalador. Una vez descargado, lo instalamos en nuestro ordenador.</p>
      </li>
      <li>
        <p>Una vez instalado, abrimos la aplicación y nos pedirá que introduzcamos la contraseña de nuestro certificado. Una vez introducida, nos pedirá que introduzcamos la contraseña de nuestro certificado para poder instalarlo.</p>
      </li>
      <li>
        <p>Ingresamos en la página de VALIDe y seleccionamos la opción de <code class="language-plaintext highlighter-rouge">Validar Certificado</code></p>

        <p><img src="/assets/images/certificado/7.png" alt="7" /></p>
      </li>
      <li>
        <p>Al ser la primera vez, autorizamos a autofirma a acceder a nuestra clave privada.</p>

        <p><img src="/assets/images/certificado/8.png" alt="8" /></p>
      </li>
      <li>
        <p>Elegimos la clave que queremos validar, escribimos el captcha y pulsamos en <code class="language-plaintext highlighter-rouge">Validar</code></p>

        <p><img src="/assets/images/certificado/9.png" alt="9" /></p>
      </li>
      <li>
        <p>Como podemos ver, la clave es válida.</p>

        <p><img src="/assets/images/certificado/10.png" alt="10" /></p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="preparando-el-entorno-de-trabajo-en-debian">Preparando el entorno de trabajo en Debian</h3>

<p>Como anteriormente he realizado los ejercicios en Windows, a partir de ahora vamos a realizarlo desde Debian. Para ello, <code class="language-plaintext highlighter-rouge">sudo apt install libnss3-tools</code> para instalar Java y las herramientas de Mozilla. Una vez instalado, ejecutamos el fichero <code class="language-plaintext highlighter-rouge">.deb</code> de autofirma y nos pedirá que introduzcamos la contraseña de nuestro certificado. Una vez introducida, nos pedirá que introduzcamos la contraseña de nuestro certificado para poder instalarlo.</p>

<h3 id="tarea-3-firma-electrónica">Tarea 3: Firma electrónica</h3>

<ol>
  <li>
    <p>Utilizando la página VALIDe y el programa autofirma, firma un documento con tu certificado y envíalo por correo a un compañero.</p>

    <ul>
      <li>
        <p>Creamos dos documentos de texto: uno para la comprobación de la página VALIDe y otro para la aplicación de autofirma.</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">echo</span> <span class="s2">"Hola. Soy Maria. Esto es una prueba de VALIDe."</span> <span class="o">&gt;</span> valide.txt
  <span class="nb">echo</span> <span class="s2">"Hola. Soy Maria. Esto es una prueba de autofirma."</span> <span class="o">&gt;</span> autofirma.txt
</code></pre></div>        </div>
      </li>
      <li>
        <p>Una vez creados los documentos, los firmamos, uno con VALIDe y otro con autofirma.</p>

        <p><img src="/assets/images/certificado/11.png" alt="11" /></p>

        <p><img src="/assets/images/certificado/12.png" alt="12" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Tu debes recibir otro documento firmado por un compañero y utilizando las herramientas anteriores debes visualizar la firma <code class="language-plaintext highlighter-rouge">Visualizar Firma</code> y <code class="language-plaintext highlighter-rouge">Verificar Firma</code>.</p>

    <ul>
      <li>¿Puedes verificar la firma aunque no tengas la clave pública de tu compañero?
        <ul>
          <li>Si,debido a que la clave pública de mi compañero se adjunta en el fichero ya firmado, por lo que puedo verificar la firma.</li>
        </ul>
      </li>
      <li>¿Es necesario estar conectado a internet para hacer la validación de la firma?. Razona tus respuestas.
        <ul>
          <li>Para VALIDe si que es necesario estar conectado a internet, ya que es una página web. Para autofirma, no es necesario estar conectado a internet, ya que es una aplicación que se ejecuta en nuestro ordenador.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>Entre dos compañeros, firmar los dos un documento, verificar la firma para comprobar que está firmado por los dos.</p>

    <p><img src="/assets/images/certificado/13.png" alt="13" /></p>

    <p><img src="/assets/images/certificado/14.png" alt="14" /></p>
  </li>
</ol>

<h3 id="tarea-4-autenticación">Tarea 4: Autenticación</h3>

<ol>
  <li>
    <p>Utilizando tu certificado accede a alguna página de la administración pública (cita médica, becas, puntos del carnet,…). Entrega capturas de pantalla donde se demuestre el acceso a ellas.</p>

    <ul>
      <li>
        <p>Accedemos a la web de la <a href="https://www.dgt.es/nuestros-servicios/permisos-de-conducir/tus-puntos-y-tus-permisos/consulta-y-certificado-de-puntos/">DGT</a> para verificar el funcionamiento de nuestro certificado digital accediendo a nuestro historial de puntos.</p>

        <p><img src="/assets/images/certificado/dgt1.png" alt="dgt" /></p>
      </li>
      <li>
        <p>Nos redigirá a una página donde podremos elegir entre los distintos tipos de acceso y elegimos <code class="language-plaintext highlighter-rouge">Cl@ave</code>.</p>

        <p><img src="/assets/images/certificado/dgt2.png" alt="dgt2" /></p>
      </li>
      <li>
        <p>El navegador, en mi caso, requiere de la aplicación de autofirma para poder acceder a la contraseña. Una vez introducida, nos redirige a la página de la DGT donde podemos ver nuestro historial de puntos.</p>

        <p><img src="/assets/images/certificado/dgt3.png" alt="dgt3" /></p>
      </li>
    </ul>
  </li>
</ol>

<h2 id="https--ssl">HTTPS / SSL</h2>

<p><img src="/assets/images/certificado/https.png" alt="https" /></p>

<p><strong>NOTA</strong>: Vamos a realizar esta práctica en una web que se acceda con el nombre <code class="language-plaintext highlighter-rouge">maria.iesgn.org</code>.</p>

<p>Para realizar esta tarea, vamos a necesitar la colaboración de un compañero, ya que fimraré una Autoridad Certificadora y mi compañero la firmará, y viceversa.</p>

<p>Para ello, podemos hacer uso de los siguientes enlaces para buscar más información:</p>

<ul>
  <li><a href="https://www.phildev.net/ssl/">Phil’s X509/SSL Guide</a></li>
  <li><a href="https://gist.github.com/Soarez/9688998">How to setup your own CA with OpenSSL</a></li>
  <li><a href="https://blog.guillen.io/2018/09/29/crear-autoridad-certificadora-ca-y-certificados-autofirmados-en-linux/">Crear autoridad certificadora (CA) y certificados autofirmados en Linux</a></li>
</ul>

<h3 id="creamos-la-autoridad-certificadora">Creamos la Autoridad certificadora</h3>

<ol>
  <li>
    <p>Crear su autoridad certificadora (generar el certificado digital de la CA). Mostrar el fichero de configuración de la AC.</p>

    <ul>
      <li>
        <p>Creamos el directorio donde alojaremos todo lo necesario para la CA, dándole los permisos necesarios.</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">mkdir </span>CA
  <span class="nb">cd </span>CA
  <span class="nb">mkdir </span>certs csr crl newcerts private 
  <span class="nb">chmod </span>700 private
  <span class="nb">touch </span>index.txt
  <span class="nb">touch </span>index.txt.attr
  <span class="nb">echo </span>1000 <span class="o">&gt;</span> serial
</code></pre></div>        </div>
      </li>
      <li>
        <p>Creamos las variables de entorno donde definiremos los datos de configuración de la CA.</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">countryName_default</span><span class="o">=</span><span class="s2">"ES"</span>
  <span class="nv">stateOrProvinceName_default</span><span class="o">=</span><span class="s2">"Sevilla"</span>
  <span class="nv">localityName_default</span><span class="o">=</span><span class="s2">"Dos Hermanas"</span>
  <span class="nv">organizationName_default</span><span class="o">=</span><span class="s2">"Maria"</span>
  <span class="nv">organizationalUnitName_default</span><span class="o">=</span><span class="s2">"ASIR2"</span>
  <span class="nv">emailAddress_default</span><span class="o">=</span><span class="s2">"mariajesus.alloza@outlook.es"</span>
  <span class="nv">DIR_CA</span><span class="o">=</span><span class="s2">"./"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Creamos el fichero de configuración.</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">&gt;</span><span class="nv">$DIR_CA</span><span class="sh">/openssl.conf
  [ ca ]
  # man ca
  default_ca = CA_default

  [ CA_default ]
  # Directory and file locations.
  dir               = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">
  certs             = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">certs
  crl_dir           = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">crl
  new_certs_dir     = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">newcerts
  database          = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">index.txt
  serial            = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">serial
  RANDFILE          = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">private/.rand

  # The root key and root certificate.
  private_key       = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">private/private.key
  certificate       = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">certs/cacert.crt

  # For certificate revocation lists.
  crlnumber         = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">crlnumber
  crl               = </span><span class="k">${</span><span class="nv">DIR_CA</span><span class="k">}</span><span class="sh">crl/ca.crl.pem
  crl_extensions    = crl_ext
  default_crl_days  = 30

  # SHA-1 is deprecated, so use SHA-2 instead.
  default_md        = sha256

  name_opt          = ca_default
  cert_opt          = ca_default
  default_days      = 375
  preserve          = no
  policy            = policy_strict

  [ policy_strict ]
  # The root CA should only sign intermediate certificates that match.
  # See the POLICY FORMAT section of man ca.
  countryName             = match
  stateOrProvinceName     = match
  organizationName        = match
  organizationalUnitName  = optional
  commonName              = supplied
  emailAddress            = optional

  [ policy_loose ]
  # Allow the intermediate CA to sign a more diverse range of certificates.
  # See the POLICY FORMAT section of the ca man page.
  countryName             = optional
  stateOrProvinceName     = optional
  localityName            = optional
  organizationName        = optional
  organizationalUnitName  = optional
  commonName              = supplied
  emailAddress            = optional

  [ req ]
  # Options for the req tool (man req).
  default_bits        = 2048
  distinguished_name  = req_distinguished_name
  string_mask         = utf8only
  # SHA-1 is deprecated, so use SHA-2 instead.
  default_md          = sha256
  # Extension to add when the -x509 option is used.
  x509_extensions     = v3_ca
  # Extension for SANs
  req_extensions      = v3_req

  [ v3_req ]
  # Extensions to add to a certificate request
  # Before invoke openssl use: export SAN=DNS:value1,DNS:value2
  basicConstraints = CA:FALSE
  keyUsage = nonRepudiation, digitalSignature, keyEncipherment
  xxxsubjectAltNamexxx =

  [ req_distinguished_name ]
  # See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;.
  countryName                     = Country Name (2 letter code)
  stateOrProvinceName             = State or Province Name
  localityName                    = Locality Name
  0.organizationName              = Organization Name
  organizationalUnitName          = Organizational Unit Name
  commonName                      = Common Name
  emailAddress                    = Email Address

  # Optionally, specify some defaults.
  countryName_default             = </span><span class="nv">$countryName_default</span><span class="sh">
  stateOrProvinceName_default     = </span><span class="nv">$stateOrProvinceName_default</span><span class="sh">
  localityName_default            = </span><span class="nv">$localityName_default</span><span class="sh">
  0.organizationName_default      = </span><span class="nv">$organizationName_default</span><span class="sh">
  organizationalUnitName_default  = </span><span class="nv">$organizationalUnitName_default</span><span class="sh">
  emailAddress_default            = </span><span class="nv">$emailAddress_default</span><span class="sh">

  [ v3_ca ]
  # Extensions for a typical CA (man x509v3_config).
  subjectKeyIdentifier = hash
  authorityKeyIdentifier = keyid:always,issuer
  basicConstraints = critical, CA:true
  keyUsage = critical, digitalSignature, cRLSign, keyCertSign

  [ v3_intermediate_ca ]
  # Extensions for a typical intermediate CA (man x509v3_config).
  subjectKeyIdentifier = hash
  authorityKeyIdentifier = keyid:always,issuer
  basicConstraints = critical, CA:true, pathlen:0
  keyUsage = critical, digitalSignature, cRLSign, keyCertSign

  [ usr_cert ]
  # Extensions for client certificates (man x509v3_config).
  basicConstraints = CA:FALSE
  nsCertType = client, email
  nsComment = "OpenSSL Generated Client Certificate"
  subjectKeyIdentifier = hash
  authorityKeyIdentifier = keyid,issuer
  keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
  extendedKeyUsage = clientAuth, emailProtection

  [ server_cert ]
  # Extensions for server certificates (man x509v3_config).
  basicConstraints = CA:FALSE
  nsCertType = server
  nsComment = "OpenSSL Generated Server Certificate"
  subjectKeyIdentifier = hash
  authorityKeyIdentifier = keyid,issuer:always
  keyUsage = critical, digitalSignature, keyEncipherment
  extendedKeyUsage = serverAuth

  [ crl_ext ]
  # Extension for CRLs (man x509v3_config).
  authorityKeyIdentifier=keyid:always

  [ ocsp ]
  # Extension for OCSP signing certificates (man ocsp).
  basicConstraints = CA:FALSE
  subjectKeyIdentifier = hash
  authorityKeyIdentifier = keyid,issuer
  keyUsage = critical, digitalSignature
  extendedKeyUsage = critical, OCSPSigning
</span><span class="no">  EOF
</span></code></pre></div>        </div>

        <ul>
          <li>Creamos tanto la clavecomoel certificado de a AC (autoridad de certificación) con el siguiente comando:</li>
        </ul>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c">#Creación de la clave</span>
  openssl genrsa <span class="nt">-aes256</span> <span class="nt">-out</span> private/private.key 4096
  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s|xxxsubjectAltNamexxx =|subjectAltName = ${ENV::SAN}|g'</span> openssl.conf
  <span class="nv">URL</span><span class="o">=</span>juanjesus.iesgn.org
  <span class="nb">export </span><span class="nv">SAN</span><span class="o">=</span>DNS:<span class="nv">$URL</span>
        
  <span class="c">#Creación del certificado</span>
  openssl req <span class="nt">-config</span> openssl.conf <span class="nt">-key</span> private/private.key <span class="nt">-new</span> <span class="nt">-x509</span> <span class="nt">-days</span> 3650 <span class="nt">-sha256</span> <span class="nt">-extensions</span> v3_ca <span class="nt">-out</span> certs/cacert.crt
  <span class="nb">chmod </span>444 certs/cacert.crt
    
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Debe recibir el fichero CSR (Solicitud de Firmar un Certificado) de su compañero, debe firmarlo y enviar el certificado generado a su compañero.</p>

    <ul>
      <li>Mi compañero me envía mir fichero CSR, lo firmo y lo envío de vuelta.</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">#Firmar el certificado</span>
 openssl ca <span class="nt">-config</span> openssl.conf <span class="nt">-extensions</span> v3_req <span class="nt">-days</span> 3650 <span class="nt">-notext</span> <span class="nt">-md</span> sha256 <span class="nt">-in</span> csr/juanjesus-mjca.csr <span class="nt">-out</span> certs/juanjesus-mjca.crt
</code></pre></div>    </div>
  </li>
  <li>
    <p>¿Qué otra información debes aportar a tu compañero para que éste configure de forma adecuada su servidor web con el certificado generado?</p>

    <ul>
      <li>Dentro de nuestro fichero <code class="language-plaintext highlighter-rouge">openssl.conf</code> nos encontraremos con los datos que nuestro compañero debe rellenar para configurar su servidor web, que son:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">countryName</code></li>
          <li><code class="language-plaintext highlighter-rouge">stateOrProvinceName</code></li>
          <li><code class="language-plaintext highlighter-rouge">localityName</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<h3 id="administramos-el-servidor-web">Administramos el servidor web</h3>

<h4 id="preparando-el-escenario">Preparando el escenario</h4>

<p>Para realizar este punto, deberemos crear un servidor apache, y configurarlo para que nos sirva una página web con https. Para ello, deberemos seguir los siguientes pasos:</p>

<ul>
  <li>
    <p>Instalamos el servidor apache:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>apt <span class="nb">install </span>apache2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Deshabilitamos el virtual host por defecto:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>a2dissite 000-default.conf
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos un nuevo virtual host y su fichero de configuración:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo mkdir</span> /var/www/html/maria.iesgn.org
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el fichero <code class="language-plaintext highlighter-rouge">index.html</code> dentro de la carpeta que hemos creado anteriormente:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>nano /var/www/html/maria.iesgn.org/index.html
</code></pre></div>    </div>
    <ul>
      <li>
        <p>Y dentro de este fichero, escribimos lo siguiente:</p>

        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;!DOCTYPE html&gt;</span>
      <span class="nt">&lt;html&gt;</span>
          <span class="nt">&lt;head&gt;</span>
          <span class="nt">&lt;title&gt;</span>maria.iesgn.org<span class="nt">&lt;/title&gt;</span>
          <span class="nt">&lt;/head&gt;</span>
      <span class="nt">&lt;body&gt;</span>
          <span class="nt">&lt;h1&gt;</span>maria.iesgn.org<span class="nt">&lt;/h1&gt;</span>
          <span class="nt">&lt;p&gt;</span>Web de prueba para cripto 3 - HTTPS<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Habilitamos el nuevo virtual host y reiniciamos el servicio apache:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>a2ensite maria.iesgn.org.conf
  <span class="nb">sudo </span>systemctl restart apache2
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="empezamos">Empezamos</h4>

<ol>
  <li>
    <p>Crea una clave privada RSA de 4096 bits para identificar el servidor.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>openssl genrsa <span class="nt">-aes256</span> <span class="nt">-out</span> /etc/ssl/private/maria-priv.key 4096
 <span class="nb">sudo chmod </span>400 /etc/ssl/private/maria-priv.key
</code></pre></div>    </div>
  </li>
  <li>
    <p>Utiliza la clave anterior para generar un CSR, considerando que deseas acceder al servidor con el FQDN (<code class="language-plaintext highlighter-rouge">maria.iesgn.org</code>).</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>openssl req <span class="nt">-new</span> <span class="nt">-sha256</span> <span class="nt">-key</span> /etc/ssl/private/maria-priv.key <span class="nt">-out</span> maria.csr
</code></pre></div>    </div>
  </li>
  <li>
    <p>Envía la solicitud de firma a la entidad certificadora (su compañero). Recibe como respuesta un certificado X.509 para el servidor firmado y el certificado de la autoridad certificadora.</p>
  </li>
  <li>
    <p>Configura tu servidor web con https en el puerto 443, haciendo que las peticiones http se redireccionen a https (forzar https).</p>

    <ul>
      <li>
        <p>Modificamos el fichero de configuración:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;IfModule mod_ssl.c&gt;
      &lt;VirtualHost <span class="k">*</span>:443&gt;
          ServerName maria.iesgn.org
          DocumentRoot /var/www/html/maria.iesgn.org
          ErrorLog <span class="k">${</span><span class="nv">APACHE_LOG_DIR</span><span class="k">}</span>/error-maria.log
          CustomLog <span class="k">${</span><span class="nv">APACHE_LOG_DIR</span><span class="k">}</span>/access-maria.log combined

          SSLEngine on
          SSLCertificateFile /etc/ssl/certs/maria.crt
          SSLCertificateKeyFile /etc/ssl/private/maria-priv.key
          SSLCertificateChainFile /etc/ssl/certs/cacert.crt

          &lt;Directory /var/www/html/maria.iesgn.org&gt;
              Options Indexes FollowSymLinks
              AllowOverride None
              Require all granted
          &lt;/Directory&gt;
      &lt;/VirtualHost&gt;
  &lt;/IfModule&gt;
</code></pre></div>        </div>
      </li>
      <li>
        <p>Movemos los ficheros que hemos generado a la carpeta <code class="language-plaintext highlighter-rouge">/etc/ssl/certs</code> y le proporcionamos los permisos necesarios:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo mv </span>maria.crt /etc/ssl/certs/
  <span class="nb">sudo mv </span>cacert.crt /etc/ssl/certs/
  <span class="nb">sudo chown </span>root:root /etc/ssl/certs/maria.crt
  <span class="nb">sudo chown </span>root:root /etc/ssl/certs/cacert.crt
  <span class="nb">sudo chmod </span>644 /etc/ssl/certs/maria.crt
  <span class="nb">sudo chmod </span>644 /etc/ssl/certs/cacert.crt
</code></pre></div>        </div>
      </li>
      <li>
        <p>Habilitamos el módulo ssl y reiniciamos el servicio apache:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>a2enmod ssl
  <span class="nb">sudo </span>a2ensite ssl-maria.iesgn.org.conf
  <span class="nb">sudo </span>systemctl reload apache2
</code></pre></div>        </div>
      </li>
      <li>
        <p>Modificamos el fichero para que realice una redirección de http a https:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>nano /etc/apache2/sites-available/maria.iesgn.org.conf

  <span class="c">#Añadimos la siguiente línea:</span>
  Redirect 301 / https://maria.iesgn.org/
</code></pre></div>        </div>
      </li>
      <li>
        <p>Reiniciamos el servicio apache:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>systemctl reload apache2
</code></pre></div>        </div>
      </li>
      <li>
        <p>Comprobamos su funcionamiento:</p>

        <p><img src="/assets/images/certificado/15.png" alt="15" /></p>

        <p><img src="/assets/images/certificado/16.png" alt="16" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Instala ahora un servidor nginx, y realiza la misma configuración que anteriormente para que se sirva la página con HTTPS.</p>

    <ul>
      <li>
        <p>Deshabilitamos apache:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>systemctl disable <span class="nt">--now</span> apache2
</code></pre></div>        </div>
      </li>
      <li>
        <p>Instalamos el servidor nginx:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>apt <span class="nb">install </span>nginx
</code></pre></div>        </div>
      </li>
      <li>
        <p>Creamos el fichero de configuración dentro de la carpeta que hemos creado anteriormente:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>nano /var/www/html/maria.iesgn.org/index.html
</code></pre></div>        </div>
        <ul>
          <li>
            <p>Y dentro de este fichero, escribimos lo siguiente:</p>

            <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  server {
      listen 80;
      listen [::]:80;
      server_name maria.iesgn.org;
      return 301 https://$server_name$request_uri;
  }

  server {
      listen 443 ssl http2;
      listen [::]:443 ssl http2;
      server_name maria.iesgn.org;

      ssl_certificate /etc/ssl/certs/maria.crt;
      ssl_certificate_key /etc/ssl/private/maria-priv.key;
      ssl_trusted_certificate /etc/ssl/certs/cacert.crt;

      root /var/www/html/maria.iesgn.org;
      index index.html;

      location / {
          try_files $uri $uri/ =404;
      }
  }
</code></pre></div>            </div>
          </li>
          <li>
            <p>Modificamos el fichero <code class="language-plaintext highlighter-rouge">index.html</code> que hemos creado anteriormente:</p>

            <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;!DOCTYPE html&gt;</span>
      <span class="nt">&lt;html&gt;</span>
          <span class="nt">&lt;head&gt;</span>
          <span class="nt">&lt;title&gt;</span>maria.iesgn.org<span class="nt">&lt;/title&gt;</span>
          <span class="nt">&lt;/head&gt;</span>
      <span class="nt">&lt;body&gt;</span>
          <span class="nt">&lt;h1&gt;</span>maria.iesgn.org<span class="nt">&lt;/h1&gt;</span>
          <span class="nt">&lt;p&gt;</span>Web de prueba para cripto 3 - HTTPS<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;p&gt;</span>PRUEBA NGINX<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>
</code></pre></div>            </div>
          </li>
          <li>
            <p>Realizamos la firma del certificado:</p>

            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>openssl rsa <span class="nt">-in</span> /etc/ssl/private/maria-priv.key <span class="nt">-out</span> /etc/ssl/private/maria-priv2.key
</code></pre></div>            </div>
          </li>
          <li>
            <p>Realizamos el enlace simbólico del fichero de configuración y reiniciamos el servicio nginx:</p>

            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/maria.iesgn.org.conf /etc/nginx/sites-enabled/
  <span class="nb">sudo </span>systemctl restart nginx
</code></pre></div>            </div>
          </li>
          <li>
            <p>Comprobamos que el servidor funciona correctamente:</p>

            <p><img src="/assets/images/certificado/17.png" alt="17" /></p>

            <p><img src="/assets/images/certificado/18.png" alt="18" /></p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ol>]]></content><author><name></name></author><category term="SEGURIDAD" /><summary type="html"><![CDATA[Certificado digital de persona física Un certificado digital es un documento electrónico que contiene información sobre la identidad de una persona física o jurídica, y que se utiliza para firmar documentos electrónicos. El certificado digital contiene información sobre la persona que lo solicita, como su nombre, apellidos, DNI, fecha de nacimiento, etc. Además, contiene información sobre la entidad que lo emite, como el nombre de la entidad, el CIF, la dirección, etc. Tarea 1: Instalación del certificado NOTA: Para solicitar el certificado, podemos hacerlo a través de una acreditación presencial en una oficina de la FNMT o usando el DNI electrónico. Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito. Instalamos el certificado en el navegador. Para ello, accedemos a la página de la FNMT y descargamos el certificado. Nos pedirá nuestro DNI, nuestro primer apellido y un código de validación que nos han mandado a nuestro correo, con el que hemos solicitado el certificado. Una vez descargado, lo instalamos en el navegador. A continuación, tras aceptar los términos y condiciones, nos pedirá que introduzcamos la contraseña que hemos establecido al solicitar el certificado. Una vez introducida, nos pedirá que introduzcamos la contraseña de nuestro certificado para poder instalarlo. Tras la descarga, nos preguntará si queremos crear una copia de seguridad del certificado. Finalmente, nos confirmará que la copia de seguridad se ha realizado correctamente. Muestra una captura de pantalla donde se vea las preferencias del navegador donde se ve instalado tu certificado. Para ver las preferencias del navegador, accedemos a Ajustes &gt; Privacidad y Seguridad &gt; Certificados &gt; Ver Certificados. Se abrirá una ventana con todos los certificados instalados en nuestro navegador. En ella, podemos ver el certificado que hemos instalado. ¿Cómo puedes hacer una copia de tu certificado?¿Como vas a realizar la copia de seguridad de tu certificado?. Razona la respuesta. Para hacer una copia de seguridad de nuestro certificado, debemos dirigirnos a Ajustes &gt; Privacidad y Seguridad &gt; Certificados &gt; Ver Certificados. Se nos abrirá la misma ventana de la imagen anterior. Clicamos en el certificado que queremos hacer una copia de seguridad y pulsamos en “Hacer copia”. Se nos abrirá una ventana en la que nos pedirá que introduzcamos la contraseña de nuestro certificado. Una vez introducida, nos pedirá que introduzcamos una contraseña para proteger nuestra copia de seguridad. Finalmente, tendremos nuestra copia de seguridad. En mi caso, he almacenado mi clave en un NAS privado, en un directorio cifrado con clave alfanumérica. De esta forma, si alguien accede a mi NAS, no podrá acceder a mi clave privada, ya que no conoce la clave de cifrado. Investiga como exportar la clave pública de tu certificado. Con la copia de seguridad que tenemos de nuestra clave, y en mi caso, teniendo acceso a mi NAS, tanto en local como por VPN, puedo exportar mi clave a otros dispositivos. En mi caso, he exportado mi clave a mi móvil, (teniedo este sistema operativo iOS). Para la comprobación, he instalado la aplicación de la DGT y poder tener mi documentación en mi dispositivo móvil. Tarea 2: Validación del certificado Instala en tu ordenador el software autofirma y desde la página de VALIDe valida tu certificado. Muestra capturas de pantalla donde se comprueba la validación. Para instalar autofirma, debemos dirigirnos a la página de autofirma y descargar el instalador. Una vez descargado, lo instalamos en nuestro ordenador. Una vez instalado, abrimos la aplicación y nos pedirá que introduzcamos la contraseña de nuestro certificado. Una vez introducida, nos pedirá que introduzcamos la contraseña de nuestro certificado para poder instalarlo. Ingresamos en la página de VALIDe y seleccionamos la opción de Validar Certificado Al ser la primera vez, autorizamos a autofirma a acceder a nuestra clave privada. Elegimos la clave que queremos validar, escribimos el captcha y pulsamos en Validar Como podemos ver, la clave es válida. Preparando el entorno de trabajo en Debian Como anteriormente he realizado los ejercicios en Windows, a partir de ahora vamos a realizarlo desde Debian. Para ello, sudo apt install libnss3-tools para instalar Java y las herramientas de Mozilla. Una vez instalado, ejecutamos el fichero .deb de autofirma y nos pedirá que introduzcamos la contraseña de nuestro certificado. Una vez introducida, nos pedirá que introduzcamos la contraseña de nuestro certificado para poder instalarlo. Tarea 3: Firma electrónica Utilizando la página VALIDe y el programa autofirma, firma un documento con tu certificado y envíalo por correo a un compañero. Creamos dos documentos de texto: uno para la comprobación de la página VALIDe y otro para la aplicación de autofirma. echo "Hola. Soy Maria. Esto es una prueba de VALIDe." &gt; valide.txt echo "Hola. Soy Maria. Esto es una prueba de autofirma." &gt; autofirma.txt Una vez creados los documentos, los firmamos, uno con VALIDe y otro con autofirma. Tu debes recibir otro documento firmado por un compañero y utilizando las herramientas anteriores debes visualizar la firma Visualizar Firma y Verificar Firma. ¿Puedes verificar la firma aunque no tengas la clave pública de tu compañero? Si,debido a que la clave pública de mi compañero se adjunta en el fichero ya firmado, por lo que puedo verificar la firma. ¿Es necesario estar conectado a internet para hacer la validación de la firma?. Razona tus respuestas. Para VALIDe si que es necesario estar conectado a internet, ya que es una página web. Para autofirma, no es necesario estar conectado a internet, ya que es una aplicación que se ejecuta en nuestro ordenador. Entre dos compañeros, firmar los dos un documento, verificar la firma para comprobar que está firmado por los dos. Tarea 4: Autenticación Utilizando tu certificado accede a alguna página de la administración pública (cita médica, becas, puntos del carnet,…). Entrega capturas de pantalla donde se demuestre el acceso a ellas. Accedemos a la web de la DGT para verificar el funcionamiento de nuestro certificado digital accediendo a nuestro historial de puntos. Nos redigirá a una página donde podremos elegir entre los distintos tipos de acceso y elegimos Cl@ave. El navegador, en mi caso, requiere de la aplicación de autofirma para poder acceder a la contraseña. Una vez introducida, nos redirige a la página de la DGT donde podemos ver nuestro historial de puntos. HTTPS / SSL NOTA: Vamos a realizar esta práctica en una web que se acceda con el nombre maria.iesgn.org. Para realizar esta tarea, vamos a necesitar la colaboración de un compañero, ya que fimraré una Autoridad Certificadora y mi compañero la firmará, y viceversa. Para ello, podemos hacer uso de los siguientes enlaces para buscar más información: Phil’s X509/SSL Guide How to setup your own CA with OpenSSL Crear autoridad certificadora (CA) y certificados autofirmados en Linux Creamos la Autoridad certificadora Crear su autoridad certificadora (generar el certificado digital de la CA). Mostrar el fichero de configuración de la AC. Creamos el directorio donde alojaremos todo lo necesario para la CA, dándole los permisos necesarios. mkdir CA cd CA mkdir certs csr crl newcerts private chmod 700 private touch index.txt touch index.txt.attr echo 1000 &gt; serial Creamos las variables de entorno donde definiremos los datos de configuración de la CA. countryName_default="ES" stateOrProvinceName_default="Sevilla" localityName_default="Dos Hermanas" organizationName_default="Maria" organizationalUnitName_default="ASIR2" emailAddress_default="mariajesus.alloza@outlook.es" DIR_CA="./" Creamos el fichero de configuración. cat &lt;&lt;EOF&gt;$DIR_CA/openssl.conf [ ca ] # man ca default_ca = CA_default [ CA_default ] # Directory and file locations. dir = ${DIR_CA} certs = ${DIR_CA}certs crl_dir = ${DIR_CA}crl new_certs_dir = ${DIR_CA}newcerts database = ${DIR_CA}index.txt serial = ${DIR_CA}serial RANDFILE = ${DIR_CA}private/.rand # The root key and root certificate. private_key = ${DIR_CA}private/private.key certificate = ${DIR_CA}certs/cacert.crt # For certificate revocation lists. crlnumber = ${DIR_CA}crlnumber crl = ${DIR_CA}crl/ca.crl.pem crl_extensions = crl_ext default_crl_days = 30 # SHA-1 is deprecated, so use SHA-2 instead. default_md = sha256 name_opt = ca_default cert_opt = ca_default default_days = 375 preserve = no policy = policy_strict [ policy_strict ] # The root CA should only sign intermediate certificates that match. # See the POLICY FORMAT section of man ca. countryName = match stateOrProvinceName = match organizationName = match organizationalUnitName = optional commonName = supplied emailAddress = optional [ policy_loose ] # Allow the intermediate CA to sign a more diverse range of certificates. # See the POLICY FORMAT section of the ca man page. countryName = optional stateOrProvinceName = optional localityName = optional organizationName = optional organizationalUnitName = optional commonName = supplied emailAddress = optional [ req ] # Options for the req tool (man req). default_bits = 2048 distinguished_name = req_distinguished_name string_mask = utf8only # SHA-1 is deprecated, so use SHA-2 instead. default_md = sha256 # Extension to add when the -x509 option is used. x509_extensions = v3_ca # Extension for SANs req_extensions = v3_req [ v3_req ] # Extensions to add to a certificate request # Before invoke openssl use: export SAN=DNS:value1,DNS:value2 basicConstraints = CA:FALSE keyUsage = nonRepudiation, digitalSignature, keyEncipherment xxxsubjectAltNamexxx = [ req_distinguished_name ] # See &lt;https://en.wikipedia.org/wiki/Certificate_signing_request&gt;. countryName = Country Name (2 letter code) stateOrProvinceName = State or Province Name localityName = Locality Name 0.organizationName = Organization Name organizationalUnitName = Organizational Unit Name commonName = Common Name emailAddress = Email Address # Optionally, specify some defaults. countryName_default = $countryName_default stateOrProvinceName_default = $stateOrProvinceName_default localityName_default = $localityName_default 0.organizationName_default = $organizationName_default organizationalUnitName_default = $organizationalUnitName_default emailAddress_default = $emailAddress_default [ v3_ca ] # Extensions for a typical CA (man x509v3_config). subjectKeyIdentifier = hash authorityKeyIdentifier = keyid:always,issuer basicConstraints = critical, CA:true keyUsage = critical, digitalSignature, cRLSign, keyCertSign [ v3_intermediate_ca ] # Extensions for a typical intermediate CA (man x509v3_config). subjectKeyIdentifier = hash authorityKeyIdentifier = keyid:always,issuer basicConstraints = critical, CA:true, pathlen:0 keyUsage = critical, digitalSignature, cRLSign, keyCertSign [ usr_cert ] # Extensions for client certificates (man x509v3_config). basicConstraints = CA:FALSE nsCertType = client, email nsComment = "OpenSSL Generated Client Certificate" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment extendedKeyUsage = clientAuth, emailProtection [ server_cert ] # Extensions for server certificates (man x509v3_config). basicConstraints = CA:FALSE nsCertType = server nsComment = "OpenSSL Generated Server Certificate" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always keyUsage = critical, digitalSignature, keyEncipherment extendedKeyUsage = serverAuth [ crl_ext ] # Extension for CRLs (man x509v3_config). authorityKeyIdentifier=keyid:always [ ocsp ] # Extension for OCSP signing certificates (man ocsp). basicConstraints = CA:FALSE subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer keyUsage = critical, digitalSignature extendedKeyUsage = critical, OCSPSigning EOF Creamos tanto la clavecomoel certificado de a AC (autoridad de certificación) con el siguiente comando: #Creación de la clave openssl genrsa -aes256 -out private/private.key 4096 sed -i 's|xxxsubjectAltNamexxx =|subjectAltName = ${ENV::SAN}|g' openssl.conf URL=juanjesus.iesgn.org export SAN=DNS:$URL #Creación del certificado openssl req -config openssl.conf -key private/private.key -new -x509 -days 3650 -sha256 -extensions v3_ca -out certs/cacert.crt chmod 444 certs/cacert.crt Debe recibir el fichero CSR (Solicitud de Firmar un Certificado) de su compañero, debe firmarlo y enviar el certificado generado a su compañero. Mi compañero me envía mir fichero CSR, lo firmo y lo envío de vuelta. #Firmar el certificado openssl ca -config openssl.conf -extensions v3_req -days 3650 -notext -md sha256 -in csr/juanjesus-mjca.csr -out certs/juanjesus-mjca.crt ¿Qué otra información debes aportar a tu compañero para que éste configure de forma adecuada su servidor web con el certificado generado? Dentro de nuestro fichero openssl.conf nos encontraremos con los datos que nuestro compañero debe rellenar para configurar su servidor web, que son: countryName stateOrProvinceName localityName Administramos el servidor web Preparando el escenario Para realizar este punto, deberemos crear un servidor apache, y configurarlo para que nos sirva una página web con https. Para ello, deberemos seguir los siguientes pasos: Instalamos el servidor apache: sudo apt install apache2 Deshabilitamos el virtual host por defecto: sudo a2dissite 000-default.conf Creamos un nuevo virtual host y su fichero de configuración: sudo mkdir /var/www/html/maria.iesgn.org Creamos el fichero index.html dentro de la carpeta que hemos creado anteriormente: sudo nano /var/www/html/maria.iesgn.org/index.html Y dentro de este fichero, escribimos lo siguiente: &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;maria.iesgn.org&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;maria.iesgn.org&lt;/h1&gt; &lt;p&gt;Web de prueba para cripto 3 - HTTPS&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; Habilitamos el nuevo virtual host y reiniciamos el servicio apache: sudo a2ensite maria.iesgn.org.conf sudo systemctl restart apache2 Empezamos Crea una clave privada RSA de 4096 bits para identificar el servidor. sudo openssl genrsa -aes256 -out /etc/ssl/private/maria-priv.key 4096 sudo chmod 400 /etc/ssl/private/maria-priv.key Utiliza la clave anterior para generar un CSR, considerando que deseas acceder al servidor con el FQDN (maria.iesgn.org). sudo openssl req -new -sha256 -key /etc/ssl/private/maria-priv.key -out maria.csr Envía la solicitud de firma a la entidad certificadora (su compañero). Recibe como respuesta un certificado X.509 para el servidor firmado y el certificado de la autoridad certificadora. Configura tu servidor web con https en el puerto 443, haciendo que las peticiones http se redireccionen a https (forzar https). Modificamos el fichero de configuración: &lt;IfModule mod_ssl.c&gt; &lt;VirtualHost *:443&gt; ServerName maria.iesgn.org DocumentRoot /var/www/html/maria.iesgn.org ErrorLog ${APACHE_LOG_DIR}/error-maria.log CustomLog ${APACHE_LOG_DIR}/access-maria.log combined SSLEngine on SSLCertificateFile /etc/ssl/certs/maria.crt SSLCertificateKeyFile /etc/ssl/private/maria-priv.key SSLCertificateChainFile /etc/ssl/certs/cacert.crt &lt;Directory /var/www/html/maria.iesgn.org&gt; Options Indexes FollowSymLinks AllowOverride None Require all granted &lt;/Directory&gt; &lt;/VirtualHost&gt; &lt;/IfModule&gt; Movemos los ficheros que hemos generado a la carpeta /etc/ssl/certs y le proporcionamos los permisos necesarios: sudo mv maria.crt /etc/ssl/certs/ sudo mv cacert.crt /etc/ssl/certs/ sudo chown root:root /etc/ssl/certs/maria.crt sudo chown root:root /etc/ssl/certs/cacert.crt sudo chmod 644 /etc/ssl/certs/maria.crt sudo chmod 644 /etc/ssl/certs/cacert.crt Habilitamos el módulo ssl y reiniciamos el servicio apache: sudo a2enmod ssl sudo a2ensite ssl-maria.iesgn.org.conf sudo systemctl reload apache2 Modificamos el fichero para que realice una redirección de http a https: sudo nano /etc/apache2/sites-available/maria.iesgn.org.conf #Añadimos la siguiente línea: Redirect 301 / https://maria.iesgn.org/ Reiniciamos el servicio apache: sudo systemctl reload apache2 Comprobamos su funcionamiento: Instala ahora un servidor nginx, y realiza la misma configuración que anteriormente para que se sirva la página con HTTPS. Deshabilitamos apache: sudo systemctl disable --now apache2 Instalamos el servidor nginx: sudo apt install nginx Creamos el fichero de configuración dentro de la carpeta que hemos creado anteriormente: sudo nano /var/www/html/maria.iesgn.org/index.html Y dentro de este fichero, escribimos lo siguiente: server { listen 80; listen [::]:80; server_name maria.iesgn.org; return 301 https://$server_name$request_uri; } server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name maria.iesgn.org; ssl_certificate /etc/ssl/certs/maria.crt; ssl_certificate_key /etc/ssl/private/maria-priv.key; ssl_trusted_certificate /etc/ssl/certs/cacert.crt; root /var/www/html/maria.iesgn.org; index index.html; location / { try_files $uri $uri/ =404; } } Modificamos el fichero index.html que hemos creado anteriormente: &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;maria.iesgn.org&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;maria.iesgn.org&lt;/h1&gt; &lt;p&gt;Web de prueba para cripto 3 - HTTPS&lt;/p&gt; &lt;p&gt;PRUEBA NGINX&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; Realizamos la firma del certificado: sudo openssl rsa -in /etc/ssl/private/maria-priv.key -out /etc/ssl/private/maria-priv2.key Realizamos el enlace simbólico del fichero de configuración y reiniciamos el servicio nginx: sudo ln -s /etc/nginx/sites-available/maria.iesgn.org.conf /etc/nginx/sites-enabled/ sudo systemctl restart nginx Comprobamos que el servidor funciona correctamente:]]></summary></entry><entry><title type="html">Montaje NFS mediante systemd</title><link href="/aso/2022/12/28/nfs-systemd.html" rel="alternate" type="text/html" title="Montaje NFS mediante systemd" /><published>2022-12-28T11:59:07+01:00</published><updated>2022-12-28T11:59:07+01:00</updated><id>/aso/2022/12/28/nfs-systemd</id><content type="html" xml:base="/aso/2022/12/28/nfs-systemd.html"><![CDATA[<p>En este post vamos a crear una instancia en OpensStack y anexarle un volumen de 2GB. El objetivo será configurar un servicio NFS de exportación y en el volumen anexado, un punto de montaje de la exportación mediante systemd.</p>

<h2 id="creamos-el-escenario">Creamos el escenario</h2>

<h3 id="creamos-el-servidor">Creamos el servidor</h3>
<p>Creamos una instancia en OpenStack con una imagen de Debian 11.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack server create <span class="nt">--flavor</span> m1.mini <span class="se">\</span>
<span class="nt">--image</span> <span class="s2">"Debian 11 Bullseye"</span> <span class="se">\</span>
<span class="nt">--key-name</span> pass <span class="se">\</span>
<span class="nt">--security-group</span> default <span class="se">\</span>
<span class="nt">--network</span> <span class="s2">"red de mariajesus.alloza"</span> <span class="se">\</span>
NFS-Systemd
</code></pre></div></div>

<p>Le añadimos un volumen de 2GB</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack volume create <span class="nt">--size</span> 2 <span class="se">\</span>
<span class="nt">--description</span> <span class="s2">"Volumen NFS-Systemd"</span> <span class="se">\</span>
<span class="nt">--availability-zone</span> <span class="s2">"nova"</span> <span class="se">\</span>
<span class="nt">--bootable</span> <span class="se">\</span>
nfs
</code></pre></div></div>

<p>Le asignamos una IP flotante.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack floating ip create ext-net
<span class="c">#IP flotante asignada:</span>
172.22.201.229
</code></pre></div></div>

<p><img src="/assets/images/nfs-systemd/1.png" alt="1" /></p>

<h3 id="creamos-el-cliente">Creamos el cliente</h3>

<p>Creamos una instancia en OpenStack con una imagen de Debian 11.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack server create <span class="nt">--flavor</span> m1.mini <span class="se">\</span>
<span class="nt">--image</span> <span class="s2">"Debian 11 Bullseye"</span> <span class="se">\</span>
<span class="nt">--key-name</span> pass <span class="se">\</span>
<span class="nt">--security-group</span> default <span class="se">\</span>
<span class="nt">--network</span> <span class="s2">"red de mariajesus.alloza"</span> <span class="se">\</span>
NFS-Systemd-Cliente
</code></pre></div></div>

<p>Le asignamos una IP flotante.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack floating ip create ext-net
<span class="c">#IP flotante asignada:</span>
172.22.201.247
</code></pre></div></div>

<h2 id="configuración">Configuración</h2>

<h3 id="configuramos-el-servicio-nfs">Configuramos el servicio NFS</h3>

<p>En la máquina servidor,con ip <code class="language-plaintext highlighter-rouge">172.22.201.229</code> realizamos las siguientes acciones:</p>

<ul>
  <li>
    <p>Instalamos el servicio NFS:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">sudo </span>apt <span class="nb">install </span>nfs-kernel-server
  <span class="nb">sudo </span>apt <span class="nb">install </span>nfs-common
</code></pre></div>    </div>
  </li>
  <li>
    <p>Tras su instalación, vamos a habilitar y activar el servicio:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  systemctl start rpcbind nfs-server
  systemctl <span class="nb">enable </span>rpcbind nfs-server
</code></pre></div>    </div>
  </li>
  <li>
    <p>Comprobamos que el servicio está activo:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  systemctl status rpcbind nfs-server
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/2.png" alt="2" /></p>

    <p>En la siguiente imagen podemos ver que el servicio está activo y que está a la escucha en el puerto 2049.</p>

    <p><img src="/assets/images/nfs-systemd/3.png" alt="3" /></p>
  </li>
</ul>

<h3 id="configuramos-el-punto-de-montaje">Configuramos el punto de montaje</h3>

<p>Ahora le toca el turno a la máquina cliente, con ip <code class="language-plaintext highlighter-rouge">172.22.201.247</code>. En ella realizamos las siguientes acciones:</p>

<ul>
  <li>
    <p>Creamos el punto de montaje:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">mkdir</span> /nfs
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos el fichero de configuración del punto de montaje:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  nano /etc/systemd/system/nfs.mount
</code></pre></div>    </div>
  </li>
  <li>
    <p>Añadimos el siguiente contenido:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">[</span>Unit]
  <span class="c">#Descripción</span>
  <span class="nv">Description</span><span class="o">=</span>Montaje NFS-Systemd

  <span class="o">[</span>Mount]
  <span class="c">#Volumen de 2GB añadido a la instancia</span>
  <span class="nv">What</span><span class="o">=</span>/dev/vdb
  <span class="c">#Directorio de montaje</span>
  <span class="nv">Where</span><span class="o">=</span>/nfs
  <span class="c">#Sistema de ficheros empleado</span>
  <span class="nv">Type</span><span class="o">=</span>ext4
  <span class="c">#Opciones de montaje</span>
  <span class="nv">Options</span><span class="o">=</span>defaults

  <span class="o">[</span>Install]
  <span class="c">#Autoarranque</span>
  <span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/4.png" alt="4" /></p>
  </li>
  <li>
    <p>Vamos a formatear el volumen anexado a la instancia:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mkfs.ext4 /dev/vdb
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/5.png" alt="5" /></p>

    <p>Y a continuación, reiniciamos el demonio e iniciamos el punto de montaje:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  systemctl daemon-reload
  systemctl start nfs.mount
</code></pre></div>    </div>
  </li>
  <li>
    <p>Comprobamos que el punto de montaje está activo:</p>

    <p><img src="/assets/images/nfs-systemd/6.png" alt="6" /></p>
  </li>
</ul>

<h3 id="montaje-permanente-del-punto-de-montaje">Montaje permanente del punto de montaje</h3>

<p>Para que el punto de montaje sea permanente, es decir, que se monte automáticamente al arrancar la máquina, realizamos las siguientes acciones:</p>

<ul>
  <li>
    <p>Añadimos el punto de montaje al fichero <code class="language-plaintext highlighter-rouge">/etc/fstab</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  nano /etc/fstab

  <span class="c">#Añadimos la siguiente línea al final del fichero:</span>
  /dev/vdb /nfs ext4 defaults 0 0
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/7.png" alt="7" /></p>
  </li>
  <li>
    <p>Para que los clientes puedan acceder al punto de montaje, debemos añadir la siguiente línea al fichero <code class="language-plaintext highlighter-rouge">/etc/exports</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  nano /etc/exports

  <span class="c">#Añadimos la siguiente línea al final del fichero:</span>
  /nfs 10.0.0.0/24<span class="o">(</span>rw,sync,no_root_squash,no_subtree_check<span class="o">)</span>
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/8.png" alt="8" /></p>

    <p>La configuración anterior permite que todos los clientes de la red <code class="language-plaintext highlighter-rouge">10.0.0.0/24</code> puedan acceder al punto de montaje <code class="language-plaintext highlighter-rouge">/nfs</code> con permisos de lectura y escritura.</p>
  </li>
  <li>
    <p>Reiniciamos la máquina y comprobamos que el punto de montaje se monta de forma automática al iniciar el sistema.</p>

    <p><img src="/assets/images/nfs-systemd/9.png" alt="9" /></p>
  </li>
</ul>

<h3 id="configuración-del-cliente-nfs">Configuración del cliente NFS</h3>

<p>Ahora vamos a configurar el cliente NFS. En la máquina cliente, con ip <code class="language-plaintext highlighter-rouge">172.22.201.247</code>, realizamos las siguientes acciones:</p>

<ul>
  <li>
    <p>Instalamos el cliente NFS:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  apt update <span class="o">&amp;&amp;</span> apt upgrade <span class="nt">-y</span>
  apt <span class="nb">install </span>nfs-common
</code></pre></div>    </div>
  </li>
  <li>
    <p>Para comprobar que el cliente NFS está instalado, ejecutamos el siguiente comando:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  showmount <span class="nt">-e</span> 10.0.0.215
</code></pre></div>    </div>

    <p>Lo que se nos mostrará es la exportación del servidor:</p>

    <p><img src="/assets/images/nfs-systemd/10.png" alt="10" /></p>
  </li>
</ul>

<h3 id="configuración-del-punto-de-montaje-del-cliente">Configuración del punto de montaje del cliente</h3>

<p>Ahora vamos a configurar el punto de montaje del cliente. En la máquina cliente, con ip <code class="language-plaintext highlighter-rouge">172.22.201.247</code>, realizamos las siguientes acciones:</p>

<ul>
  <li>
    <p>Creamos el directorio que usaremos como punto de montaje:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">mkdir</span> /cliente
</code></pre></div>    </div>
  </li>
  <li>
    <p>Y a continuación, creamos el fichero de configuración del punto de montaje:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  nano /etc/systemd/system/cliente.mount
</code></pre></div>    </div>

    <p>La configuración del fichero es la siguiente:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">[</span>Unit]
  <span class="nv">Description</span><span class="o">=</span>Montaje NFS-cliente

  <span class="o">[</span>Mount]
  <span class="c">#Dirección IP:Directorio de exportación</span>
  <span class="nv">What</span><span class="o">=</span>10.0.0.215:/nfs
  <span class="c">#Directorio del recurso compartido</span>
  <span class="nv">Where</span><span class="o">=</span>/cliente
  <span class="c">#Tipo de recurso</span>
  <span class="nv">Type</span><span class="o">=</span>nfs
  <span class="c">#Opciones de montaje</span>
  <span class="nv">Options</span><span class="o">=</span>defaults

  <span class="o">[</span>Install]
  <span class="c">#Autoarranque</span>
  <span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/11.png" alt="11" /></p>

    <ul>
      <li>
        <p>Activamos y montamos el recurso que queremos compartir:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  systemctl <span class="nb">enable </span>NFS-cliente.mount
  systemctl start NFS-cliente.mount
</code></pre></div>        </div>
      </li>
      <li>
        <p>Comprobamos que el punto de montaje está activo:</p>
      </li>
    </ul>

    <p><img src="/assets/images/nfs-systemd/12.png" alt="12" /></p>
  </li>
</ul>

<h3 id="montaje-permanente-del-punto-de-montaje-del-cliente">Montaje permanente del punto de montaje del cliente</h3>

<p>Para que el punto de montaje sea permanente, es decir, que se monte automáticamente al arrancar la máquina, realizamos las siguientes acciones:</p>

<ul>
  <li>
    <p>Añadimos el punto de montaje al fichero <code class="language-plaintext highlighter-rouge">/etc/fstab</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  nano /etc/fstab

  <span class="c">#Añadimos la siguiente línea al final del fichero:</span>
  10.0.0.215:/nfs /cliente nfs defaults 0 0
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/13.png" alt="13" /></p>
  </li>
  <li>
    <p>Reiniciamos la máquina y comprobamos que el punto de montaje se monta de forma automática al iniciar el sistema.</p>

    <p><img src="/assets/images/nfs-systemd/14.png" alt="14" /></p>
  </li>
</ul>

<h2 id="comprobación-del-funcionamiento-del-servicio-nfs">Comprobación del funcionamiento del servicio NFS</h2>

<p>Para comprobar que el servicio NFS está funcionando de forma correcta, vamos a crear un directorio y un fichero en el punto de montaje del servidor y comprobar que se reflejan en el punto de montaje del cliente.</p>

<p><strong>¡NOTA!</strong> 
Recuerda que una vez realizados los cambios, para que el sercidor NFS los reconozca, debemos ejecutar <code class="language-plaintext highlighter-rouge">sudo exportfs -ra</code> para que se actualicen los cambios.</p>

<ul>
  <li>
    <p>Creamos un directorio y un fichero en el punto de montaje del servidor:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">mkdir</span> /NFS-Systemd/prueba
  <span class="nb">echo</span> <span class="s2">"Esto es un texto escrito desde el servidor"</span> <span class="o">&gt;</span> /nfs/nfs-prueba.txt
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/15.png" alt="15" /></p>
  </li>
  <li>
    <p>Accederemos al punto de montaje del cliente y comprobaremos que el directorio y el fichero se han creado correctamente:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">cd</span> /cliente
  <span class="nb">ls
  cat </span>nfs-prueba.txt
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/16.png" alt="16" /></p>
  </li>
  <li>
    <p>Si lo que queremos es crear un fichero desde el cliente, lo crearemos en el punto de montaje del cliente y comprobaremos que se ha creado en el punto de montaje del servidor:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">echo</span> <span class="s2">"Esto es un texto escrito desde el cliente"</span> <span class="o">&gt;</span> /cliente/prueba/prueba-cliente.txt
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/17.png" alt="17" /></p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">ls</span> /nfs/prueba
  <span class="nb">cat</span> /nfs/prueba/prueba-cliente.txt
</code></pre></div>    </div>

    <p><img src="/assets/images/nfs-systemd/18.png" alt="18" /></p>
  </li>
</ul>]]></content><author><name></name></author><category term="ASO" /><summary type="html"><![CDATA[En este post vamos a crear una instancia en OpensStack y anexarle un volumen de 2GB. El objetivo será configurar un servicio NFS de exportación y en el volumen anexado, un punto de montaje de la exportación mediante systemd. Creamos el escenario Creamos el servidor Creamos una instancia en OpenStack con una imagen de Debian 11. openstack server create --flavor m1.mini \ --image "Debian 11 Bullseye" \ --key-name pass \ --security-group default \ --network "red de mariajesus.alloza" \ NFS-Systemd Le añadimos un volumen de 2GB openstack volume create --size 2 \ --description "Volumen NFS-Systemd" \ --availability-zone "nova" \ --bootable \ nfs Le asignamos una IP flotante. openstack floating ip create ext-net #IP flotante asignada: 172.22.201.229 Creamos el cliente Creamos una instancia en OpenStack con una imagen de Debian 11. openstack server create --flavor m1.mini \ --image "Debian 11 Bullseye" \ --key-name pass \ --security-group default \ --network "red de mariajesus.alloza" \ NFS-Systemd-Cliente Le asignamos una IP flotante. openstack floating ip create ext-net #IP flotante asignada: 172.22.201.247 Configuración Configuramos el servicio NFS En la máquina servidor,con ip 172.22.201.229 realizamos las siguientes acciones: Instalamos el servicio NFS: sudo apt install nfs-kernel-server sudo apt install nfs-common Tras su instalación, vamos a habilitar y activar el servicio: systemctl start rpcbind nfs-server systemctl enable rpcbind nfs-server Comprobamos que el servicio está activo: systemctl status rpcbind nfs-server En la siguiente imagen podemos ver que el servicio está activo y que está a la escucha en el puerto 2049. Configuramos el punto de montaje Ahora le toca el turno a la máquina cliente, con ip 172.22.201.247. En ella realizamos las siguientes acciones: Creamos el punto de montaje: mkdir /nfs Creamos el fichero de configuración del punto de montaje: nano /etc/systemd/system/nfs.mount Añadimos el siguiente contenido: [Unit] #Descripción Description=Montaje NFS-Systemd [Mount] #Volumen de 2GB añadido a la instancia What=/dev/vdb #Directorio de montaje Where=/nfs #Sistema de ficheros empleado Type=ext4 #Opciones de montaje Options=defaults [Install] #Autoarranque WantedBy=multi-user.target Vamos a formatear el volumen anexado a la instancia: mkfs.ext4 /dev/vdb Y a continuación, reiniciamos el demonio e iniciamos el punto de montaje: systemctl daemon-reload systemctl start nfs.mount Comprobamos que el punto de montaje está activo: Montaje permanente del punto de montaje Para que el punto de montaje sea permanente, es decir, que se monte automáticamente al arrancar la máquina, realizamos las siguientes acciones: Añadimos el punto de montaje al fichero /etc/fstab: nano /etc/fstab #Añadimos la siguiente línea al final del fichero: /dev/vdb /nfs ext4 defaults 0 0 Para que los clientes puedan acceder al punto de montaje, debemos añadir la siguiente línea al fichero /etc/exports: nano /etc/exports #Añadimos la siguiente línea al final del fichero: /nfs 10.0.0.0/24(rw,sync,no_root_squash,no_subtree_check) La configuración anterior permite que todos los clientes de la red 10.0.0.0/24 puedan acceder al punto de montaje /nfs con permisos de lectura y escritura. Reiniciamos la máquina y comprobamos que el punto de montaje se monta de forma automática al iniciar el sistema. Configuración del cliente NFS Ahora vamos a configurar el cliente NFS. En la máquina cliente, con ip 172.22.201.247, realizamos las siguientes acciones: Instalamos el cliente NFS: apt update &amp;&amp; apt upgrade -y apt install nfs-common Para comprobar que el cliente NFS está instalado, ejecutamos el siguiente comando: showmount -e 10.0.0.215 Lo que se nos mostrará es la exportación del servidor: Configuración del punto de montaje del cliente Ahora vamos a configurar el punto de montaje del cliente. En la máquina cliente, con ip 172.22.201.247, realizamos las siguientes acciones: Creamos el directorio que usaremos como punto de montaje: mkdir /cliente Y a continuación, creamos el fichero de configuración del punto de montaje: nano /etc/systemd/system/cliente.mount La configuración del fichero es la siguiente: [Unit] Description=Montaje NFS-cliente [Mount] #Dirección IP:Directorio de exportación What=10.0.0.215:/nfs #Directorio del recurso compartido Where=/cliente #Tipo de recurso Type=nfs #Opciones de montaje Options=defaults [Install] #Autoarranque WantedBy=multi-user.target Activamos y montamos el recurso que queremos compartir: systemctl enable NFS-cliente.mount systemctl start NFS-cliente.mount Comprobamos que el punto de montaje está activo: Montaje permanente del punto de montaje del cliente Para que el punto de montaje sea permanente, es decir, que se monte automáticamente al arrancar la máquina, realizamos las siguientes acciones: Añadimos el punto de montaje al fichero /etc/fstab: nano /etc/fstab #Añadimos la siguiente línea al final del fichero: 10.0.0.215:/nfs /cliente nfs defaults 0 0 Reiniciamos la máquina y comprobamos que el punto de montaje se monta de forma automática al iniciar el sistema. Comprobación del funcionamiento del servicio NFS Para comprobar que el servicio NFS está funcionando de forma correcta, vamos a crear un directorio y un fichero en el punto de montaje del servidor y comprobar que se reflejan en el punto de montaje del cliente. ¡NOTA! Recuerda que una vez realizados los cambios, para que el sercidor NFS los reconozca, debemos ejecutar sudo exportfs -ra para que se actualicen los cambios. Creamos un directorio y un fichero en el punto de montaje del servidor: mkdir /NFS-Systemd/prueba echo "Esto es un texto escrito desde el servidor" &gt; /nfs/nfs-prueba.txt Accederemos al punto de montaje del cliente y comprobaremos que el directorio y el fichero se han creado correctamente: cd /cliente ls cat nfs-prueba.txt Si lo que queremos es crear un fichero desde el cliente, lo crearemos en el punto de montaje del cliente y comprobaremos que se ha creado en el punto de montaje del servidor: echo "Esto es un texto escrito desde el cliente" &gt; /cliente/prueba/prueba-cliente.txt ls /nfs/prueba cat /nfs/prueba/prueba-cliente.txt]]></summary></entry><entry><title type="html">Despliegue de una aplcación Python</title><link href="/hlc+sri/2022/12/19/despliegue-python.html" rel="alternate" type="text/html" title="Despliegue de una aplcación Python" /><published>2022-12-19T12:32:50+01:00</published><updated>2022-12-19T12:32:50+01:00</updated><id>/hlc+sri/2022/12/19/despliegue-python</id><content type="html" xml:base="/hlc+sri/2022/12/19/despliegue-python.html"><![CDATA[<h1 id="descripción">Descripción</h1>

<p>En esta entrada vamos a desplegar una aplicación Python realizada en Django.</p>

<h2 id="entorno-de-desarrollo">Entorno de desarrollo</h2>

<ol>
  <li>
    <p>Utilizamos la máquina <code class="language-plaintext highlighter-rouge">bravo</code> de nuestro <a href="https://sysmaria.netlify.app/hlc+sri/2022/12/05/escenario.html">escenario</a> que usa Rocky Linux 9.</p>
  </li>
  <li>
    <p>Vamos a configurar nuestro escenario de la siguiente manera:</p>

    <ul>
      <li>
        <p>Realizamos un fork del repositorio con la <a href="https://github.com/josedom24/django_tutorial">app</a>.</p>
      </li>
      <li>
        <p>Creamos un entorno virtual de Python3 e instalamos las dependencias necesarias.</p>
      </li>
      <li>Comprobamos que la base de datos con la que vamosa trabajar es SQLite.
        <ul>
          <li>¿Qué fichero tenemos que consultar?</li>
          <li>¿Cómo se llama la base de datos que vamos a crear?</li>
        </ul>
      </li>
      <li>
        <p>Creamos la base de datos.</p>
      </li>
      <li>
        <p>Creamos el usuario Administrador.</p>
      </li>
      <li>
        <p>Ejecutamos el servidor web de desarrollo y entramos en la zona de administración para comprobar que los datos se han almacenado correctamente.</p>
      </li>
      <li>
        <p>Creamos dos preguntas con posibles respuestas.</p>
      </li>
      <li>
        <p>Comprobamos que podemos acceder a la aplicación desde el navegador. y accedemos a la url <code class="language-plaintext highlighter-rouge">/polls</code>.</p>
      </li>
      <li>Configura el servidor web con el módulo wsgi para sevir la página web. Como hemos utilizado la máquina <code class="language-plaintext highlighter-rouge">bravo</code> se accederá por el nombre <code class="language-plaintext highlighter-rouge">python.maria.gonzalonazareno.org</code>.</li>
    </ul>
  </li>
</ol>

<h2 id="entorno-de-producción">Entorno de producción</h2>

<p>Eneste apartado vamos a realizar el despliegue de nuestra aplicación en un entorno de producción, para ello vamos a utilizar nuestro VPS.</p>

<p>Para ello:</p>

<ol>
  <li>
    <p>Vamos a clonar el repositorio de la aplicación en el VPS.</p>
  </li>
  <li>
    <p>Creamos un entorno virtual e instalamos las dependencias de nuestra aplicación.</p>
  </li>
  <li>
    <p>Instalamos el módulo que nos permitirá que python trabajecon mysql:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pip <span class="nb">install </span>mysqlclient
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos la base de datos y un usuario en mysql.</p>
  </li>
  <li>
    <p>Configuramos la aplicación para trabajar con mysql, por ello, modificamos el fichero <code class="language-plaintext highlighter-rouge">settings.py</code> de la siguiente manera:</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
     <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.mysql'</span><span class="p">,</span>
     <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'myproject'</span><span class="p">,</span>
     <span class="s">'USER'</span><span class="p">:</span> <span class="s">'myprojectuser'</span><span class="p">,</span>
     <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'password'</span><span class="p">,</span>
     <span class="s">'HOST'</span><span class="p">:</span> <span class="s">'localhost'</span><span class="p">,</span>
     <span class="s">'PORT'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Creamos una copia de seguridad de la base de datos, teniendo en cuenta que en el entorno de desarrollo hemos utilizado SQLite y en el de producción MySQL. Por ello, lo recomendable es realizar la copia de seguridad y recuperarla con los comandos adecuados.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> manage.py dumpdata
 python manage.py loaddata 
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configuramos el servidor de aplicaciones uwsgi, creando una unidad de systemd (como hemor realizado en el paso 2 de <a href="https://sysmaria.netlify.app/iaw/2022/12/17/wsgi.html#h-despliegue-de-la-aplicaci%C3%B3n-flask">talleres wsgi</a>) y configuramos nginx como proxy inverso para servir la aplicación.</p>
  </li>
  <li>
    <p>Debemos asegurarnos que el contenido estático se está sirviendo: ¿Se muestra la imagen de fondo de la aplicación? ¿Se ve de forma adecuada la hoja de estilo de la zona de administración?</p>
  </li>
  <li>
    <p>Desactivamos la configuración el modo debug a <code class="language-plaintext highlighter-rouge">False</code>, para que los errores de ejecución no den información sensible de la aplicación.</p>
  </li>
  <li>
    <p>La página web deberá ser accesible usando https, en la URL: <code class="language-plaintext highlighter-rouge">https://python.mariatec.es</code>.</p>
  </li>
</ol>

<p>Como podemos ver en la siguiente imagen, la página funciona correctamente:</p>

<p><img src="/assets/images/posts/app-python.png" alt="app-python" /></p>

<h2 id="entorno-de-producción-1">Entorno de producción</h2>

<p>En este apartado vamos a realizar cambios en el entorno de desarrollo y posteriormente vamos a subirlas a producción. Vamos a realizar tres modificaciones, pero recuerda que primero lo haces en el entrono de desarrollo, y luego tendrás que llevar los cambios a producción:</p>

<ol>
  <li>
    <p>Modifica la página inicial donde se ven las encuestas para que aparezca tu nombre, para ello modifica el archivo <code class="language-plaintext highlighter-rouge">django_tutorial/polls/templates/polls/index.html</code>.</p>
  </li>
  <li>
    <p>Modificamos la imagen que aparece como fondo de la aplicación.</p>
  </li>
  <li>
    <p>Vamos a crear una nueva tabla en la base de datos, para ello sigue los siguientes pasos:</p>

    <ol>
      <li>
        <p>Añadimos un nuevo modelo al fichero <code class="language-plaintext highlighter-rouge">polls/models.py</code>:</p>

        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">class</span> <span class="nc">Persona</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
     <span class="n">Abr</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
     <span class="n">Nombre</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

     <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">Abr</span><span class="o">+</span><span class="s">" - "</span><span class="o">+</span><span class="bp">self</span><span class="p">.</span><span class="n">Nombre</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Creamos una migración.</p>
      </li>
      <li>
        <p>Aplicamos la migración.</p>
      </li>
      <li>Añadimos el nuevomodelo al sitio de administración de django:
        <ul>
          <li>
            <p>Cambiamos la siguiente línea del fichero <code class="language-plaintext highlighter-rouge">polls/admin.py</code>:</p>

            <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Question</span>
</code></pre></div>            </div>

            <p>por:</p>

            <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Question</span><span class="p">,</span> <span class="n">Persona</span>
</code></pre></div>            </div>
          </li>
          <li>
            <p>Añadimos la siguiente línea al fichero <code class="language-plaintext highlighter-rouge">polls/admin.py</code>:</p>

            <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">admin</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">Categoria</span><span class="p">)</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>Deplegamos el cambio en el entorno de producción.</li>
    </ol>
  </li>
</ol>]]></content><author><name></name></author><category term="HLC+SRI" /><summary type="html"><![CDATA[Descripción]]></summary></entry><entry><title type="html">Desplegando aplicaciones flask con apache2 + mod_wsgi</title><link href="/iaw/2022/12/17/wsgi.html" rel="alternate" type="text/html" title="Desplegando aplicaciones flask con apache2 + mod_wsgi" /><published>2022-12-17T08:17:50+01:00</published><updated>2022-12-17T08:17:50+01:00</updated><id>/iaw/2022/12/17/wsgi</id><content type="html" xml:base="/iaw/2022/12/17/wsgi.html"><![CDATA[<h2 id="desplegando-aplicaciones-flask-con-apache2--mod_wsgi">Desplegando aplicaciones flask con apache2 + mod_wsgi</h2>

<h3 id="introducción">Introducción</h3>

<p>En esta entrada vamos a ver como desplegar una aplicación flask con apache2 + mod_wsgi.</p>

<h3 id="configuración-de-apache2-para-servir-una-aplicación-web-flask">Configuración de apache2 para servir una aplicación web flask</h3>

<ol>
  <li>Instalamos apache2 y mod_wsgi</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@debian:~ apt <span class="nb">install </span>apache2 libapache2-mod-wsgi-py3
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Suponiendo que tenemos:
    - Un servidor web apache2 con wsgi activado.
    - Una aplicación flask en el directorio /home/debian/guestbook
    - Un entorno virtual con flask instalado en /home/debian/guestbook/venv
</code></pre></div></div>

<ol>
  <li>Creamos el fichero wsgi que estará en el directorio del entorno virtual con el siguiente contenido:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from app import prog as aplicacion
</code></pre></div></div>

<p>Y veremos que:
    - El app se corresponde con el nombre del módulo, <code class="language-plaintext highlighter-rouge">app.py</code>.
    - El <code class="language-plaintext highlighter-rouge">prog</code> corresponde a la aplicación flask creada en app.py: prog = Flask(<strong>name</strong>).
    - Importamos la aplicación flask, pero la llamamos application necesario para que el servidor web pueda enviarle peticiones.</p>

<h3 id="configuración-de-apache2-para-servir-una-aplicación-web-flask-1">Configuración de apache2 para servir una aplicación web flask</h3>

<ol>
  <li>
    <p>Creamos un virtualhost que se acceda con el nombre flask.tunombre.org, esta configuración irá en el fichero correspondiente:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> DocumentRoot /home/debian/guestbook
 WSGIDaemonProcess flask_guestbook python-path<span class="o">=</span>/home/debian/guestbook:/home/debian/venv/flask/lib/python3.9/site-packages
 WSGIProcessGroup flask_guestbook
 WSGIScriptAlias / /home/debian/guestbook/wsgi.py process-group<span class="o">=</span>flask_guestbook
 &lt;Directory /home/debian/guestbook&gt;
         Require all granted
 &lt;/Directory&gt;
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/1.png" alt="1" /></p>
  </li>
  <li>
    <p>Activamos el módulo wsgi y el virtualhost:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ a2enmod wsgi
 root@debian:~ a2ensite flask.maria.org
</code></pre></div>    </div>
  </li>
  <li>
    <p>Reiniciamos el servicio apache2:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ systemctl restart apache2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Cambiamos el fichero hosts para que apunte a la ip del servidor:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>nano /etc/hosts
 <span class="nt">---</span>
 172.22.201.119 www.flask.maria.org
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/2.png" alt="2" /></p>
  </li>
</ol>

<h2 id="desplegando-aplicaciones-flask-con-apache2--mod_uwsgi">Desplegando aplicaciones flask con apache2 + mod_uwsgi</h2>

<h3 id="introducción-1">Introducción</h3>

<p>En esta entrada vamos a ver como desplegar una aplicación flask con apache2 + mod_uwsgi.</p>

<h3 id="instalación-de-apache2--mod_uwsgi">Instalación de apache2 + mod_uwsgi</h3>

<ol>
  <li>
    <p>Instalamos el paquete python3-dev y uwsgi:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ apt <span class="nb">install </span>python3-dev uwsgi
</code></pre></div>    </div>

    <p>Es posible que también tengamos que instalar <code class="language-plaintext highlighter-rouge">build-essential</code> para que se instale correctamente uwsgi.</p>
  </li>
</ol>

<h3 id="despliegue-de-la-aplicación-flask">Despliegue de la aplicación flask</h3>

<ol>
  <li>
    <p>Probamos que el servidor uwsgi funciona correctamente:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">(</span>flask<span class="o">)</span><span class="nv">$ </span>uwsgi <span class="nt">--http</span> :8080 <span class="nt">--chdir</span> /home/debian/guestbook <span class="nt">--wsgi-file</span> wsgi.py <span class="nt">--process</span> 4 <span class="nt">--threads</span> 2 <span class="nt">--master</span> 
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/0-1.png" alt="01" /></p>

    <p>Otra forma de comprobar que funciona es creando el ficher <code class="language-plaintext highlighter-rouge">ini</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">(</span>flask<span class="o">)</span><span class="nv">$ </span>nano guestbook.ini
 <span class="nt">---</span>
 <span class="o">[</span>uwsgi]
 http <span class="o">=</span> :8080
 chdir <span class="o">=</span> /home/debian/guestbook
 wsgi-file <span class="o">=</span> wsgi.py
 processes <span class="o">=</span> 4
 threads <span class="o">=</span> 2
</code></pre></div>    </div>
    <p>Y ejecutamos:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">(</span>flask<span class="o">)</span><span class="nv">$ </span>uwsgi <span class="nt">--ini</span> uwsgi.ini
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/0-2.png" alt="02" /></p>
  </li>
  <li>
    <p>Creamos una unidad systemd para controlarla con systemctl.</p>

    <ul>
      <li>Creamos el fichero <code class="language-plaintext highlighter-rouge">/etc/systemd/system/uwsgi.guestbook.service</code>:</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>Unit]
 <span class="nv">Description</span><span class="o">=</span>uwsgi-guestbook
 <span class="nv">After</span><span class="o">=</span>network.target

 <span class="o">[</span>Install]
 <span class="nv">WantedBy</span><span class="o">=</span>multi-user.target

 <span class="o">[</span>Service]
 <span class="nv">User</span><span class="o">=</span>www-data
 <span class="nv">Group</span><span class="o">=</span>www-data
 <span class="nv">Restart</span><span class="o">=</span>always

 <span class="nv">ExecStart</span><span class="o">=</span>/home/debian/venv/flask/bin/uwsgi /home/debian/venv/flask/guestbook.ini
 <span class="nv">ExecReload</span><span class="o">=</span>/bin/kill <span class="nt">-s</span> HUP <span class="nv">$MAINPID</span>
 <span class="nv">ExecStop</span><span class="o">=</span>/bin/kill <span class="nt">-s</span> TERM <span class="nv">$MAINPID</span>
    
 <span class="nv">WorkingDirectory</span><span class="o">=</span>/home/debian/guestbook
 <span class="nv">Environment</span><span class="o">=</span><span class="nv">PYTHONPATH</span><span class="o">=</span> <span class="s1">'/home/debian/guestbook:/home/debian/venv/flask/lib/python3.9/site-packages'</span>
    
 <span class="nv">PrivateTmp</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/3.png" alt="3" /></p>

    <ul>
      <li>Activamos el servicio:</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ systemctl <span class="nb">enable </span>uwsgi.guestbook
 root@debian:~ systemctl start uwsgi.guestbook
</code></pre></div>    </div>

    <p><strong>NOTA</strong>: Si cambiamos el contenido de la unidad lo recargaremos ejecutando:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ systemctl daemon-reload
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="proxy-inverso-para-uwsgi">Proxy Inverso para uwsgi</h3>

<ol>
  <li>
    <p>Activamos el módulo proxy_http:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> DocumentRoot /home/debian/guestbook
 ProxyPass / http://127.0.0.1:8080/
 ProxyPassReverse / http://127.0.0.1:8080/
 &lt;Directory /home/debian/guestbook&gt;
     Require all granted
 &lt;/Directory&gt;
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/4.png" alt="4" /></p>
  </li>
  <li>
    <p>Reiniciamos el servicio apache2:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ a2enmod proxy_http
 root@debian:~ systemctl restart apache2
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/5.png" alt="5" /></p>
  </li>
</ol>

<h3 id="nginx-como-proxy-inverso-de-uwsgi">Nginx como proxy inverso de uwsgi</h3>

<ol>
  <li>
    <p>Configuramos el virtualhost de nginx en <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/guestbook.conf</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> server <span class="o">{</span>
     listen 80<span class="p">;</span>
     server_name www.guestbook-nginx.maria.org<span class="p">;</span>
     root /home/debian/guestbook<span class="p">;</span>
     location / <span class="o">{</span>
         proxy_pass http://localhost:8080<span class="p">;</span>
         include proxy_params<span class="p">;</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/6.png" alt="6" /></p>
  </li>
  <li>
    <p>Activamos el virtualhost:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ <span class="nb">ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/guestbook.conf /etc/nginx/sites-enabled/guestbook.conf
</code></pre></div>    </div>
  </li>
  <li>
    <p>Reiniciamos el servicio nginx:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@debian:~ systemctl restart nginx
</code></pre></div>    </div>

    <p><img src="/assets/images/uwsgi/7.png" alt="7" /></p>
  </li>
</ol>]]></content><author><name></name></author><category term="IAW" /><summary type="html"><![CDATA[Desplegando aplicaciones flask con apache2 + mod_wsgi]]></summary></entry></feed>